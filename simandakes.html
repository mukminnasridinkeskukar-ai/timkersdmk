<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>SIMANDAKES</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Tahoma,Segoe UI,sans-serif;
  background:#020617;
  color:#e5e7eb;
  display:flex;
  height:100vh;
}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:#020617;
  padding:20px;
}
.brand{
  font-size:18px;
  font-weight:bold;
  color:#38bdf8;
  margin-bottom:24px;
}
.menu{
  padding:12px;
  border-radius:12px;
  cursor:pointer;
  margin-bottom:6px;
  transition:.25s;
}
.menu:hover{background:#0f172a}
.menu.active{
  background:#0f172a;
  border-left:4px solid #38bdf8;
}

/* MAIN */
.main{
  flex:1;
  padding:24px;
  overflow:auto;
}
.panel{display:none}
.panel.active{display:block}

/* KPI */
.kpi-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
}
.kpi-card{
  background:#0f172a;
  padding:20px;
  border-radius:16px;
  cursor:pointer;
  transition:.25s;
}
.kpi-card:hover{transform:scale(1.03)}
.kpi-title{color:#94a3b8;font-size:14px}
.kpi-value{font-size:34px;color:#38bdf8;font-weight:bold}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal.show{display:flex}
.modal-box{
  background:#020617;
  padding:24px;
  border-radius:16px;
  width:60%;
}
.close{cursor:pointer;font-size:20px}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="brand">SIMANDAKES</div>
  <div class="menu active" onclick="showPanel('dashboard',this)">Dashboard</div>
  <div class="menu" onclick="showPanel('sdm',this)">SDM Kesehatan</div>
  <div class="menu" onclick="showPanel('mutu',this)">Mutu & Kinerja</div>
  <div class="menu" onclick="showPanel('inovasi',this)">Inovasi</div>
  <div class="menu" onclick="showPanel('monitoring',this)">Monitoring</div>
  <div class="menu" onclick="showPanel('laporan',this)">Laporan</div>
</div>

<!-- MAIN -->
<div class="main">

<!-- DASHBOARD -->
<div id="dashboard" class="panel active">
  <h2>Dashboard Utama</h2>
  <div class="kpi-grid" id="dashboardKPI"></div>
  <br>
  <canvas id="dashboardChart"></canvas>
</div>

<!-- SDM -->
<div id="sdm" class="panel">
  <h2>SDM Kesehatan</h2>
  <div class="kpi-grid" id="sdmKPI"></div>
</div>

<!-- MUTU -->
<div id="mutu" class="panel">
  <h2>Mutu & Kinerja</h2>
  <div class="kpi-grid" id="mutuKPI"></div>
  <br>
  <canvas id="mutuChart"></canvas>
</div>

<div id="inovasi" class="panel"><h2>Inovasi</h2></div>
<div id="monitoring" class="panel"><h2>Monitoring</h2></div>
<div id="laporan" class="panel"><h2>Laporan</h2></div>

</div>

<!-- MODAL -->
<div class="modal" id="modal" onclick="if(event.target.id==='modal')closeModal()">
  <div class="modal-box">
    <div style="display:flex;justify-content:space-between">
      <h3 id="modalTitle"></h3>
      <span class="close" onclick="closeModal()">âœ•</span>
    </div>
    <canvas id="modalChart"></canvas>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API_URL = "https://script.google.com/macros/s/AKfycbwDJp-q_EhKEZbFc258ScEYhjpZObp2NpCkXG6O2Zu8xBd9RXCmWNxYutSfqWQmlZA7/exec";

let apiData = {};
let dashboardChart = null;
let mutuChart = null;
let modalChart = null;

/* ================= PANEL ================= */
function showPanel(id, el){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll(".menu").forEach(m=>m.classList.remove("active"));
  el.classList.add("active");
}

/* ================= LOAD ALL ================= */
async function loadAll(){
  const res = await fetch(`${API_URL}?action=summary`);
  apiData = await res.json();
  renderDashboard();
  renderSDM();
  renderMutu();
}

/* ================= DASHBOARD ================= */
function renderDashboard(){
  const grid = document.getElementById("dashboardKPI");
  grid.innerHTML = "";

  const items = [
    ["Total SDMK 2026", apiData.jumlah_sdmk_2026],
    ["SDMK Puskesmas", apiData.sdmk_puskesmas],
    ["SDMK Rumah Sakit", apiData.sdmk_rs],
    ["SDMK Klinik", apiData.sdmk_klinik]
  ];

  items.forEach(i=>{
    const c = document.createElement("div");
    c.className = "kpi-card";
    c.innerHTML = `
      <div class="kpi-title">${i[0]}</div>
      <div class="kpi-value">${(i[1]||0).toLocaleString("id-ID")}</div>
    `;
    c.onclick = ()=>openModal(i[0]);
    grid.appendChild(c);
  });

  if(dashboardChart) dashboardChart.destroy();
  dashboardChart = new Chart(document.getElementById("dashboardChart"),{
    type:"bar",
    data:{
      labels:["Puskesmas","RS","Klinik","Lainnya"],
      datasets:[{
        data:[
          apiData.sdmk_puskesmas||0,
          apiData.sdmk_rs||0,
          apiData.sdmk_klinik||0,
          apiData.sdmk_faskes_lain||0
        ]
      }]
    }
  });
}

/* ================= SDM ================= */
function renderSDM(){
  const grid = document.getElementById("sdmKPI");
  grid.innerHTML = "";

  Object.keys(apiData).forEach(k=>{
    const c = document.createElement("div");
    c.className = "kpi-card";
    c.innerHTML = `
      <div class="kpi-title">${k}</div>
      <div class="kpi-value">${(apiData[k]||0).toLocaleString("id-ID")}</div>
    `;
    grid.appendChild(c);
  });
}

/* ================= MUTU ================= */
async function renderMutu(){
  const grid = document.getElementById("mutuKPI");
  grid.innerHTML = "";

  const capaian = apiData.mutu_sdmk || 0;
  const target = apiData.target_mutu || 0;
  const status = capaian >= target ? "Tercapai" : "Belum";

  [
    ["Capaian Mutu (%)", capaian + "%"],
    ["Target Mutu (%)", target + "%"],
    ["Status", status]
  ].forEach(i=>{
    const c = document.createElement("div");
    c.className = "kpi-card";
    c.innerHTML = `
      <div class="kpi-title">${i[0]}</div>
      <div class="kpi-value">${i[1]}</div>
    `;
    grid.appendChild(c);
  });

  const res = await fetch(`${API_URL}?action=mutu`);
  const trend = await res.json();

  if(mutuChart) mutuChart.destroy();
  mutuChart = new Chart(document.getElementById("mutuChart"),{
    type:"line",
    data:{
      labels:trend.labels,
      datasets:[{data:trend.values}]
    }
  });
}

/* ================= MODAL ================= */
function openModal(title){
  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modal").classList.add("show");

  if(modalChart) modalChart.destroy();
  modalChart = new Chart(document.getElementById("modalChart"),{
    type:"pie",
    data:{
      labels:["Puskesmas","RS","Klinik","Lainnya"],
      datasets:[{
        data:[
          apiData.sdmk_puskesmas||0,
          apiData.sdmk_rs||0,
          apiData.sdmk_klinik||0,
          apiData.sdmk_faskes_lain||0
        ]
      }]
    }
  });
}
function closeModal(){
  document.getElementById("modal").classList.remove("show");
  if(modalChart) modalChart.destroy();
}

/* ================= INIT ================= */
loadAll();
</script>

</body>
</html>
