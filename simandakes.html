<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>SIMANDAKES</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Tahoma,Segoe UI,sans-serif;
  background:#020617;
  color:#e5e7eb;
  display:flex;
  height:100vh;
}
.sidebar{
  width:260px;
  background:#020617;
  padding:20px;
}
.brand{
  font-weight:bold;
  font-size:18px;
  color:#38bdf8;
  margin-bottom:24px;
}
.menu{
  padding:12px;
  border-radius:12px;
  cursor:pointer;
  margin-bottom:6px;
}
.menu:hover{background:#0f172a}
.menu.active{
  background:#0f172a;
  border-left:4px solid #38bdf8;
}

.main{
  flex:1;
  padding:24px;
  overflow:auto;
}
.panel{display:none}
.panel.active{display:block}

/* KPI */
.kpi-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
}
.kpi-card{
  background:#0f172a;
  padding:20px;
  border-radius:16px;
  cursor:pointer;
}
.kpi-title{color:#94a3b8;font-size:14px}
.kpi-value{font-size:34px;color:#38bdf8;font-weight:bold}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.show{display:flex}
.modal-box{
  background:#020617;
  padding:24px;
  border-radius:16px;
  width:60%;
}
.close{cursor:pointer}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="brand">SIMANDAKES</div>
  <div class="menu active" onclick="showPanel('dashboard',this)">Dashboard</div>
  <div class="menu" onclick="showPanel('sdm',this)">SDM Kesehatan</div>
  <div class="menu" onclick="showPanel('mutu',this)">Mutu & Kinerja</div>
  <div class="menu" onclick="showPanel('inovasi',this)">Inovasi</div>
  <div class="menu" onclick="showPanel('monitoring',this)">Monitoring</div>
  <div class="menu" onclick="showPanel('laporan',this)">Laporan</div>
</div>

<!-- MAIN -->
<div class="main">

<!-- DASHBOARD -->
<div id="dashboard" class="panel active">
  <h2>Dashboard Utama</h2>
  <p>Ringkasan Kondisi SDM Kesehatan Daerah</p>

  <div class="kpi-grid" id="dashboardKPI"></div>

  <div style="margin-top:30px;background:#0f172a;padding:20px;border-radius:16px">
    <h3>Distribusi SDMK</h3>
    <canvas id="dashboardChart"></canvas>
  </div>
</div>


<!-- SDM KESEHATAN -->
<div id="sdm" class="panel">
  <h2>SDM Kesehatan</h2>
  <div class="kpi-grid" id="kpiGrid"></div>
</div>

<!-- PLACEHOLDER PANEL -->
<div id="mutu" class="panel">
  <h2>Mutu & Kinerja</h2>
  <p>Evaluasi capaian mutu SDM Kesehatan</p>

  <div class="kpi-grid" id="mutuKPI"></div>

  <div style="margin-top:30px;background:#0f172a;padding:20px;border-radius:16px">
    <h3>Tren Capaian Mutu</h3>
    <canvas id="mutuChart"></canvas>
  </div>
</div>

<div id="inovasi" class="panel"><h2>Inovasi</h2></div>
<div id="monitoring" class="panel"><h2>Monitoring</h2></div>
<div id="laporan" class="panel"><h2>Laporan</h2></div>

</div>

<!-- MODAL -->
<div class="modal" id="modal" onclick="if(event.target.id==='modal')closeModal()">
  <div class="modal-box">
    <div style="display:flex;justify-content:space-between">
      <h3 id="modalTitle"></h3>
      <span class="close" onclick="closeModal()">âœ•</span>
    </div>
    <canvas id="chart"></canvas>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbwDJp-q_EhKEZbFc258ScEYhjpZObp2NpCkXG6O2Zu8xBd9RXCmWNxYutSfqWQmlZA7/exec";

/* ===== PANEL ===== */
function showPanel(id,el){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll(".menu").forEach(m=>m.classList.remove("active"));
  el.classList.add("active");
}

/* ===== KPI SDMK ===== */
const KPI = [
  {key:"jumlah_sdmk_2026",title:"Jumlah SDMK 2026"},
  {key:"sdmk_puskesmas",title:"SDMK Puskesmas"},
  {key:"sdmk_rs",title:"SDMK Rumah Sakit"},
  {key:"sdmk_klinik",title:"SDMK Klinik"},
  {key:"sdmk_tpm_named_nakes",title:"SDMK TPM Named Nakes"},
  {key:"sdmk_faskes_lain",title:"SDMK Faskes Lainnya"},
  {key:"dokter_puskesmas",title:"Dokter Puskesmas"},
  {key:"dokter_gigi_puskesmas",title:"Dokter Gigi Puskesmas"},
  {key:"perawat_puskesmas",title:"Perawat Puskesmas"},
  {key:"bidan_puskesmas",title:"Bidan Puskesmas"},
  {key:"tenaga_lain_puskesmas",title:"Nakes Lainnya"}
];

let apiData={};
let chart=null;

async function loadSDM(){
  const res = await fetch(`${API_URL}?action=summary`);
  apiData = await res.json();

  const grid=document.getElementById("kpiGrid");
  grid.innerHTML="";

  KPI.forEach(k=>{
    const val=apiData[k.key];
    const c=document.createElement("div");
    c.className="kpi-card";
    c.innerHTML=`
      <div class="kpi-title">${k.title}</div>
      <div class="kpi-value">${(val||0).toLocaleString("id-ID")}</div>
    `;
    c.onclick=()=>openDetail(k.title);
    grid.appendChild(c);
  });
}

/* ===== MODAL ===== */
function openDetail(title){
  modalTitle.innerText=title;
  modal.classList.add("show");
  if(chart)chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"pie",
    data:{
      labels:["Puskesmas","RS","Klinik","Lainnya"],
      datasets:[{
        data:[
          apiData.sdmk_puskesmas||0,
          apiData.sdmk_rs||0,
          apiData.sdmk_klinik||0,
          apiData.sdmk_faskes_lain||0
        ]
      }]
    }
  });
}
function closeModal(){
  modal.classList.remove("show");
  if(chart)chart.destroy();
}

/* ===== INIT ===== */
loadSDM().then(()=>{
  loadDashboard();
  loadMutu();
});


function renderSDM(){
  const grid = document.getElementById("kpiGrid");
  grid.innerHTML = "";

  const KPI = [
    {key:"jumlah_sdmk_2026", title:"Jumlah SDMK 2026"},
    {key:"sdmk_puskesmas", title:"SDMK Puskesmas"},
    {key:"sdmk_rs", title:"SDMK Rumah Sakit"},
    {key:"sdmk_klinik", title:"SDMK Klinik"},
    {key:"sdmk_tpm_named_nakes", title:"SDMK TPM / Named Nakes"},
    {key:"sdmk_faskes_lain", title:"SDMK Faskes Lainnya"},
    {key:"dokter_puskesmas", title:"Dokter Puskesmas"},
    {key:"dokter_gigi_puskesmas", title:"Dokter Gigi Puskesmas"},
    {key:"perawat_puskesmas", title:"Perawat Puskesmas"},
    {key:"bidan_puskesmas", title:"Bidan Puskesmas"},
    {key:"tenaga_lain_puskesmas", title:"Nakes Lainnya"}
  ];

  KPI.forEach(k=>{
    const val = apiData[k.key];

    const card = document.createElement("div");
    card.className = "kpi-card";
    card.innerHTML = `
      <div class="kpi-title">${k.title}</div>
      <div class="kpi-value">${Number(val||0).toLocaleString("id-ID")}</div>
    `;
    grid.appendChild(card);
  });
}

  /* ===== GRAFIK DASHBOARD ===== */
  if(window.dashboardChartObj) window.dashboardChartObj.destroy();

  const ctx = document.getElementById("dashboardChart");
  window.dashboardChartObj = new Chart(ctx,{
    type:"bar",
    data:{
      labels:["Puskesmas","Rumah Sakit","Klinik","Faskes Lain"],
      datasets:[{
        data:[
          apiData.sdmk_puskesmas || 0,
          apiData.sdmk_rs || 0,
          apiData.sdmk_klinik || 0,
          apiData.sdmk_faskes_lain || 0
        ],
        backgroundColor:[
          "#38bdf8",
          "#22c55e",
          "#facc15",
          "#f97316"
        ]
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true}}
    }
  });
}

loadAllData();
  
/* ===== MUTU & KINERJA ===== */
async function loadMutu(){
  // ambil summary (mutu & target)
  const mutu = {
    capaian: apiData.mutu_sdmk || 0,
    target: apiData.target_mutu || 0
  };

  const grid = document.getElementById("mutuKPI");
  grid.innerHTML = "";

  const status = mutu.capaian >= mutu.target ? "Tercapai" : "Belum Tercapai";
  const statusColor = mutu.capaian >= mutu.target ? "#22c55e" : "#ef4444";

  [
    { title:"Capaian Mutu (%)", value: mutu.capaian + "%" },
    { title:"Target Mutu (%)", value: mutu.target + "%" },
    { title:"Status", value: status, color: statusColor }
  ].forEach(it=>{
    const c=document.createElement("div");
    c.className="kpi-card";
    c.innerHTML=`
      <div class="kpi-title">${it.title}</div>
      <div class="kpi-value" style="color:${it.color||'#38bdf8'}">
        ${it.value}
      </div>
    `;
    grid.appendChild(c);
  });

  // grafik tren mutu
  const res = await fetch(`${API_URL}?action=mutu`);
  const trend = await res.json();

  if(window.mutuChartObj) window.mutuChartObj.destroy();

  window.mutuChartObj = new Chart(
    document.getElementById("mutuChart"),{
      type:"line",
      data:{
        labels: trend.labels,
        datasets:[{
          data: trend.values,
          borderColor:"#38bdf8",
          backgroundColor:"rgba(56,189,248,.2)",
          tension:.4,
          fill:true
        }]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{y:{beginAtZero:true,max:100}}
      }
    }
  );
}

</script>

</body>
</html>
