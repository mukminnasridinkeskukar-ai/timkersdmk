<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>SIMANDAKES â€“ Smart Health Command Center</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#020617;
  --panel:#020617cc;
  --card:#0f172acc;
  --accent:#38bdf8;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,sans-serif;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:var(--text);
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* SIDEBAR */
.sidebar{
  width:270px;
  background:#020617;
  padding:22px;
}
.brand{
  display:flex;gap:12px;align-items:center;margin-bottom:28px
}
.logo{
  width:40px;height:40px;border-radius:12px;
  background:linear-gradient(135deg,#38bdf8,#22c55e);
  display:flex;align-items:center;justify-content:center;
  color:#020617;font-weight:900
}
.brand-title{font-size:18px;font-weight:700;color:var(--accent)}
.brand small{color:var(--muted)}

.nav-item{
  display:flex;gap:12px;align-items:center;
  padding:12px 14px;border-radius:14px;
  cursor:pointer;margin-bottom:6px;
  transition:.25s
}
.nav-item:hover{background:#0f172a;transform:translateX(4px)}
.nav-item.active{
  background:linear-gradient(90deg,#38bdf833,#22c55e22);
  box-shadow:0 0 0 1px #38bdf8
}
.sub{
  margin-left:40px;
  max-height:0;overflow:hidden;
  transition:max-height .3s
}
.sub.open{max-height:200px}
.sub div{
  padding:8px 0;font-size:14px;
  color:var(--muted);cursor:pointer
}
.sub div:hover{color:var(--accent)}

/* MAIN */
.main{
  flex:1;
  padding:26px;
  overflow:auto;
}
.topbar{
  display:flex;justify-content:space-between;align-items:center
}

/* KPI */
.kpi-grid{
  margin-top:20px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px
}
.kpi-card{
  background:var(--card);
  border-radius:20px;
  padding:22px;
  cursor:pointer;
  backdrop-filter:blur(10px);
  animation:fadeUp .6s ease
}
.kpi-card:hover{transform:scale(1.03)}
.kpi-header{display:flex;justify-content:space-between}
.kpi-title{font-size:14px;color:var(--muted)}
.kpi-value{
  font-size:42px;
  font-weight:700;
  margin:10px 0;
  color:var(--accent)
}
.kpi-footer{font-size:14px}
.up{color:var(--green)}
.down{color:var(--red)}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:none}
}

/* MODAL / INSIGHT */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  display:none;align-items:center;justify-content:center;
  z-index:9999
}
.modal.show{display:flex}
.modal-box{
  width:60%;max-width:900px;
  background:#020617;
  border-radius:22px;
  padding:30px;
  animation:zoom .25s ease
}
.modal-header{
  display:flex;justify-content:space-between;align-items:center
}
.close{cursor:pointer;font-size:22px}
.detail-cards{
  margin:20px 0;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:18px
}
.detail-card{
  background:var(--card);
  padding:18px;border-radius:16px
}

@keyframes zoom{
  from{transform:scale(.85);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* TV WALL */
.tv-btn{
  position:fixed;
  bottom:20px;right:20px;
  background:var(--accent);
  color:#020617;
  padding:12px 20px;
  border-radius:50px;
  font-weight:700;
  cursor:pointer
}
@media (fullscreen){body{cursor:none}}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="brand">
    <div class="logo">â—†</div>
    <div>
      <div class="brand-title">SIMANDAKES</div>
      <small>Smart Health Dashboard</small>
    </div>
  </div>

  <div class="nav-item active" onclick="activate(this)">ðŸ“Š Dashboard</div>

  <div class="nav-item" onclick="toggleSub(this)">ðŸ‘¥ SDM Kesehatan</div>
  <div class="sub">
    <div onclick="openInsight('Distribusi SDM')">Distribusi</div>
    <div onclick="openInsight('Kebutuhan SDM')">Kebutuhan</div>
  </div>

  <div class="nav-item" onclick="toggleSub(this)">ðŸ“ˆ Mutu & Kinerja</div>
  <div class="sub">
    <div onclick="openInsight('Indikator Mutu')">Indikator</div>
    <div onclick="openInsight('Capaian')">Capaian</div>
  </div>

  <div class="nav-item" onclick="openInsight('Inovasi SIMANDAKES')">ðŸš€ Inovasi</div>
  <div class="nav-item" onclick="openInsight('Monitoring & Evaluasi')">ðŸ§ª Monitoring</div>
  <div class="nav-item" onclick="openInsight('Laporan')">ðŸ“„ Laporan</div>
</div>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <h2>Smart Health Command Center</h2>
    <span style="color:var(--muted)">Mode Internal</span>
  </div>

  <div class="kpi-grid" id="kpiGrid"></div>
</div>

<div class="tv-btn" onclick="startTVWall()">ðŸ“º TV WALL</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <div class="modal-header">
      <h2 id="modalTitle"></h2>
      <div class="close" onclick="closeModal()">âœ•</div>
    </div>

    <div class="detail-cards">
      <div class="detail-card"><span>Total</span><h2 id="dTotal">â€“</h2></div>
      <div class="detail-card"><span>Status</span><h2 id="dStatus">â€“</h2></div>
      <div class="detail-card"><span>Perubahan</span><h2 id="dDelta">â€“</h2></div>
    </div>

    <canvas id="detailChart"></canvas>
  </div>
</div>

<script>
/* ================= CONFIG API ================= */
const API_URL = "https://script.google.com/macros/s/AKfycbzLkub439BcqgqYQagagiJfzpAhOYutbcycpraMZ5krrmIr7FnMN4ksD26UplL0hQ27/exec";

/* ================= KPI TEMPLATE ================= */
const KPI_TEMPLATE = [
  { key:"puskesmas", title:"Jumlah Puskesmas", icon:"ðŸ¥", unit:"" },
  { key:"sdm", title:"SDM Kesehatan", icon:"ðŸ‘©â€âš•ï¸", unit:"" },
  { key:"mutu", title:"Capaian Mutu", icon:"ðŸ“ˆ", unit:"%" },
  { key:"inovasi", title:"Inovasi Aktif", icon:"ðŸš€", unit:"" }
];

const grid = document.getElementById("kpiGrid");

/* ================= RENDER KPI CARD ================= */
function renderKPICards(){
  grid.innerHTML = "";
  KPI_TEMPLATE.forEach(k=>{
    const card = document.createElement("div");
    card.className = "kpi-card";
    card.innerHTML = `
      <div class="kpi-header">
        <div class="kpi-title">${k.title}</div>
        <div>${k.icon}</div>
      </div>
      <div class="kpi-value" id="kpi-${k.key}">0</div>
      <div class="kpi-footer">â€“</div>
    `;
    card.onclick = () => openInsight(k.title);
    grid.appendChild(card);
  });
}

/* ================= LOAD KPI FROM API ================= */
async function loadKPI(){
  try{
    const res = await fetch(`${API_URL}?action=summary`);
    const data = await res.json();

    KPI_TEMPLATE.forEach(k=>{
      const el = document.getElementById(`kpi-${k.key}`);
      if(!el) return;
      let val = data[k.key] ?? 0;
      el.innerText = k.unit ? val + k.unit : val.toLocaleString("id-ID");
    });

  }catch(err){
    console.error("Gagal load KPI", err);
  }
}

/* ================= SIDEBAR ================= */
function activate(el){
  document.querySelectorAll(".nav-item").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");
}
function toggleSub(el){
  activate(el);
  const sub = el.nextElementSibling;
  if(sub && sub.classList.contains("sub")) sub.classList.toggle("open");
}

/* ================= INSIGHT / MODAL ================= */
let chart;
function openInsight(title){
  modalTitle.innerText = title;
  dTotal.innerText = "-";
  dStatus.innerText = "Informasi";
  dDelta.innerText = "-";
  modal.classList.add("show");

  if(chart) chart.destroy();
  chart = new Chart(detailChart,{
    type:"line",
    data:{
      labels:["Jan","Feb","Mar","Apr","Mei","Jun"],
      datasets:[{
        data:[70,75,80,85,90,92],
        borderColor:"#38bdf8",
        tension:.4
      }]
    },
    options:{plugins:{legend:{display:false}}}
  });
}

function closeModal(){
  modal.classList.remove("show");
  if(chart){ chart.destroy(); chart=null; }
}

/* ================= TV WALL ================= */
let tvInt=null;
function startTVWall(){
  document.documentElement.requestFullscreen();
  const titles = KPI_TEMPLATE.map(k=>k.title);
  let i=0;
  if(tvInt) clearInterval(tvInt);
  tvInt = setInterval(()=>{
    openInsight(titles[i]);
    i = (i+1) % titles.length;
  },8000);
}

/* ================= INIT ================= */
renderKPICards();
loadKPI();
</script>


</body>
</html>
