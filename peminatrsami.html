<style>
:root{
  --primary:#1e40af;
  --accent:#2563eb;
  --dark:#0f172a;
}

/* RESET */
*{box-sizing:border-box}
body{
  margin:0;
  padding:16px;
  font-family:Segoe UI,Arial,sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
}

/* CARD */
.form-card{
  max-width:1150px;
  margin:auto;
  background:#ffffff;
  border-radius:24px;
  overflow:hidden;
  box-shadow:0 30px 60px rgba(0,0,0,.25);
  animation:fadeUp .8s ease;
}

/* HEADER */
.form-header{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#fff;
  padding:38px 30px;
  text-align:center;
}
.form-header h2{
  margin:0;
  font-size:40px;
}
.form-header p{
  margin-top:10px;
  font-size:40px;
  opacity:.95;
}

/* FORM BODY */
form{
  padding:36px 32px 44px;
}
label{
  font-weight:600;
  display:block;
  margin-top:18px;
  color:var(--dark);
  font-size:24px; /* TAMBAH INI */
}
input,select,textarea{
  width:100%;
  margin-top:6px;
  padding:12px;
  border-radius:12px;
  border:1px solid #cbd5f5;
  font-size:18px;
}
textarea{
  min-height:150px;
  resize:vertical;
}
.note{
  font-size:16px;
  color:#475569;
  margin-top:6px;
}
.hidden{display:none}

/* BUTTON */
button{
  margin-top:36px;
  width:100%;
  padding:17px;
  font-size:32px;
  font-weight:700;
  color:#fff;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  border:none;
  border-radius:40px;
  cursor:pointer;
  transition:.3s;
  animation:pulse 2.4s infinite;
}
button:hover{
  transform:translateY(-2px);
}

/* ANIMATION */
@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:none}
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(37,99,235,.5)}
  70%{box-shadow:0 0 0 20px rgba(37,99,235,0)}
  100%{box-shadow:0 0 0 0 rgba(37,99,235,0)}
}

/* MOBILE */
@media(max-width:640px){
  body{padding:10px}
  .form-header h2{font-size:24px}
  .form-header p{font-size:15px}
  form{padding:26px 20px}
}
</style>

<div class="form-card">

  <div class="form-header">
    <h2>Form Pendataan Peminat SDM Kesehatan</h2>
    <p>RSUD Aji Muhammad Idris Muara Badak</p>
  </div>

  <form id="form">

    <label>Nama Lengkap dengan Gelar</label>
    <input id="nama" required>

    <label>Usia (tahun)</label>
    <input type="number" id="usia" required>

    <label>Jenis Kelamin</label>
    <select id="jk" required>
      <option value="">Pilih</option>
      <option>Laki-laki</option>
      <option>Perempuan</option>
    </select>

    <label>Alamat sesuai KTP</label>
    <textarea id="alamatKTP" required></textarea>

    <label>Alamat Domisili</label>
    <textarea id="alamatDomisili" required></textarea>

    <label>Pendidikan Terakhir</label>
    <input id="pendidikan" required>

    <label>Jurusan/ Keahlian</label>
    <input id="jurusan" required>

    <label>Riwayat Pekerjaan</label>
    <textarea id="riwayat"
      placeholder="Tuliskan riwayat pekerjaan secara lengkap"></textarea>

    <label>Jenis SDMK</label>
    <select id="jenisSDMK" required onchange="cekSDMK()">
      <option value="">Pilih</option>
      <option>Tenaga Medis</option>
      <option>Tenaga Kesehatan</option>
      <option>Tenaga Pendukung / Penunjang</option>
    </select>

   <div id="blokSTR" class="hidden">
  <label>Nomor STR Aktif</label>
  <input id="str" placeholder="Isi nomor STR aktif">
  <div class="note">
    Isi <strong>000000000000</strong> bila bukan klinisi
    (Profesional Pemberi Asuhan).
  </div>
</div>

<label>Apakah saat ini bekerja di tempat lain?</label>
<select id="bekerja" required>
  <option value="">Pilih</option>
  <option>Ya</option>
  <option>Tidak</option>
</select>

    <label>Upload Foto Terbaru</label>
    <input type="file" id="foto" accept="image/*">
    <div class="note">
      Foto Ukuran Postcard (4x6 cm), latar merah, tanpa kacamata, tanpa niqab/cadar,
      wajah menghadap depan, tidak tampak gigi, disukai berpakaian kemeja/hem putih polos.
    </div>

    <label>Upload Dokumen dalam 1 File PDF (maksimal 1 MB)</label>
    <input type="file" id="dokumen" accept="application/pdf">
    <div class="note">
      Dokumen berurutan: KTP, NPWP, Ijazah, Transkrip Nilai, Curricculum Vitae (CV), *STR/Serkom/Profesi (khusus named/nakes).
    </div>

    <button type="submit">Kirim Data Sekarang!</button>

  </form>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwnqIHUvf3ZOZiz8goTBdkhrZmPj9_0y0kXepeWYVegC9Uz-g5JhQ3JVpc4dNQXjFza/exec"; // URL Web App Script
let submitted = false;

function cekSDMK(){
  const jenis = jenisSDMK.value;

  if(jenis === "Tenaga Medis" || jenis === "Tenaga Kesehatan"){
    // Klinisi / PPA
    blokSTR.classList.remove("hidden");
    str.required = true;
    if(str.value === "000000000000") str.value = "";
  }else{
    // Tenaga Pendukung / Non-Klinisi
    blokSTR.classList.add("hidden");
    str.required = false;
    str.value = "000000000000";
  }
}



function toBase64(file){
  return new Promise(resolve=>{
    const r = new FileReader();
    r.onload = () => resolve(r.result.split(",")[1]);
    r.readAsDataURL(file);
  });
}

form.onsubmit = async e => {
  e.preventDefault();

  // üîí CEGAH KLIK ULANG
  if(submitted) return;

  submitted = true;
  const btn = form.querySelector("button");
  btn.disabled = true;
  btn.innerText = "Mengirim data...";

  const fotoFile = foto.files[0];
  const dokFile = dokumen.files[0];

  const payload = {
    nama:nama.value,
    usia:usia.value,
    jk:jk.value,
    alamatKTP:alamatKTP.value,
    alamatDomisili:alamatDomisili.value,
    pendidikan:pendidikan.value,
    jurusan:jurusan.value,
    riwayat:riwayat.value,
    jenisSDMK:jenisSDMK.value,
    str:str.value,
    bekerja:bekerja.value,
    foto: fotoFile ? {
      name:fotoFile.name,
      type:fotoFile.type,
      data:await toBase64(fotoFile)
    } : null,
    dokumen: dokFile ? {
      name:dokumen.files[0].name,
      type:dokumen.files[0].type,
      data:await toBase64(dokFile)
    } : null
  };

  fetch(API,{
    method:"POST",
    body:JSON.stringify(payload)
  })
  .then(r=>r.json())
  .then(r=>{
    if(r.status==="success"){
      // ‚úÖ BERHASIL
      btn.innerText = "Data berhasil dikirim";
      btn.style.background = "#16a34a"; // hijau
      alert("Data Anda sudah kami catat, terima kasih.");
      form.reset();
      blokSTR.classList.add("hidden");
    }else{
      throw new Error(r.message || "Gagal");
    }
  })
  .catch(err=>{
    // ‚ùå GAGAL ‚Üí tombol aktif lagi
    submitted = false;
    btn.disabled = false;
    btn.innerText = "Kirim Data Pendataan";
    alert("Terjadi kesalahan, silakan coba kembali.");
  });
};
</script>
