<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAK Integrasi PNS - Sistem Pengajuan</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 { font-size: 20px; }
    .header .nav { display: flex; gap: 10px; }
    .header .nav button {
      color: white;
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    .header .nav button:hover { background: rgba(255,255,255,0.3); }
    .header .nav button.active { background: white; color: #1e3c72; }
    
    .content { display: none; padding: 30px; }
    .content.active { display: block; }
    
    /* HOME - Landing Page */
    .hero {
      text-align: center;
      padding: 60px 20px;
    }
    .hero h2 {
      color: #1e3c72;
      font-size: 36px;
      margin-bottom: 20px;
    }
    .hero p {
      color: #666;
      font-size: 18px;
      margin-bottom: 40px;
    }
    .menu-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      max-width: 1000px;
      margin: 0 auto;
    }
    .menu-card {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 40px 30px;
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .menu-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 40px rgba(30,60,114,0.4);
    }
    .menu-card .icon { font-size: 60px; margin-bottom: 20px; }
    .menu-card h3 { font-size: 24px; margin-bottom: 10px; }
    .menu-card p { font-size: 14px; opacity: 0.9; }
    .menu-card.dashboard { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
    .menu-card.admin { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
    
    /* FORM STYLES */
    .form-group { margin-bottom: 20px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
    .form-group label .required { color: #e74c3c; }
    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #2a5298;
    }
    .form-group input[type="file"] { padding: 10px; border-style: dashed; }
    .btn-submit {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    }
    .btn-submit:disabled { background: #ccc; cursor: not-allowed; }
    .message {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }
    .message.success { background: #d4edda; color: #155724; display: block; }
    .message.error { background: #f8d7da; color: #721c24; display: block; }
    
    /* DASHBOARD STYLES */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    .stat-card h3 { color: #666; font-size: 14px; margin-bottom: 10px; }
    .stat-card .number { font-size: 32px; font-weight: bold; color: #1e3c72; }
    
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
      flex-wrap: wrap;
    }
    .search-box { display: flex; gap: 10px; flex: 1; }
    .search-box input {
      padding: 10px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      flex: 1;
      max-width: 300px;
    }
    .search-box button, .btn-filter {
      padding: 10px 20px;
      background: #1e3c72;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .filter-select {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }
    .btn-add {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 8px;
      text-decoration: none;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f8f9fa; font-weight: 600; color: #333; font-size: 13px; }
    tr:hover { background: #f8f9fa; }
    
    .status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status.pending { background: #fff3cd; color: #856404; }
    .status.verified { background: #d4edda; color: #155724; }
    .status.rejected { background: #f8d7da; color: #721c24; }
    
    .actions { display: flex; gap: 5px; }
    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-view { background: #17a2b8; color: white; }
    .btn-edit { background: #ffc107; color: #333; }
    .btn-delete { background: #dc3545; color: white; }
    .btn-download { background: #28a745; color: white; text-decoration: none; }
    .btn-verify { background: #6f42c1; color: white; }
    
    .notes-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 12px;
    }
    
    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #1e3c72;
    }
    .modal-header h2 { color: #1e3c72; }
    .close { font-size: 24px; cursor: pointer; color: #666; }
    .form-group textarea { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; resize: vertical; min-height: 80px; }
    .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
    .btn-cancel { background: #6c757d; color: white; padding: 12px 30px; border: none; border-radius: 8px; cursor: pointer; }
    .btn-save { background: #1e3c72; color: white; padding: 12px 30px; border: none; border-radius: 8px; cursor: pointer; }
    
    .loading { text-align: center; padding: 40px; color: #666; }
    .file-info { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px; }
    .file-info h4 { color: #333; margin-bottom: 10px; font-size: 14px; }
    .file-info ul { list-style: none; font-size: 12px; color: #666; }
    .file-info ul li { margin-bottom: 5px; padding-left: 15px; position: relative; }
    .file-info ul li::before { content: "‚Ä¢"; position: absolute; left: 0; color: #2a5298; }
    .hint { font-size: 12px; color: #666; margin-top: 5px; }
    
    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr; }
      .stats { grid-template-columns: repeat(2, 1fr); }
      .toolbar { flex-direction: column; }
      .search-box { width: 100%; }
      .search-box input { max-width: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìã PAK Integrasi PNS</h1>
      <div class="nav">
        <button class="active" onclick="showPage('home')">üè† Beranda</button>
        <button onclick="showPage('form')">üìù Formulir</button>
        <button onclick="showPage('dashboard')">üìä Dashboard</button>
        <button onclick="showPage('admin')">‚öôÔ∏è Admin</button>
      </div>
    </div>
    
    <!-- HOME PAGE -->
    <div id="home" class="content active">
      <div class="hero">
        <h2>Sistem Pengajuan PAK Integrasi PNS</h2>
        <p>Selamat datang di Sistem Penilaian Angka Kredit Integrasi Jabatan Fungsional</p>
        
        <div class="menu-cards">
          <div class="menu-card" onclick="showPage('form')">
            <div class="icon">üìù</div>
            <h3>Formulir Pengajuan</h3>
            <p>Isi formulir pengajuan PAK Integrasi PNS</p>
          </div>
          <div class="menu-card dashboard" onclick="showPage('dashboard')">
            <div class="icon">üìä</div>
            <h3>Dashboard</h3>
            <p>Lihat status pengajuan Anda</p>
          </div>
          <div class="menu-card admin" onclick="showPage('admin')">
            <div class="icon">‚öôÔ∏è</div>
            <h3>Admin Panel</h3>
            <p>Kelola dan verifikasi pengajuan</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- FORM PAGE -->
    <div id="form" class="content">
      <div id="formMessage" class="message"></div>
      
      <form id="pakForm">
        <h3 style="color: #1e3c72; margin-bottom: 20px; border-bottom: 2px solid #1e3c72; padding-bottom: 10px;">Data Pribadi</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input type="email" id="email" name="email" required placeholder="nama@email.com">
          </div>
          <div class="form-group">
            <label>No. HP <span class="required">*</span></label>
            <input type="tel" id="nohp" name="nohp" required placeholder="081234567890">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Nama Lengkap <span class="required">*</span></label>
            <input type="text" id="namalengkap" name="namalengkap" required>
          </div>
          <div class="form-group">
            <label>NIP <span class="required">*</span></label>
            <input type="text" id="nip" name="nip" required placeholder="18 digit">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>No. Karpeg <span class="required">*</span></label>
            <input type="text" id="nokarpeg" name="nokarpeg" required>
          </div>
          <div class="form-group">
            <label>Tempat, Tanggal Lahir <span class="required">*</span></label>
            <input type="text" id="ttl" name="ttl" required placeholder="Jakarta, 15 Januari 1990">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Pendidikan <span class="required">*</span></label>
            <select id="pendidikan" name="pendidikan" required>
              <option value="">-- Pilih --</option>
              <option value="SMA/SMK">SMA/SMK</option>
              <option value="D3">D3</option>
              <option value="S1/D4">S1/D4</option>
              <option value="S2">S2</option>
              <option value="S3">S3</option>
            </select>
          </div>
          <div class="form-group">
            <label>Jenis Kelamin <span class="required">*</span></label>
            <select id="jeniskelamin" name="jeniskelamin" required>
              <option value="">-- Pilih --</option>
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
          </div>
        </div>
        
        <h3 style="color: #1e3c72; margin: 30px 0 20px 0; border-bottom: 2px solid #1e3c72; padding-bottom: 10px;">Data Kepegawaian</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label>Pangkat/Gol. Ruang <span class="required">*</span></label>
            <select id="pktgol" name="pktgol" required>
              <option value="">-- Pilih --</option>
              <option value="III/a">III/a - Penata Muda</option>
              <option value="III/b">III/b - Penata Muda Tingkat I</option>
              <option value="III/c">III/c - Penata</option>
              <option value="III/d">III/d - Penata Tingkat I</option>
              <option value="IV/a">IV/a - Pembina</option>
              <option value="IV/b">IV/b - Pembina Tingkat I</option>
              <option value="IV/c">IV/c - Pembina Utama Muda</option>
              <option value="IV/d">IV/d - Pembina Utama Madya</option>
              <option value="IV/e">IV/e - Pembina Utama</option>
            </select>
          </div>
          <div class="form-group">
            <label>TMT Pangkat <span class="required">*</span></label>
            <input type="date" id="tmtpangkat" name="tmtpangkat" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Jenis Jabatan Fungsional <span class="required">*</span></label>
            <select id="jenisfungsional" name="jenisfungsional" required>
              <option value="">-- Pilih --</option>
              <option value="JF Guru">JF Guru</option>
              <option value="JF Dosen">JF Dosen</option>
              <option value="JF Peneliti">JF Peneliti</option>
              <option value="JF Arsiparis">JF Arsiparis</option>
              <option value="JF Pustakawan">JF Pustakawan</option>
              <option value="JF Pranata Komputer">JF Pranata Komputer</option>
              <option value="JF Auditor">JF Auditor</option>
              <option value="JF Perawat">JF Perawat</option>
              <option value="JF Lainnya">JF Lainnya</option>
            </select>
          </div>
          <div class="form-group">
            <label>Jenjang JF <span class="required">*</span></label>
            <select id="jenjangfungsional" name="jenjangfungsional" required>
              <option value="">-- Pilih --</option>
              <option value="Terampil">Terampil</option>
              <option value="Mahir">Mahir</option>
              <option value="Penyelia">Penyelia</option>
              <option value="Ahli Pertama">Ahli Pertama</option>
              <option value="Ahli Muda">Ahli Muda</option>
              <option value="Ahli Madya">Ahli Madya</option>
              <option value="Ahli Utama">Ahli Utama</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>TMT JF <span class="required">*</span></label>
            <input type="date" id="tmtjf" name="tmtjf" required>
          </div>
          <div class="form-group">
            <label>Masa Kerja Golongan (Tahun) <span class="required">*</span></label>
            <input type="number" id="masakerjagol" name="masakerjagol" required min="0" placeholder="5">
          </div>
        </div>
        
        <div class="form-group">
          <label>Satuan Kerja <span class="required">*</span></label>
          <select id="satuanKerja" name="satuanKerja" required>
            <option value="">-- Pilih --</option>
            <option value="Kementerian Agama">Kementerian Agama</option>
            <option value="Kementerian Pendidikan">Kementerian Pendidikan</option>
            <option value="Kementerian Kesehatan">Kementerian Kesehatan</option>
            <option value="Kementerian Dalam Negeri">Kementerian Dalam Negeri</option>
            <option value="Kementerian Keuangan">Kementerian Keuangan</option>
            <option value="Provinsi">Provinsi</option>
            <option value="Kabupaten/Kota">Kabupaten/Kota</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </div>
        
        <h3 style="color: #1e3c72; margin: 30px 0 20px 0; border-bottom: 2px solid #1e3c72; padding-bottom: 10px;">Upload Dokumen</h3>
        
        <div class="form-group">
          <label>Upload Dokumen <span class="required">*</span></label>
          <input type="file" id="uploaddokumen" name="uploaddokumen" required accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
          <p class="hint">Format: PDF, JPG, PNG, DOC (Max 10MB)</p>
          <div class="file-info">
            <h4>Dokumen yang diperlukan:</h4>
            <ul>
              <li>SK Pangkat terakhir</li>
              <li>SK Jabatan Fungsional</li>
              <li>Ijazah pendidikan</li>
              <li>SKP 2 tahun terakhir</li>
              <li>PAK terakhir</li>
            </ul>
          </div>
        </div>
        
        <button type="submit" class="btn-submit" id="submitBtn">Kirim Pengajuan</button>
      </form>
    </div>
    
    <!-- DASHBOARD PAGE -->
    <div id="dashboard" class="content">
      <div class="stats">
        <div class="stat-card"><h3>Total</h3><div class="number" id="totalCount">0</div></div>
        <div class="stat-card"><h3>Menunggu</h3><div class="number" id="pendingCount">0</div></div>
        <div class="stat-card"><h3>Terverifikasi</h3><div class="number" id="verifiedCount">0</div></div>
        <div class="stat-card"><h3>Ditolak</h3><div class="number" id="rejectedCount">0</div></div>
      </div>
      
      <div class="toolbar">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Cari nama atau satuan kerja...">
          <button onclick="searchData()">Cari</button>
        </div>
        <select id="filterStatus" class="filter-select" onchange="filterData()">
          <option value="">Semua Status</option>
          <option value="Menunggu">Menunggu</option>
          <option value="Terverifikasi">Terverifikasi</option>
          <option value="Ditolak">Ditolak</option>
        </select>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Lengkap</th>
            <th>Satuan Kerja</th>
            <th>Status</th>
            <th>Catatan</th>
            <th>File</th>
          </tr>
        </thead>
        <tbody id="dataTable">
          <tr><td colspan="6" class="loading">Loading...</td></tr>
        </tbody>
      </table>
    </div>
    
    <!-- ADMIN PAGE -->
    <div id="admin" class="content">
      <h2 style="color: #1e3c72; margin-bottom: 20px;">Panel Admin - Verifikasi Pengajuan</h2>
      
      <div class="stats">
        <div class="stat-card"><h3>Total</h3><div class="number" id="adminTotalCount">0</div></div>
        <div class="stat-card"><h3>Menunggu</h3><div class="number" id="adminPendingCount">0</div></div>
        <div class="stat-card"><h3>Terverifikasi</h3><div class="number" id="adminVerifiedCount">0</div></div>
        <div class="stat-card"><h3>Ditolak</h3><div class="number" id="adminRejectedCount">0</div></div>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Lengkap</th>
            <th>Satuan Kerja</th>
            <th>Status</th>
            <th>Catatan</th>
            <th>Download</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="adminTable">
          <tr><td colspan="7" class="loading">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- MODAL -->
  <div class="modal" id="dataModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Detail</h2>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <form id="editForm">
        <input type="hidden" id="editRow">
        <div class="form-group">
          <label>Nama Lengkap</label>
          <input type="text" id="viewNama" readonly>
        </div>
        <div class="form-group">
          <label>NIP</label>
          <input type="text" id="viewNIP" readonly>
        </div>
        <div class="form-group">
          <label>Satuan Kerja</label>
          <input type="text" id="viewSatuanKerja" readonly>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="viewStatus">
            <option value="Menunggu">Menunggu</option>
            <option value="Terverifikasi">Terverifikasi</option>
            <option value="Ditolak">Ditolak</option>
          </select>
        </div>
        <div class="form-group">
          <label>Catatan</label>
          <textarea id="viewCatatan" placeholder="Masukkan catatan..."></textarea>
        </div>
        <div class="modal-buttons">
          <button type="button" class="btn-cancel" onclick="closeModal()">Batal</button>
          <button type="submit" class="btn-save">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // KONFIGURASI - GANTI DENGAN URL ANDA
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxn1SDDXR8Oq81g_akLYQgnIObsH6ZDmSx2M29BmgscS0uFWN41dVq4VJiTszbJ6l8/exec';
    
    let allData = [];
    let currentPage = 'home';
    
    // Page Navigation
    function showPage(page) {
      document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.header .nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      event.target.classList.add('active');
      currentPage = page;
      
      if (page === 'dashboard' || page === 'admin') {
        loadData();
      }
    }
    
    // Load Data
    async function loadData() {
      try {
        const response = await fetch(WEB_APP_URL + '?action=getData');
        const data = await response.json();
        allData = data;
        
        updateStats(data, 'total', 'pending', 'verified', 'rejected');
        renderTable(data);
        
        if (currentPage === 'admin') {
          updateStats(data, 'adminTotal', 'adminPending', 'adminVerified', 'adminRejected');
          renderAdminTable(data);
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }
    
    function updateStats(data, totalId, pendingId, verifiedId, rejectedId) {
      document.getElementById(totalId + 'Count').textContent = data.length;
      document.getElementById(pendingId + 'Count').textContent = data.filter(d => d.status === 'Menunggu').length;
      document.getElementById(verifiedId + 'Count').textContent = data.filter(d => d.status === 'Terverifikasi').length;
      document.getElementById(rejectedId + 'Count').textContent = data.filter(d => d.status === 'Ditolak').length;
    }
    
    function renderTable(data) {
      const tbody = document.getElementById('dataTable');
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="loading">Tidak ada data</td></tr>';
        return;
      }
      tbody.innerHTML = data.map((row, index) => `
        <tr>
          <td>${index + 1}</td>
          <td><strong>${row.nama}</strong></td>
          <td>${row.satuanKerja}</td>
          <td><span class="status ${row.status === 'Terverifikasi' ? 'verified' : row.status === 'Ditolak' ? 'rejected' : 'pending'}">${row.status}</span></td>
          <td>${row.catatan || '-'}</td>
          <td>${row.fileUrl ? `<a href="${row.fileUrl}" target="_blank" class="btn btn-download">‚¨á</a>` : '-'}</td>
        </tr>
      `).join('');
    }
    
    function renderAdminTable(data) {
      const tbody = document.getElementById('adminTable');
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="loading">Tidak ada data</td></tr>';
        return;
      }
      tbody.innerHTML = data.map((row, index) => `
        <tr>
          <td>${index + 1}</td>
          <td><strong>${row.nama}</strong></td>
          <td>${row.satuanKerja}</td>
          <td><span class="status ${row.status === 'Terverifikasi' ? 'verified' : row.status === 'Ditolak' ? 'rejected' : 'pending'}">${row.status}</span></td>
          <td>
            <input type="text" class="notes-input" value="${row.catatan || ''}" onchange="saveNotes(${row.rowIndex}, this.value)">
          </td>
          <td>${row.fileUrl ? `<a href="${row.fileUrl}" target="_blank" class="btn btn-download">‚¨á</a>` : '-'}</td>
          <td class="actions">
            <button class="btn btn-view" onclick="viewData(${row.rowIndex})">üëÅ</button>
            <button class="btn btn-verify" onclick="verifyData(${row.rowIndex})">‚úì</button>
            <button class="btn btn-delete" onclick="deleteData(${row.rowIndex})">üóë</button>
          </td>
        </tr>
      `).join('');
    }
    
    // Search & Filter
    function searchData() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const filtered = allData.filter(row => 
        row.nama.toLowerCase().includes(query) || 
        row.satuanKerja.toLowerCase().includes(query)
      );
      renderTable(filtered);
    }
    
    function filterData() {
      const status = document.getElementById('filterStatus').value;
      if (status === '') {
        renderTable(allData);
      } else {
        renderTable(allData.filter(row => row.status === status));
      }
    }
    
    // Modal Functions
    function viewData(rowIndex) {
      const row = allData.find(d => d.rowIndex === rowIndex);
      if (!row) return;
      
      document.getElementById('editRow').value = rowIndex;
      document.getElementById('modalTitle').textContent = row.nama;
      document.getElementById('viewNama').value = row.nama;
      document.getElementById('viewNIP').value = row.nip;
      document.getElementById('viewSatuanKerja').value = row.satuanKerja;
      document.getElementById('viewStatus').value = row.status;
      document.getElementById('viewCatatan').value = row.catatan || '';
      document.getElementById('dataModal').classList.add('show');
    }
    
    function closeModal() {
      document.getElementById('dataModal').classList.remove('show');
    }
    
    // CRUD Operations
    document.getElementById('editForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const rowIndex = parseInt(document.getElementById('editRow').value);
      const status = document.getElementById('viewStatus').value;
      const catatan = document.getElementById('viewCatatan').value;
      
      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action: 'updateStatus', rowIndex, status, catatan })
        });
        
        const result = await response.text();
        if (result.includes('SUCCESS')) {
          alert('Berhasil diperbarui!');
          closeModal();
          loadData();
        } else {
          alert('Error: ' + result);
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    });
    
    async function saveNotes(rowIndex, catatan) {
      try {
        await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action: 'updateNotes', rowIndex, catatan })
        });
      } catch (error) {
        console.error('Error:', error);
      }
    }
    
    async function verifyData(rowIndex) {
      if (!confirm('Terverifikasi data ini?')) return;
      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ 
            action: 'updateStatus', 
            rowIndex, 
            status: 'Terverifikasi',
            catatan: 'Terverifikasi ' + new Date().toLocaleString('id-ID')
          })
        });
        const result = await response.text();
        if (result.includes('SUCCESS')) {
          alert('Berhasil diverifikasi!');
          loadData();
        }
      } catch (error) { alert('Error: ' + error.message); }
    }
    
    async function deleteData(rowIndex) {
      if (!confirm('Hapus data ini?')) return;
      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action: 'delete', rowIndex })
        });
        const result = await response.text();
        if (result.includes('SUCCESS')) {
          alert('Berhasil dihapus!');
          loadData();
        }
      } catch (error) { alert('Error: ' + error.message); }
    }
    
    // Form Submit
    document.getElementById('pakForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const fileInput = document.getElementById('uploaddokumen');
      const file = fileInput.files[0];
      
      if (file && file.size > 10 * 1024 * 1024) {
        showMessage('File terlalu besar! Max 10MB', 'error');
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Mengirim...';
      
      try {
        const formData = {
          timestamp: new Date().toISOString(),
          email: document.getElementById('email').value,
          nohp: document.getElementById('nohp').value,
          namalengkap: document.getElementById('namalengkap').value,
          nip: document.getElementById('nip').value,
          nokarpeg: document.getElementById('nokarpeg').value,
          ttl: document.getElementById('ttl').value,
          pendidikan: document.getElementById('pendidikan').value,
          jeniskelamin: document.getElementById('jeniskelamin').value,
          pktgol: document.getElementById('pktgol').value,
          tmtpangkat: document.getElementById('tmtpangkat').value,
          jenisfungsional: document.getElementById('jenisfungsional').value,
          jenjangfungsional: document.getElementById('jenjangfungsional').value,
          tmtjf: document.getElementById('tmtjf').value,
          masakerjagol: document.getElementById('masakerjagol').value,
          satankerja: document.getElementById('satuanKerja').value
        };
        
        if (file) {
          formData.fileName = file.name;
          formData.fileContent = await fileToBase64(file);
          formData.fileType = file.type;
        }
        
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(formData)
        });
        
        const result = await response.text();
        if (result.includes('SUCCESS')) {
          showMessage('Pengajuan berhasil dikirim!', 'success');
          document.getElementById('pakForm').reset();
        } else {
          showMessage('Error: ' + result, 'error');
        }
      } catch (error) {
        showMessage('Error: ' + error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Kirim Pengajuan';
      }
    });
    
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
      });
    }
    
    function showMessage(msg, type) {
      const el = document.getElementById('formMessage');
      el.textContent = msg;
      el.className = 'message ' + type;
      setTimeout(() => el.style.display = 'none', 10000);
    }
    
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) closeModal();
    };
  </script>
</body>
</html>

