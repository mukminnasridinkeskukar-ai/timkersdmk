<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistem Informasi Pengembangan Kompetensi ASN">
    <title>SIPANDI ASN - Sistem Informasi Pengembangan Kompetensi ASN</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ============================================
           VARIABLES & ROOT STYLES
           ============================================ */
        :root {
            --primary-color: #1E88E5;
            --primary-dark: #1565C0;
            --primary-light: #42A5F5;
            --secondary-color: #263238;
            --background-color: #F4F6F9;
            --sidebar-width: 260px;
            --sidebar-collapsed: 70px;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition-speed: 0.3s;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
        }

        [data-theme="dark"] {
            --background-color: #1a1a2e;
            --secondary-color: #16213e;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        /* ============================================
           GLOBAL STYLES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            overflow-x: hidden;
            transition: background-color var(--transition-speed);
        }

        /* ============================================
           SIDEBAR STYLES
           ============================================ */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(135deg, #1E88E5 0%, #1565C0 100%);
            color: white;
            z-index: 1000;
            transition: width var(--transition-speed);
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-logo {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .sidebar.collapsed .sidebar-logo span {
            display: none;
        }

        .sidebar-toggle {
            position: absolute;
            right: -15px;
            top: 25px;
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1001;
            transition: transform var(--transition-speed);
        }

        .sidebar.collapsed .sidebar-toggle i {
            transform: rotate(180deg);
        }

        .sidebar-menu {
            flex: 1;
            padding: 15px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all var(--transition-speed);
            border-left: 3px solid transparent;
            text-decoration: none;
            color: white;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: white;
        }

        .menu-item.active {
            background: rgba(255,255,255,0.15);
            border-left-color: #FFD700;
        }

        .menu-item i {
            width: 30px;
            font-size: 1.1rem;
        }

        .menu-item span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar.collapsed .menu-item span {
            display: none;
        }

        .sidebar.collapsed .menu-item {
            justify-content: center;
            padding: 12px;
        }

        /* ============================================
           MAIN CONTENT STYLES
           ============================================ */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            padding: 20px;
            transition: margin-left var(--transition-speed);
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: var(--sidebar-collapsed);
        }

        /* ============================================
           HEADER STYLES
           ============================================ */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0,0,0,0.05);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* ============================================
           CARD STYLES
           ============================================ */
        .stat-card {
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            opacity: 0.1;
            background: currentColor;
        }

        .stat-card .icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            opacity: 0.2;
        }

        .stat-card .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-card .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .bg-gradient-blue { background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); color: #1565C0; }
        .bg-gradient-green { background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); color: #2E7D32; }
        .bg-gradient-purple { background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 100%); color: #7B1FA2; }
        .bg-gradient-orange { background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); color: #E65100; }

        /* ============================================
           TABLE STYLES
           ============================================ */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .table-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            margin-bottom: 0;
        }

        .table thead th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }

        .table tbody td {
            padding: 12px;
            vertical-align: middle;
            font-size: 0.9rem;
        }

        .table tbody tr:hover {
            background-color: rgba(30, 136, 229, 0.05);
        }

        /* ============================================
           BADGE STYLES
           ============================================ */
        .badge-open {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-closed {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-unavailable {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-admin {
            background: linear-gradient(135deg, #6610f2 0%, #6f42c1 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* ============================================
           FORM & INPUT STYLES
           ============================================ */
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 10px 15px;
            font-size: 0.9rem;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1E88E5 0%, #1565C0 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(30, 136, 229, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            border: none;
        }

        /* ============================================
           LOGIN PAGE STYLES
           ============================================ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1E88E5 0%, #1565C0 50%, #0D47A1 100%);
        }

        .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 4rem;
            color: var(--primary-color);
        }

        .login-logo h2 {
            margin-top: 10px;
            color: var(--secondary-color);
            font-weight: 700;
        }

        .login-logo p {
            color: #666;
            font-size: 0.9rem;
        }

        /* ============================================
           CHART STYLES
           ============================================ */
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }

        /* ============================================
           TOAST NOTIFICATION
           ============================================ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* ============================================
           LOADING SPINNER
           ============================================ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ============================================
           SKELETON LOADING
           ============================================ */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* ============================================
           PAGINATION STYLES
           ============================================ */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .pagination-info {
            color: #666;
            font-size: 0.9rem;
        }

        .pagination {
            margin: 0;
        }

        .page-link {
            border-radius: 8px;
            margin: 0 2px;
            color: var(--primary-color);
        }

        .page-item.active .page-link {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* ============================================
           BUTTON GROUP
           ============================================ */
        .btn-group-action {
            display: flex;
            gap: 5px;
        }

        .btn-action {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .btn-download {
            background: #28a745;
            color: white;
        }

        .btn-download:hover {
            background: #218838;
        }

        .btn-view {
            background: #17a2b8;
            color: white;
        }

        .btn-view:hover {
            background: #138496;
        }

        /* ============================================
           SECTION STYLES
           ============================================ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ============================================
           DARK MODE TOGGLE
           ============================================ */
        .dark-mode-toggle {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: white;
            border: none;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--secondary-color);
            transition: all var(--transition-speed);
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }

        /* ============================================
           RESPONSIVE STYLES
           ============================================ */
        @media (max-width: 992px) {
            .sidebar {
                width: var(--sidebar-collapsed);
            }
            
            .sidebar .sidebar-logo span,
            .sidebar .menu-item span {
                display: none;
            }
            
            .sidebar .menu-item {
                justify-content: center;
                padding: 12px;
            }
            
            .main-content {
                margin-left: var(--sidebar-collapsed);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: var(--sidebar-width);
            }
            
            .sidebar.mobile-show {
                transform: translateX(0);
            }
            
            .sidebar.mobile-show .sidebar-logo span,
            .sidebar.mobile-show .menu-item span {
                display: inline;
            }
            
            .sidebar.mobile-show .menu-item {
                justify-content: flex-start;
                padding: 12px 20px;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .table-filters {
                width: 100%;
            }
            
            .table-filters .form-control,
            .table-filters .form-select {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .stat-card {
                margin-bottom: 15px;
            }
            
            .stat-card .stat-number {
                font-size: 1.5rem;
            }
            
            .stat-card .icon {
                font-size: 2rem;
            }
        }

        /* ============================================
           PRINT STYLES
           ============================================ */
        @media print {
            .sidebar, .header-actions, .table-filters, .pagination-container {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .table-container {
                box-shadow: none;
            }
            
            body {
                background: white;
            }
        }

        /* ============================================
           THEME SWITCH
           ============================================ */
        .theme-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #e0e0e0;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-switch.active {
            background: var(--primary-color);
        }

        .theme-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .theme-switch.active::after {
            transform: translateX(24px);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Login Section -->
    <div id="loginSection" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-graduation-cap"></i>
                <h2>SIPANDAI ASN</h2>
                <p>Sistem Informasi Pengembangan Mutu dan Kompetensi ASN Kesehatan</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" id="username" placeholder="Masukkan username" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" class="form-control" id="password" placeholder="Masukkan password" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-sign-in-alt me-2"></i>Login
                </button>
            </form>
            <div class="text-center mt-3">
                <a href="#" onclick="showSection('dashboard'); return false;" class="text-muted">
                    <i class="fas fa-arrow-left me-1"></i>Kembali ke Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-chevron-left text-primary"></i>
            </div>
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-graduation-cap me-2"></i>
                    <span>SIPANDAI ASN</span>
                </div>
            </div>
            <div class="sidebar-menu">
                <a class="menu-item active" data-section="dashboard" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a class="menu-item" data-section="jadwal" onclick="showSection('jadwal')">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Jadwal Kegiatan</span>
                </a>
                <a class="menu-item" data-section="sertifikat" onclick="showSection('sertifikat')">
                    <i class="fas fa-certificate"></i>
                    <span>Download Sertifikat</span>
                </a>
                <a class="menu-item" data-section="materi" onclick="showSection('materi')">
                    <i class="fas fa-book"></i>
                    <span>Download Materi</span>
                </a>
                <a class="menu-item admin-only" id="adminMenu" data-section="admin" onclick="checkAdminAccess()" style="display: none;">
                    <i class="fas fa-cogs"></i>
                    <span>Admin</span>
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="content-header">
                    <h1 class="page-title">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </h1>
                    <div class="header-actions">
                        <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                            <i class="fas fa-moon" id="darkModeIcon"></i>
                        </button>
                        <button class="btn btn-primary" onclick="refreshData()">
                            <i class="fas fa-sync-alt me-2"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-blue">
                            <i class="fas fa-calendar-check icon"></i>
                            <div class="stat-number" data-count="0" id="totalActivities">0</div>
                            <div class="stat-label">Total Kegiatan</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-green">
                            <i class="fas fa-users icon"></i>
                            <div class="stat-number" data-count="0" id="totalParticipants">0</div>
                            <div class="stat-label">Total Peserta</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-purple">
                            <i class="fas fa-clock icon"></i>
                            <div class="stat-number" data-count="0" id="totalJP">0</div>
                            <div class="stat-label">Total JP</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-orange">
                            <i class="fas fa-chalkboard-teacher icon"></i>
                            <div class="stat-number" data-count="0" id="totalSpeakers">0</div>
                            <div class="stat-label">Total Narasumber</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">
                            <i class="fas fa-list me-2"></i>Jadwal Kegiatan Terbaru
                        </h3>
                        <button class="btn btn-primary" onclick="showSection('jadwal')">
                            <i class="fas fa-eye me-2"></i>Lihat Semua
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="dashboardTable">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tema</th>
                                    <th>Tanggal</th>
                                    <th>JP</th>
                                    <th>Narasumber</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Jadwal Kegiatan Section -->
            <section id="jadwal" class="section">
                <div class="content-header">
                    <h1 class="page-title">
                        <i class="fas fa-calendar-alt me-2"></i>Jadwal Kegiatan
                    </h1>
                    <div class="header-actions">
                        <button class="btn btn-success" onclick="exportToExcel('jadwalTable', 'Jadwal_Kegiatann')">
                            <i class="fas fa-file-excel me-2"></i>Export Excel
                        </button>
                        <button class="btn btn-primary" onclick="window.print()">
                            <i class="fas fa-print me-2"></i>Print
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Data Jadwal Kegiatan</h3>
                    </div>
                    <div class="table-filters mb-3">
                        <input type="text" class="form-control" id="searchJadwal" placeholder="Search tema..." style="max-width: 250px;">
                        <select class="form-select" id="filterTema" style="max-width: 200px;">
                            <option value="">Semua Tema</option>
                        </select>
                        <select class="form-select" id="filterNarasumber" style="max-width: 200px;">
                            <option value="">Semua Narasumber</option>
                        </select>
                        <input type="date" class="form-control" id="filterTanggal" style="max-width: 180px;">
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="jadwalTable">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('jadwalTable', 0)">No <i class="fas fa-sort"></i></th>
                                    <th onclick="sortTable('jadwalTable', 1)">Tema <i class="fas fa-sort"></i></th>
                                    <th onclick="sortTable('jadwalTable', 2)">Tanggal <i class="fas fa-sort"></i></th>
                                    <th>Jam Mulai</th>
                                    <th>Jam Selesai</th>
                                    <th>Narasumber</th>
                                    <th>JP</th>
                                    <th>Max Peserta</th>
                                    <th>Tgl Mulai Daftar</th>
                                    <th>Tgl Selesai Daftar</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="jadwalTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination-container">
                        <div class="pagination-info" id="jadwalPaginationInfo">Menampilkan 0 dari 0 data</div>
                        <nav>
                            <ul class="pagination" id="jadwalPagination"></ul>
                        </nav>
                    </div>
                </div>
            </section>

            <!-- Download Sertifikat Section -->
            <section id="sertifikat" class="section">
                <div class="content-header">
                    <h1 class="page-title">
                        <i class="fas fa-certificate me-2"></i>Download Sertifikat
                    </h1>
                    <div class="header-actions">
                        <button class="btn btn-success" onclick="exportToExcel('sertifikatTable', 'Sertifikat_Peserta')">
                            <i class="fas fa-file-excel me-2"></i>Export Excel
                        </button>
                        <button class="btn btn-primary" onclick="window.print()">
                            <i class="fas fa-print me-2"></i>Print
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Daftar Sertifikat Peserta</h3>
                    </div>
                    <div class="table-filters mb-3">
                        <input type="text" class="form-control" id="searchSertifikat" placeholder="Search nama peserta..." style="max-width: 250px;">
                        <select class="form-select" id="filterUnitKerja" style="max-width: 200px;">
                            <option value="">Semua Unit Kerja</option>
                        </select>
                        <select class="form-select" id="filterTemaSertifikat" style="max-width: 200px;">
                            <option value="">Semua Tema</option>
                        </select>
                        <input type="date" class="form-control" id="filterTanggalSertifikat" style="max-width: 180px;">
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="sertifikatTable">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Peserta</th>
                                    <th>Unit Kerja</th>
                                    <th>Tanggal Kegiatan</th>
                                    <th>Tema</th>
                                    <th>JP</th>
                                    <th>Download</th>
                                </tr>
                            </thead>
                            <tbody id="sertifikatTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination-container">
                        <div class="pagination-info" id="sertifikatPaginationInfo">Menampilkan 0 dari 0 data</div>
                        <nav>
                            <ul class="pagination" id="sertifikatPagination"></ul>
                        </nav>
                    </div>
                </div>
            </section>

            <!-- Download Materi Section -->
            <section id="materi" class="section">
                <div class="content-header">
                    <h1 class="page-title">
                        <i class="fas fa-book me-2"></i>Download Materi
                    </h1>
                    <div class="header-actions">
                        <button class="btn btn-success" onclick="exportToExcel('materiTable', 'Materi_Kegiatann')">
                            <i class="fas fa-file-excel me-2"></i>Export Excel
                        </button>
                        <button class="btn btn-primary" onclick="window.print()">
                            <i class="fas fa-print me-2"></i>Print
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Materi Kegiatan</h3>
                    </div>
                    <div class="table-filters mb-3">
                        <input type="text" class="form-control" id="searchMateri" placeholder="Search tema..." style="max-width: 250px;">
                        <select class="form-select" id="filterNarasumberMateri" style="max-width: 200px;">
                            <option value="">Semua Narasumber</option>
                        </select>
                        <input type="date" class="form-control" id="filterTanggalMateri" style="max-width: 180px;">
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="materiTable">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Tanggal Kegiatan</th>
                                    <th>Tema</th>
                                    <th>Narasumber</th>
                                    <th>Link Download</th>
                                </tr>
                            </thead>
                            <tbody id="materiTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination-container">
                        <div class="pagination-info" id="materiPaginationInfo">Menampilkan 0 dari 0 data</div>
                        <nav>
                            <ul class="pagination" id="materiPagination"></ul>
                        </nav>
                    </div>
                </div>
            </section>

            <!-- Admin Section -->
            <section id="admin" class="section">
                <div class="content-header">
                    <h1 class="page-title">
                        <i class="fas fa-cogs me-2"></i>Dashboard Admin
                    </h1>
                    <div class="header-actions">
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </button>
                    </div>
                </div>

                <!-- Admin Menu -->
                <div class="row mb-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-blue" style="cursor: pointer;" onclick="showAdminSubmenu('kelolaJadwal')">
                            <i class="fas fa-calendar-plus icon"></i>
                            <div class="stat-number">+</div>
                            <div class="stat-label">Kelola Jadwal</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-green" style="cursor: pointer;" onclick="showAdminSubmenu('kelolaPeserta')">
                            <i class="fas fa-user-plus icon"></i>
                            <div class="stat-number">+</div>
                            <div class="stat-label">Kelola Peserta</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-purple" style="cursor: pointer;" onclick="showAdminSubmenu('uploadSertifikat')">
                            <i class="fas fa-upload icon"></i>
                            <div class="stat-number">+</div>
                            <div class="stat-label">Upload Sertifikat</div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card bg-gradient-orange" style="cursor: pointer;" onclick="showAdminSubmenu('uploadMateri')">
                            <i class="fas fa-file-upload icon"></i>
                            <div class="stat-number">+</div>
                            <div class="stat-label">Upload Materi</div>
                        </div>
                    </div>
                </div>

                <!-- Admin Charts -->
                <div class="row mb-4">
                    <div class="col-lg-6">
                        <div class="chart-container">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-bar me-2"></i>Jumlah Kegiatan per Bulan
                            </h3>
                            <canvas id="kegiatannChart"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="chart-container">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-bar me-2"></i>Jumlah Peserta per Kegiatan
                            </h3>
                            <canvas id="pesertaChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="chart-container">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-line me-2"></i>Total JP per Bulan
                            </h3>
                            <canvas id="jpChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        
        // Google Apps Script Web App URL - Ganti dengan URL asli setelah deployment
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzSYOr20V2qrwfkN5CTEv2mWgTqW7NfjTmM_o9LLa3p658kcBz3V1K2nKArbYnJTGFMMQ/exec';
        
        // Dummy data untuk pengembangan
        const DUMMY_DATA = {
            jadwal: [
                { no: 1, tema: "Leadership dan Manajemen ASN", tanggal: "2024-02-15", jamMulai: "08:00", jamSelesai: "16:00", narasumber: "Dr. H. Ahmad, M.Si", jp: 8, maxPeserta: 50, tglMulaiDaftar: "2024-01-20", tglSelesaiDaftar: "2024-02-10", status: "open" },
                { no: 2, tema: "Digital Literacy ASN", tanggal: "2024-02-20", jamMulai: "09:00", jamSelesai: "17:00", narasumber: "Prof. Budi Santoso", jp: 8, maxPeserta: 40, tglMulaiDaftar: "2024-01-25", tglSelesaiDaftar: "2024-02-15", status: "open" },
                { no: 3, tema: "Etika dan Disiplin PNS", tanggal: "2024-03-05", jamMulai: "08:00", jamSelesai: "12:00", narasumber: "Dr. Siti Rahayu", jp: 4, maxPeserta: 60, tglMulaiDaftar: "2024-02-01", tglSelesaiDaftar: "2024-03-01", status: "open" },
                { no: 4, tema: "Manajemen Waktu Produktif", tanggal: "2024-03-10", jamMulai: "08:00", jamSelesai: "16:00", narasumber: "Dr. H. Ahmad, M.Si", jp: 8, maxPeserta: 45, tglMulaiDaftar: "2024-02-15", tglSelesaiDaftar: "2024-03-05", status: "closed" },
                { no: 5, tema: "Kewajiban ASN dan Reforma Agraria", tanggal: "2024-03-15", jamMulai: "09:00", jamSelesai: "15:00", narasumber: "Dr. Ir. Herman, M.T", jp: 6, maxPeserta: 35, tglMulaiDaftar: "2024-02-20", tglSelesaiDaftar: "2024-03-10", status: "closed" },
                { no: 6, tema: "Pelayanan Prima", tanggal: "2024-04-01", jamMulai: "08:00", jamSelesai: "16:00", narasumber: "Dr. Siti Rahayu", jp: 8, maxPeserta: 50, tglMulaiDaftar: "2024-03-01", tglSelesaiDaftar: "2024-03-28", status: "closed" },
                { no: 7, tema: "KEPI dan Anti Korupsi", tanggal: "2024-04-10", jamMulai: "08:00", jamSelesai: "12:00", narasumber: "Prof. Dr. Jono", jp: 4, maxPeserta: 55, tglMulaiDaftar: "2024-03-10", tglSelesaiDaftar: "2024-04-05", status: "closed" },
                { no: 8, tema: "Pengelolaan Keuangan Daerah", tanggal: "2024-04-20", jamMulai: "08:00", jamSelesai: "17:00", narasumber: "Dr. Anwar, M.Ak", jp: 9, maxPeserta: 40, tglMulaiDaftar: "2024-03-20", tglSelesaiDaftar: "2024-04-15", status: "closed" }
            ],
            sertifikat: [
                { no: 1, namaPeserta: "Andi Pratama, S.H", unitKerja: "Dinas Pendidikan", tanggal: "2024-01-10", tema: "Leadership dan Manajemen ASN", jp: 8, link: "#" },
                { no: 2, namaPeserta: "Siti Nurhaliza, S.IP", unitKerja: "BKPSDM", tanggal: "2024-01-10", tema: "Leadership dan Manajemen ASN", jp: 8, link: "#" },
                { no: 3, namaPeserta: "Budi Santoso, A.Md", unitKerja: "Dinas Kesehatan", tanggal: "2024-01-15", tema: "Digital Literacy ASN", jp: 8, link: "" },
                { no: 4, namaPeserta: "Rina Susilowati, S.E", unitKerja: "Dinas PU", tanggal: "2024-01-15", tema: "Digital Literacy ASN", jp: 8, link: "#" },
                { no: 5, namaPeserta: "Hendra Wijaya, S.Kom", unitKerja: "Diskominfo", tanggal: "2024-02-01", tema: "Cyber Security", jp: 6, link: "#" },
                { no: 6, namaPeserta: "Dewi Lestari, S.Psi", unitKerja: "BKD", tanggal: "2024-02-01", tema: "Cyber Security", jp: 6, link: "" }
            ],
            materi: [
                { no: 1, tanggal: "2024-01-10", tema: "Leadership dan Manajemen ASN", narasumber: "Dr. H. Ahmad, M.Si", link: "https://drive.google.com/example1" },
                { no: 2, tanggal: "2024-01-15", tema: "Digital Literacy ASN", narasumber: "Prof. Budi Santoso", link: "https://drive.google.com/example2" },
                { no: 3, tanggal: "2024-02-01", tema: "Cyber Security", narasumber: "Prof. Dr. Jono", link: "" },
                { no: 4, tanggal: "2024-02-10", tema: "Manajemen Keuangan", narasumber: "Dr. Anwar, M.Ak", link: "https://drive.google.com/example3" }
            ]
        };

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let allJadwal = [];
        let allSertifikat = [];
        let allMateri = [];
        let currentPage = { jadwal: 1, sertifikat: 1, materi: 1 };
        const itemsPerPage = 10;
        let charts = {};

        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check login status
            checkLoginStatus();
            
            // Load initial data
            loadDashboardData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Hide loading overlay
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 500);
        });

        // ============================================
        // LOGIN FUNCTIONS
        // ============================================
        
        function checkLoginStatus() {
            const isLoggedIn = sessionStorage.getItem('sipandi_admin_logged_in');
            if (isLoggedIn === 'true') {
                document.getElementById('adminMenu').style.display = 'flex';
            }
        }

        function checkAdminAccess() {
            const isLoggedIn = sessionStorage.getItem('sipandi_admin_logged_in');
            if (isLoggedIn !== 'true') {
                showLogin();
            } else {
                showSection('admin');
                initCharts();
            }
        }

        function showLogin() {
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        function hideLogin() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Demo credentials - Ganti dengan validasi sebenarnya
            if (username === 'admin' && password === 'sipandi2024') {
                sessionStorage.setItem('sipandi_admin_logged_in', 'true');
                showToast('Login berhasil!', 'success');
                hideLogin();
                document.getElementById('adminMenu').style.display = 'flex';
                showSection('admin');
                initCharts();
            } else {
                showToast('Username atau password salah!', 'danger');
            }
        });

        function logout() {
            sessionStorage.removeItem('sipandi_admin_logged_in');
            document.getElementById('adminMenu').style.display = 'none';
            showToast('Logout berhasil!', 'success');
            showSection('dashboard');
        }

        // ============================================
        // NAVIGATION FUNCTIONS
        // ============================================
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionId) {
                    item.classList.add('active');
                }
            });

            // Load data for specific sections
            if (sectionId === 'jadwal') {
                loadJadwalData();
            } else if (sectionId === 'sertifikat') {
                loadSertifikatData();
            } else if (sectionId === 'materi') {
                loadMateriData();
            } else if (sectionId === 'admin') {
                initCharts();
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function toggleDarkMode() {
            const body = document.body;
            const icon = document.getElementById('darkModeIcon');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        }

        // ============================================
        // DATA LOADING FUNCTIONS
        // ============================================
        
        async function loadDashboardData() {
            try {
                // Load from API or use dummy data
                allJadwal = DUMMY_DATA.jadwal;
                
                // Update statistics
                updateStatistics();
                
                // Load dashboard table
                renderDashboardTable();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showToast('Gagal memuat data dashboard', 'danger');
            }
        }

        async function loadJadwalData() {
            try {
                allJadwal = DUMMY_DATA.jadwal;
                
                // Populate filter dropdowns
                populateJadwalFilters();
                
                // Render table with pagination
                renderJadwalTable();
                
            } catch (error) {
                console.error('Error loading jadwal data:', error);
                showToast('Gagal memuat data jadwal', 'danger');
            }
        }

        async function loadSertifikatData() {
            try {
                allSertifikat = DUMMY_DATA.sertifikat;
                
                // Populate filter dropdowns
                populateSertifikatFilters();
                
                // Render table with pagination
                renderSertifikatTable();
                
            } catch (error) {
                console.error('Error loading sertifikat data:', error);
                showToast('Gagal memuat data sertifikat', 'danger');
            }
        }

        async function loadMateriData() {
            try {
                allMateri = DUMMY_DATA.materi;
                
                // Populate filter dropdowns
                populateMateriFilters();
                
                // Render table with pagination
                renderMateriTable();
                
            } catch (error) {
                console.error('Error loading materi data:', error);
                showToast('Gagal memuat data materi', 'danger');
            }
        }

        // ============================================
        // STATISTICS FUNCTIONS
        // ============================================
        
        function updateStatistics() {
            // Total activities
            animateCounter('totalActivities', allJadwal.length);
            
            // Total participants (sum from dummy or API)
            const totalPeserta = DUMMY_DATA.sertifikat.length;
            animateCounter('totalParticipants', totalPeserta);
            
            // Total JP
            const totalJP = allJadwal.reduce((sum, item) => sum + (item.jp || 0), 0);
            animateCounter('totalJP', totalJP);
            
            // Total speakers
            const speakers = [...new Set(allJadwal.map(item => item.narasumber))];
            animateCounter('totalSpeakers', speakers.length);
        }

        function animateCounter(elementId, target) {
            const element = document.getElementById(elementId);
            let current = 0;
            const increment = target / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 30);
        }

        // ============================================
        // TABLE RENDERING FUNCTIONS
        // ============================================
        
        function renderDashboardTable() {
            const tbody = document.getElementById('dashboardTableBody');
            const data = allJadwal.slice(0, 5);
            
            tbody.innerHTML = data.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.tema}</td>
                    <td>${formatDate(item.tanggal)}</td>
                    <td><span class="badge bg-primary">${item.jp} JP</span></td>
                    <td>${item.narasumber}</td>
                    <td>
                        ${item.status === 'open' 
                            ? '<span class="badge-open">Pendaftaran Dibuka</span>' 
                            : '<span class="badge-closed">Tutup</span>'}
                    </td>
                </tr>
            `).join('');
        }

        function renderJadwalTable() {
            const searchValue = document.getElementById('searchJadwal').value.toLowerCase();
            const filterTema = document.getElementById('filterTema').value;
            const filterNarasumber = document.getElementById('filterNarasumber').value;
            const filterTanggal = document.getElementById('filterTanggal').value;
            
            let filteredData = allJadwal.filter(item => {
                const matchSearch = item.tema.toLowerCase().includes(searchValue) || 
                                    item.narasumber.toLowerCase().includes(searchValue);
                const matchTema = !filterTema || item.tema === filterTema;
                const matchNarasumber = !filterNarasumber || item.narasumber === filterNarasumber;
                const matchTanggal = !filterTanggal || item.tanggal === filterTanggal;
                
                return matchSearch && matchTema && matchNarasumber && matchTanggal;
            });
            
            // Pagination
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const startIndex = (currentPage.jadwal - 1) * itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, startIndex + itemsPerPage);
            
            const tbody = document.getElementById('jadwalTableBody');
            tbody.innerHTML = paginatedData.map((item, index) => `
                <tr>
                    <td>${startIndex + index + 1}</td>
                    <td>${item.tema}</td>
                    <td>${formatDate(item.tanggal)}</td>
                    <td>${item.jamMulai}</td>
                    <td>${item.jamSelesai}</td>
                    <td>${item.narasumber}</td>
                    <td><span class="badge bg-primary">${item.jp} JP</span></td>
                    <td>${item.maxPeserta}</td>
                    <td>${formatDate(item.tglMulaiDaftar)}</td>
                    <td>${formatDate(item.tglSelesaiDaftar)}</td>
                    <td>
                        ${item.status === 'open' 
                            ? '<span class="badge-open">Pendaftaran Dibuka</span>' 
                            : '<span class="badge-closed">Tutup</span>'}
                    </td>
                </tr>
            `).join('');
            
            // Update pagination info
            document.getElementById('jadwalPaginationInfo').textContent = 
                `Menampilkan ${startIndex + 1} - ${Math.min(startIndex + itemsPerPage, filteredData.length)} dari ${filteredData.length} data`;
            
            // Render pagination
            renderPagination('jadwalPagination', totalPages, 'jadwal');
        }

        function renderSertifikatTable() {
            const searchValue = document.getElementById('searchSertifikat').value.toLowerCase();
            const filterUnit = document.getElementById('filterUnitKerja').value;
            const filterTema = document.getElementById('filterTemaSertifikat').value;
            const filterTanggal = document.getElementById('filterTanggalSertifikat').value;
            
            let filteredData = allSertifikat.filter(item => {
                const matchSearch = item.namaPeserta.toLowerCase().includes(searchValue);
                const matchUnit = !filterUnit || item.unitKerja === filterUnit;
                const matchTema = !filterTema || item.tema === filterTema;
                const matchTanggal = !filterTanggal || item.tanggal === filterTanggal;
                
                return matchSearch && matchUnit && matchTema && matchTanggal;
            });
            
            // Pagination
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const startIndex = (currentPage.sertifikat - 1) * itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, startIndex + itemsPerPage);
            
            const tbody = document.getElementById('sertifikatTableBody');
            tbody.innerHTML = paginatedData.map((item, index) => `
                <tr>
                    <td>${startIndex + index + 1}</td>
                    <td>${item.namaPeserta}</td>
                    <td>${item.unitKerja}</td>
                    <td>${formatDate(item.tanggal)}</td>
                    <td>${item.tema}</td>
                    <td><span class="badge bg-primary">${item.jp} JP</span></td>
                    <td>
                        ${item.link 
                            ? `<a href="${item.link}" target="_blank" class="btn btn-download btn-action" title="Download">
                                <i class="fas fa-download"></i>
                               </a>`
                            : '<span class="badge-unavailable">Belum Terbit</span>'}
                    </td>
                </tr>
            `).join('');
            
            // Update pagination info
            document.getElementById('sertifikatPaginationInfo').textContent = 
                `Menampilkan ${startIndex + 1} - ${Math.min(startIndex + itemsPerPage, filteredData.length)} dari ${filteredData.length} data`;
            
            // Render pagination
            renderPagination('sertifikatPagination', totalPages, 'sertifikat');
        }

        function renderMateriTable() {
            const searchValue = document.getElementById('searchMateri').value.toLowerCase();
            const filterNarasumber = document.getElementById('filterNarasumberMateri').value;
            const filterTanggal = document.getElementById('filterTanggalMateri').value;
            
            let filteredData = allMateri.filter(item => {
                const matchSearch = item.tema.toLowerCase().includes(searchValue);
                const matchNarasumber = !filterNarasumber || item.narasumber === filterNarasumber;
                const matchTanggal = !filterTanggal || item.tanggal === filterTanggal;
                
                return matchSearch && matchNarasumber && matchTanggal;
            });
            
            // Pagination
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const startIndex = (currentPage.materi - 1) * itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, startIndex + itemsPerPage);
            
            const tbody = document.getElementById('materiTableBody');
            tbody.innerHTML = paginatedData.map((item, index) => `
                <tr>
                    <td>${startIndex + index + 1}</td>
                    <td>${formatDate(item.tanggal)}</td>
                    <td>${item.tema}</td>
                    <td>${item.narasumber}</td>
                    <td>
                        ${item.link 
                            ? `<a href="${item.link}" target="_blank" class="btn btn-download btn-action" title="Download">
                                <i class="fas fa-download"></i>
                               </a>`
                            : '<span class="badge-unavailable">Belum Tersedia</span>'}
                    </td>
                </tr>
            `).join('');
            
            // Update pagination info
            document.getElementById('materiPaginationInfo').textContent = 
                `Menampilkan ${startIndex + 1} - ${Math.min(startIndex + itemsPerPage, filteredData.length)} dari ${filteredData.length} data`;
            
            // Render pagination
            renderPagination('materiPagination', totalPages, 'materi');
        }

        // ============================================
        // FILTER POPULATION
        // ============================================
        
        function populateJadwalFilters() {
            const temas = [...new Set(allJadwal.map(item => item.tema))];
            const narasumbers = [...new Set(allJadwal.map(item => item.narasumber))];
            
            const temaSelect = document.getElementById('filterTema');
            const narasumberSelect = document.getElementById('filterNarasumber');
            
            temaSelect.innerHTML = '<option value="">Semua Tema</option>' + 
                temas.map(tema => `<option value="${tema}">${tema}</option>`).join('');
            
            narasumberSelect.innerHTML = '<option value="">Semua Narasumber</option>' + 
                narasumbers.map(narasumber => `<option value="${narasumber}">${narasumber}</option>`).join('');
        }

        function populateSertifikatFilters() {
            const units = [...new Set(allSertifikat.map(item => item.unitKerja))];
            const temas = [...new Set(allSertifikat.map(item => item.tema))];
            
            document.getElementById('filterUnitKerja').innerHTML = '<option value="">Semua Unit Kerja</option>' + 
                units.map(unit => `<option value="${unit}">${unit}</option>`).join('');
            
            document.getElementById('filterTemaSertifikat').innerHTML = '<option value="">Semua Tema</option>' + 
                temas.map(tema => `<option value="${tema}">${tema}</option>`).join('');
        }

        function populateMateriFilters() {
            const narasumbers = [...new Set(allMateri.map(item => item.narasumber))];
            
            document.getElementById('filterNarasumberMateri').innerHTML = '<option value="">Semua Narasumber</option>' + 
                narasumbers.map(narasumber => `<option value="${narasumber}">${narasumber}</option>`).join('');
        }

        // ============================================
        // PAGINATION
        // ============================================
        
        function renderPagination(elementId, totalPages, section) {
            const pagination = document.getElementById(elementId);
            let html = '';
            
            html += `<li class="page-item ${currentPage[section] === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage('${section}', ${currentPage[section] - 1}); return false;">Previous</a>
            </li>`;
            
            for (let i = 1; i <= totalPages; i++) {
                if (totalPages <= 5 || i === 1 || i === totalPages || (i >= currentPage[section] - 1 && i <= currentPage[section] + 1)) {
                    html += `<li class="page-item ${currentPage[section] === i ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage('${section}', ${i}); return false;">${i}</a>
                    </li>`;
                } else if (i === currentPage[section] - 2 || i === currentPage[section] + 2) {
                    html += `<li class="page-item disabled"><a class="page-link">...</a></li>`;
                }
            }
            
            html += `<li class="page-item ${currentPage[section] === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="changePage('${section}', ${currentPage[section] + 1}); return false;">Next</a>
            </li>`;
            
            pagination.innerHTML = html;
        }

        function changePage(section, page) {
            currentPage[section] = page;
            
            if (section === 'jadwal') renderJadwalTable();
            else if (section === 'sertifikat') renderSertifikatTable();
            else if (section === 'materi') renderMateriTable();
            
            // Scroll to top of table
            document.querySelector(`#${section} .table-container`).scrollIntoView({ behavior: 'smooth' });
        }

        // ============================================
        // CHART FUNCTIONS
        // ============================================
        
        function initCharts() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            
            // Chart 1: Activities per month
            const ctx1 = document.getElementById('kegiatannChart').getContext('2d');
            charts.kegiatann = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Jumlah Kegiatan',
                        data: [12, 19, 15, 25, 22, 18],
                        backgroundColor: 'rgba(30, 136, 229, 0.7)',
                        borderColor: '#1E88E5',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Chart 2: Participants per activity
            const ctx2 = document.getElementById('pesertaChart').getContext('2d');
            charts.peserta = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Jumlah Peserta',
                        data: [150, 230, 180, 320, 280, 210],
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        borderColor: '#28a745',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Chart 3: JP per month
            const ctx3 = document.getElementById('jpChart').getContext('2d');
            charts.jp = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Total JP',
                        data: [85, 120, 95, 150, 135, 110],
                        borderColor: '#6610f2',
                        backgroundColor: 'rgba(102, 16, 242, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function formatDate(dateString) {
            if (!dateString) return '-';
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? '-exclamation-circle' : 'info-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            setTimeout(() => toast.remove(), 5000);
        }

        function refreshData() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            setTimeout(() => {
                loadDashboardData();
                document.getElementById('loadingOverlay').style.display = 'none';
                showToast('Data berhasil diperbarui!', 'success');
            }, 1000);
        }

        function sortTable(tableId, columnIndex) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Get header and determine sort direction
            const header = table.querySelectorAll('th')[columnIndex];
            const isAsc = !header.classList.contains('asc');
            
            // Remove sort classes from all headers
            table.querySelectorAll('th').forEach(th => {
                th.classList.remove('asc', 'desc');
            });
            
            // Add sort class to current header
            header.classList.add(isAsc ? 'asc' : 'desc');
            
            // Sort rows
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                
                if (isAsc) {
                    return aValue.localeCompare(bValue, 'id', { numeric: true });
                } else {
                    return bValue.localeCompare(aValue, 'id', { numeric: true });
                }
            });
            
            tbody.append(...rows);
        }

        function exportToExcel(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            
            // Get headers
            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
            csv.push(headers.join(','));
            
            // Get rows
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cols = Array.from(row.querySelectorAll('td')).map(td => {
                    let text = td.textContent.trim();
                    // Escape quotes and wrap in quotes if contains comma
                    if (text.includes(',') || text.includes('"')) {
                        text = '"' + text.replace(/"/g, '""') + '"';
                    }
                    return text;
                });
                csv.push(cols.join(','));
            });
            
            // Download CSV
            const csvContent = csv.join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showToast('File berhasil di-export!', 'success');
        }

        function showAdminSubmenu(menu) {
            showToast(`Fitur ${menu} akan segera tersedia`, 'info');
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        
        function setupEventListeners() {
            // Search listeners
            document.getElementById('searchJadwal').addEventListener('input', () => {
                currentPage.jadwal = 1;
                renderJadwalTable();
            });
            
            document.getElementById('searchSertifikat').addEventListener('input', () => {
                currentPage.sertifikat = 1;
                renderSertifikatTable();
            });
            
            document.getElementById('searchMateri').addEventListener('input', () => {
                currentPage.materi = 1;
                renderMateriTable();
            });
            
            // Filter listeners
            document.getElementById('filterTema').addEventListener('change', () => {
                currentPage.jadwal = 1;
                renderJadwalTable();
            });
            
            document.getElementById('filterNarasumber').addEventListener('change', () => {
                currentPage.jadwal = 1;
                renderJadwalTable();
            });
            
            document.getElementById('filterTanggal').addEventListener('change', () => {
                currentPage.jadwal = 1;
                renderJadwalTable();
            });
            
            document.getElementById('filterUnitKerja').addEventListener('change', () => {
                currentPage.sertifikat = 1;
                renderSertifikatTable();
            });
            
            document.getElementById('filterTemaSertifikat').addEventListener('change', () => {
                currentPage.sertifikat = 1;
                renderSertifikatTable();
            });
            
            document.getElementById('filterTanggalSertifikat').addEventListener('change', () => {
                currentPage.sertifikat = 1;
                renderSertifikatTable();
            });
            
            document.getElementById('filterNarasumberMateri').addEventListener('change', () => {
                currentPage.materi = 1;
                renderMateriTable();
            });
            
            document.getElementById('filterTanggalMateri').addEventListener('change', () => {
                currentPage.materi = 1;
                renderMateriTable();
            });
            
            // Auto refresh every 5 minutes
            setInterval(refreshData, 300000);
            
            // Disable right click on admin page
            document.getElementById('admin').addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showToast('Right click dinonaktifkan untuk keamanan', 'warning');
            });
        }

        // ============================================
        // API FUNCTIONS (Commented for reference)
        // ============================================
        
        /*
        async function fetchFromAPI(sheetName) {
            try {
                const response = await fetch(`${GAS_URL}?sheet=${sheetName}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API Error:', error);
                showToast('Gagal mengambil data dari server', 'danger');
                return null;
            }
        }
        */
    </script>
</body>
</html>
