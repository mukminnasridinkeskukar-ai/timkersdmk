<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard SIMANDAKES</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
  background:#f4f6f9;
}
.card{
  border:none;
  border-radius:14px;
}
.table th{
  background:#0d6efd;
  color:#fff;
  vertical-align:middle;
}
.badge-lowongan{
  background:#198754;
}
</style>
</head>

<body>

<!-- HEADER -->
<nav class="navbar navbar-dark bg-primary">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">SIMANDAKES â€“ Dashboard SDMK</span>
    <a href="#" class="btn btn-light btn-sm">
      <i class="bi bi-plus-circle"></i> Isi Formulir
    </a>
  </div>
</nav>

<!-- CONTENT -->
<div class="container my-4">

  <!-- FILTER -->
  <div class="card p-3 mb-4">
    <div class="row g-3">
      <div class="col-md-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Cari instansi / jabatan...">
      </div>
      <div class="col-md-4">
        <select id="filterJabatan" class="form-select">
          <option value="">Semua Jabatan</option>
        </select>
      </div>
      <div class="col-md-4">
        <select id="filterJenjang" class="form-select">
          <option value="">Semua Jenjang</option>
        </select>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card p-3">
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead>
          <tr>
            <th>Instansi</th>
            <th>Jenis Jabatan</th>
            <th>Jenjang</th>
            <th>Kebutuhan</th>
            <th>Pemangku</th>
            <th>Lowongan</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz4i6s5moFQyJDDJ7GR_enyL3yhF0HVKfNOHCCwxQU5OT4ZRtKgZxkStLvI91RIUB-Ztw/exec";
let dataSDMK = [];

fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    dataSDMK = data;
    populateFilter();
    renderTable(dataSDMK);
  });

function renderTable(data){
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  data.forEach(d => {
    tbody.innerHTML += `
      <tr>
        <td>${d["Instansi/ Institusi Pelayanan Kesehatan"]}</td>
        <td>${d["Jenis Jabatan Fungsional"]}</td>
        <td>${d["Jenjang Jabatan"]}</td>
        <td>${d["Kebutuhan"]}</td>
        <td>${d["Pemangku"]}</td>
        <td>
          <span class="badge badge-lowongan">
            ${d["Lowongan Formasi"]}
          </span>
        </td>
      </tr>`;
  });
}

function populateFilter(){
  const jabatan = [...new Set(dataSDMK.map(d => d["Jenis Jabatan Fungsional"]))];
  const jenjang = [...new Set(dataSDMK.map(d => d["Jenjang Jabatan"]))];

  jabatan.forEach(j => {
    filterJabatan.innerHTML += `<option>${j}</option>`;
  });
  jenjang.forEach(j => {
    filterJenjang.innerHTML += `<option>${j}</option>`;
  });
}

document.getElementById("searchInput").addEventListener("input", applyFilter);
document.getElementById("filterJabatan").addEventListener("change", applyFilter);
document.getElementById("filterJenjang").addEventListener("change", applyFilter);

function applyFilter(){
  const search = searchInput.value.toLowerCase();
  const jabatan = filterJabatan.value;
  const jenjang = filterJenjang.value;

  const filtered = dataSDMK.filter(d =>
    (d["Instansi/ Institusi Pelayanan Kesehatan"].toLowerCase().includes(search) ||
     d["Jenis Jabatan Fungsional"].toLowerCase().includes(search)) &&
    (jabatan === "" || d["Jenis Jabatan Fungsional"] === jabatan) &&
    (jenjang === "" || d["Jenjang Jabatan"] === jenjang)
  );

  renderTable(filtered);
}
</script>

</body>
</html>
