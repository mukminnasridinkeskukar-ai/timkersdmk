<form id="daftarForm">
  <input id="nama" placeholder="Nama Lengkap" required>
  <input id="nip" placeholder="NIP" required>
  <input id="unit" placeholder="Unit Kerja" required>

  <label>Status Pegawai</label>
  <div class="btn-group">
    <button type="button" onclick="pilih(this,'status','PNS')">PNS</button>
    <button type="button" onclick="pilih(this,'status','PPPK')">PPPK</button>
  </div>

  <label>Jenis SDMK</label>
  <div class="btn-group">
    <button type="button" onclick="pilih(this,'jenis','Tenaga Medis')">Tenaga Medis</button>
    <button type="button" onclick="pilih(this,'jenis','Tenaga Kesehatan')">Tenaga Kesehatan</button>
    <button type="button" onclick="pilih(this,'jenis','Tenaga Penunjang')">Tenaga Penunjang</button>
  </div>

  <input id="jp_terakhir" type="number" placeholder="Jumlah JP Terakhir">

  <select id="tema" required>
    <option value="">-- Pilih Tema --</option>
    <option>Optimalisasi Pemanfaatan SKP Platform dan Plataran Sehat</option>
  </select>

  <input id="tanggal" type="date" required>
  <input id="jp" type="number" placeholder="Jumlah JP">

  <label>Platform Digital</label>
  <div class="btn-group">
    <button type="button" onclick="pilih(this,'platform','Zoom')">Zoom</button>
    <button type="button" onclick="pilih(this,'platform','Youtube')">YouTube</button>
  </div>

  <input id="wa" placeholder="Whatsapp" required>
  <input id="email" type="email" placeholder="Email Aktif" required>

  <button class="submit-btn">ğŸš€ KIRIM PENDAFTARAN</button>
</form>

<div id="notif"></div>
<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzcmxXtG-pnVPPO0mK1YWWGc7QSssv15ZcqlHy-UOfA10QP5xkpQ4fSYwZ8g-pfoRvR5w/exec";

let isSubmitting = false;
const pilihan = {};

function pilih(el, field, value){
  el.parentElement.querySelectorAll("button")
    .forEach(b => b.classList.remove("active"));
  el.classList.add("active");
  pilihan[field] = value;
}

const daftarForm = document.getElementById("daftarForm");
const notif = document.getElementById("notif");

daftarForm.addEventListener("submit", async function(e){
  e.preventDefault();
  if (isSubmitting) return;

  if (!pilihan.status || !pilihan.jenis || !pilihan.platform) {
    notif.innerHTML = "âš ï¸ Status, Jenis SDMK, dan Platform wajib dipilih";
    return;
  }

  const data = {
    nama: nama.value.trim(),
    nip: nip.value.trim(),
    unit: unit.value.trim(),
    status: pilihan.status,
    jenis: pilihan.jenis,
    jp_terakhir: jp_terakhir.value,
    tema: tema.value,
    tanggal: tanggal.value,
    jp: jp.value,
    platform: pilihan.platform,
    wa: wa.value.trim(),
    email: email.value.trim()
  };

  isSubmitting = true;
  notif.innerHTML = "â³ Mengirim data...";

  try {
    const res = await fetch(WEBAPP_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    });

    const result = await res.json();

    if (!result.success) {
      notif.innerHTML = "âŒ " + result.message;
      isSubmitting = false;
      return;
    }

    notif.innerHTML = "âœ… " + result.message;
    daftarForm.reset();
    document.querySelectorAll(".btn-group button")
      .forEach(b => b.classList.remove("active"));
    isSubmitting = false;

  } catch (err) {
    console.error(err);
    notif.innerHTML = "âŒ Gagal mengirim data";
    isSubmitting = false;
  }
});
</script>
