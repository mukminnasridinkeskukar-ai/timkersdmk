<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard UKOM JFK</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{background:#f4f6f9;font-family:"Segoe UI",Arial}
.header{
  background:linear-gradient(135deg,#0d6efd,#084298);
  color:#fff;padding:20px;border-radius:16px;margin-bottom:20px
}
.avatar{width:40px;height:40px;border-radius:50%;object-fit:cover}
.avatar-lg{width:120px;height:120px;border-radius:50%;object-fit:cover}
.badge-kategori{background:#0d6efd}
</style>
</head>

<body>
<div class="container py-4">

<div class="header d-flex justify-content-between">
  <div>
    <h4>Dashboard UKOM JFK</h4>
    <small>Monitoring Peserta Uji Kompetensi Jabatan Fungsional</small>
  </div>
  <i class="bi bi-bar-chart fs-1 opacity-50"></i>
</div>

<div class="card rounded-4 shadow-sm">
<table class="table table-hover align-middle mb-0">
<thead class="table-light">
<tr>
<th>Foto</th><th>Nama</th><th>Unit</th><th>Jenis</th>
<th>Jenjang</th><th>Kategori</th><th>JF</th><th>Jenjang Tujuan</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>
</div>
</div>

<!-- MODAL -->
<div class="modal fade" id="profilModal">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content rounded-4">
<div class="modal-header bg-primary text-white">
<h5>Profil Peserta</h5>
<button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div class="row g-4">
<div class="col-md-4 text-center">
<img id="p_foto" class="avatar-lg mb-2">
</div>
<div class="col-md-8">
<h5 id="p_nama"></h5>
<div><b>NIP:</b> <span id="p_nip"></span></div>
<div><b>NIK:</b> <span id="p_nik"></span></div>
<div><b>Unit:</b> <span id="p_unit"></span></div>
<div><b>Jenis:</b> <span id="p_jenis"></span></div>
<div><b>Jenjang:</b> <span id="p_jenjang"></span></div>
<div><b>Pangkat:</b> <span id="p_pangkat"></span></div>
<div><b>PAK:</b> <span id="p_pak"></span></div>
<div><b>STR:</b> <span id="p_str"></span></div>
<div><b>Keputusan:</b> <span id="p_keputusan"></span></div>
</div>
</div>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbycLa6AcmbTTVQLVPTGOgpkcYY2B07eHswJOiXGrJHzfNZ0gVXqLz1h5DOh14DdfUCnog/exec";

fetch(API_URL+"?action=dashboard")
.then(r=>r.json())
.then(data=>{
  tbl.innerHTML="";
  data.forEach(r=>{
    tbl.innerHTML+=`
    <tr onclick="openProfil('${r.nip}')">
      <td><img src="${r.foto}" class="avatar"></td>
      <td><b>${r.nama}</b></td>
      <td>${r.unit}</td>
      <td>${r.jenis}</td>
      <td>${r.jenjang}</td>
      <td><span class="badge badge-kategori">${r.kategori}</span></td>
      <td>${r.jf}</td>
      <td>${r.jenjangTujuan}</td>
    </tr>`;
  });
});

function openProfil(nip){
fetch(API_URL+"?action=profil&nip="+nip)
.then(r=>r.json())
.then(r=>{
  p_foto.src=r.foto;
  p_nama.innerText=r.nama;
  p_nip.innerText=r.nip;
  p_nik.innerText=r.nik;
  p_unit.innerText=r.unit;
  p_jenis.innerText=r.jenis;
  p_jenjang.innerText=r.jenjang;
  p_pangkat.innerText=r.pangkat;
  p_pak.innerText=r.pak;
  p_str.innerText=r.str;
  p_keputusan.innerText=r.keputusan;
  new bootstrap.Modal(document.getElementById("profilModal")).show();
});
}
</script>
</body>
</html>
