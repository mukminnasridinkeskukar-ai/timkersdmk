<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Profil UKOM JFK</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{font-family:Segoe UI;background:#f4f6fb;margin:0;padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px}
.card{background:#fff;border-radius:18px;padding:16px;display:flex;gap:14px;cursor:pointer;box-shadow:0 10px 25px rgba(0,0,0,.08)}
.card img{width:70px;height:70px;border-radius:50%;object-fit:cover}
.card h3{margin:0;font-size:16px}
.card small{color:#64748b}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s}
.modal.show{opacity:1;pointer-events:auto}
.modal-box{background:#fff;border-radius:20px;padding:30px;width:95%;max-width:1200px;display:grid;grid-template-columns:1.2fr .8fr;gap:30px}
.modal img{width:100%;border-radius:20px}
.modal-close{position:absolute;top:14px;right:18px;font-size:26px;border:none;background:none;cursor:pointer}

#loginModal .modal-box{max-width:420px;grid-template-columns:1fr}
input,button{width:100%;padding:12px;border-radius:12px;margin-bottom:12px}
button{background:#2563eb;color:#fff;border:none;font-weight:600}
</style>
</head>

<body>

<h2>üìä Dashboard Profil UKOM JFK</h2>
<div class="grid" id="grid"></div>

<!-- LOGIN -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeLogin()">√ó</button>
    <h3>üîê Login</h3>
    <input id="u" placeholder="Username">
    <input id="p" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div id="msg"></div>
  </div>
</div>

<!-- PROFIL -->
<div class="modal" id="profilModal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeProfil()">√ó</button>
    <div id="profil"></div>
    <div><img id="foto"></div>
  </div>
</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbxYLO-FSni-boiDgrmIvKPf6losA_wBj3RMYY8dd01p_0bqWUMiuXMgFxslCv9gDUXTBw/exec";
const grid = document.getElementById("grid");
const loginModal = document.getElementById("loginModal");
const profilModal = document.getElementById("profilModal");

/* LOAD DASHBOARD */
fetch(URL).then(r=>r.json()).then(d=>{
  d.forEach(x=>{
    grid.innerHTML+=`
    <div class="card" onclick="openLogin()">
      <img src="https://lh3.googleusercontent.com/d/${x.idFotoDrive}">
      <div>
        <h3>${x.namaLengkap}</h3>
        <small>${x.unitKerja}</small><br>
        <small>${x.kategoriPenjenjangan}</small><br>
        <small>${x.jabatanTujuan} ‚Äì ${x.jenjangTujuan}</small>
      </div>
    </div>`;
  });
});

function openLogin(){loginModal.classList.add("show")}
function closeLogin(){loginModal.classList.remove("show")}
function closeProfil(){profilModal.classList.remove("show")}

function login(){
  fetch(URL,{
    method:"POST",
    body:JSON.stringify({action:"login",username:u.value,password:p.value})
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="success"){
      closeLogin();
      showProfil(res.profil);
    }else msg.textContent=res.message;
  });
}

function showProfil(d){
  profilModal.classList.add("show");
  foto.src=`https://lh3.googleusercontent.com/d/${d.idFotoDrive}`;
  profil.innerHTML=`
    <h2>${d.namaLengkap}</h2>
    <div><b>NIK</b>: ${d.nik}</div>
    <div><b>NIP</b>: ${d.nip}</div>
    <div><b>WA</b>: ${d.wa}</div>
    <div><b>Unit</b>: ${d.unitKerja}</div>
    <div><b>Jabatan</b>: ${d.jenisJabatan}</div>
    <div><b>Jenjang</b>: ${d.jenjangJabatan}</div>
    <div><b>PAK</b>: ${d.nilaiPAK}</div>
    <div><b>STR</b>: ${d.nomorSTR}</div>
    <div><b>Keputusan</b>: ${d.keputusanTim}</div>`;
}
</script>
</body>
</html>
