<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard UKOM JFK</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:#f4f6f9}
.hidden{display:none!important}
.avatar{width:42px;height:42px;border-radius:50%;object-fit:cover;cursor:pointer}
#login{position:fixed;inset:0;z-index:9999}
.login-overlay{position:absolute;inset:0;background:rgba(0,0,0,.4)}
.login-box{position:relative;z-index:2;width:360px;margin:auto;border-radius:14px}
.fullscreen{position:fixed;inset:0;background:#fff;z-index:9998;overflow:auto}
#lightbox{position:fixed;inset:0;z-index:10000}
.lightbox-overlay{position:absolute;inset:0;background:rgba(0,0,0,.85)}
#lightbox img{position:relative;max-width:90%;max-height:90%;margin:auto;display:block;top:50%;transform:translateY(-50%);border-radius:12px}
</style>
</head>
<body>

<section id="dashboard" class="container py-4">
<h3 class="mb-3">üìä Dashboard UKOM JFK</h3>
<div class="card shadow-sm">
<div class="table-responsive">
<table class="table table-hover align-middle mb-0 bg-white">
<thead class="table-light">
<tr>
<th>Foto</th><th>Nama</th><th>Unit</th><th>Jenis</th>
<th>Jenjang</th><th>Kategori</th><th>JF</th><th>Jenjang Tujuan</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>
</div>
</div>
</section>

<section id="login" class="hidden d-flex justify-content-center align-items-center">
<div class="login-overlay" onclick="closeLogin()"></div>
<div class="card p-4 login-box shadow">
<h5 class="text-center mb-3">üîê Login Akses Profil</h5>
<input id="user" class="form-control mb-2" placeholder="Username">
<input id="pass" type="password" class="form-control mb-3" placeholder="Password">
<button class="btn btn-primary w-100" onclick="doLogin()">Masuk</button>
<button class="btn btn-link w-100 mt-2" onclick="closeLogin()">Batal</button>
</div>
</section>

<section id="profil" class="fullscreen hidden p-4">
<button class="btn btn-secondary mb-3" onclick="show('dashboard')">‚Üê Kembali</button>
<div class="row">
<div class="col-md-8">
<h4 id="nama"></h4>
<ul class="list-group" id="detail"></ul>
</div>
<div class="col-md-4 text-center">
<img id="foto" class="img-fluid rounded shadow" loading="lazy"
     onclick="openLightbox(this.src)" onerror="this.src=DEFAULT_AVATAR">
</div>
</div>
</section>

<div id="lightbox" class="hidden">
<div class="lightbox-overlay" onclick="closeLightbox()"></div>
<img id="lightboxImg">
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzU5Mjr5hwwGg74b7Z29mQfEUtOKJDbdAdSuvbGX3M2ooymB-adOYttnk_M4GbGmuaqRA/exec";
const DEFAULT_AVATAR="https://ui-avatars.com/api/?name=User&background=0D6EFD&color=fff";
let nipDipilih=null;

function show(id){["dashboard","login","profil"].forEach(x=>document.getElementById(x).classList.add("hidden"));document.getElementById(id).classList.remove("hidden")}
function closeLogin(){nipDipilih=null;show("dashboard")}

fetch(API_URL+"?action=dashboard").then(r=>r.json()).then(rows=>{
  tbl.innerHTML="";
  rows.forEach(r=>{
    const foto=r.foto||DEFAULT_AVATAR;
    tbl.innerHTML+=`
      <tr onclick="bukaLogin('${r.nip}')">
        <td><img src="${foto}" class="avatar" loading="lazy"
                 onerror="this.src='${DEFAULT_AVATAR}'"
                 onclick="event.stopPropagation();openLightbox('${foto}')"></td>
        <td>${r.nama||"-"}</td>
        <td>${r.unit||"-"}</td>
        <td>${r.jenis||"-"}</td>
        <td>${r.jenjang||"-"}</td>
        <td>${r.kategori||"-"}</td>
        <td>${r.jf||"-"}</td>
        <td>${r.jenjangTujuan||"-"}</td>
      </tr>`;
  });
});

function bukaLogin(nip){nipDipilih=nip;show("login")}
function doLogin(){
  fetch(API_URL,{method:"POST",body:JSON.stringify({action:"login",username:user.value.trim(),password:pass.value.trim()})})
  .then(r=>r.json()).then(res=>{ if(res.status) loadProfil(); else alert("Username / Password salah"); });
}

function loadProfil(){
  fetch(API_URL+"?action=profil&nip="+nipDipilih).then(r=>r.json()).then(r=>{
    nama.innerText=r["Nama Lengkap"]||"-";
    foto.src=r["Foto ID"]||DEFAULT_AVATAR;
    const map=[
      ["NIK",r["NIK"]],["NIP",r["NIP"]],["Telp / WA",r["Nomor Telpon/ WA"]],
      ["Unit Kerja",r["Unit Kerja"]],["Jenis Jabatan",r["Jenis Jabatan"]],
      ["Jenjang Jabatan",r["Jenjang Jabatan"]],["Pangkat & Gol",r["Pangkat dan Golongan"]],
      ["Nilai PAK",r["Nilai PAK terakhir"]],["STR",r["Nomor STR"]],
      ["Kategori",r["Kategori Penjenjangan Jabatan"]],
      ["JF Dituju",r["Nama Jabatan Fungsional Yang Dituju"]],
      ["Jenjang Tujuan",r["Jenjang Jabatan Tujuan"]],
      ["Keputusan",r["Keputusan Tim Pengelola Ukom JFK"]]
    ];
    detail.innerHTML="";
    map.forEach(x=>detail.innerHTML+=`<li class="list-group-item"><b>${x[0]}</b>: ${x[1]||"-"}</li>`);
    show("profil");
  });
}

function openLightbox(src){lightboxImg.src=src;document.getElementById("lightbox").classList.remove("hidden")}
function closeLightbox(){document.getElementById("lightbox").classList.add("hidden")}
document.addEventListener("DOMContentLoaded",()=>show("dashboard"));
</script>
</body>
</html>
