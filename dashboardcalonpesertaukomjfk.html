<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard UKOM JFK</title>
<style>
body{font-family:Arial;background:#f4f6f9}
table{width:100%;background:#fff;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #ddd}
tr{cursor:pointer}
.hidden{display:none}
#popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  display:flex;align-items:center;justify-content:center;
}
#popup .box{
  background:#fff;padding:20px;width:420px;border-radius:8px;
}
</style>
</head>

<body>

<h2>Dashboard UKOM JFK</h2>

<table>
<thead>
<tr>
<th>Nama</th>
<th>Unit Kerja</th>
<th>Jenis Jabatan</th>
<th>Jenjang Jabatan</th>
<th>Kategori</th>
<th>JF Dituju</th>
<th>Jenjang Tujuan</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>

<!-- POPUP PROFIL -->
<div id="popup" class="hidden">
  <div class="box">
    <h3 id="p_nama"></h3>
    <p><b>NIP:</b> <span id="p_nip"></span></p>
    <p><b>NIK:</b> <span id="p_nik"></span></p>
    <p><b>Unit:</b> <span id="p_unit"></span></p>
    <p><b>Jenis:</b> <span id="p_jenis"></span></p>
    <p><b>Jenjang:</b> <span id="p_jenjang"></span></p>
    <p><b>Pangkat:</b> <span id="p_pangkat"></span></p>
    <p><b>PAK:</b> <span id="p_pak"></span></p>
    <p><b>STR:</b> <span id="p_str"></span></p>
    <p><b>Keputusan:</b> <span id="p_keputusan"></span></p>
    <button onclick="tutup()">Tutup</button>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbydUZRLGmWvrkv_AHahcZZA7uxjZi9aE4fCEn7NaCoHXKAIrDHJeGOiFLRtr8ja2vwFQg/exec";

/* ===== LOAD DASHBOARD ===== */
fetch(API+"?action=dashboard")
.then(r=>r.json())
.then(data=>{
  console.log("DASHBOARD:",data);
  const tbl=document.getElementById("tbl");
  tbl.innerHTML="";
  data.forEach(r=>{
    tbl.innerHTML+=`
      <tr onclick="buka('${r.nip}')">
        <td>${r.nama}</td>
        <td>${r.unit}</td>
        <td>${r.jenis}</td>
        <td>${r.jenjang}</td>
        <td>${r.kategori}</td>
        <td>${r.jf}</td>
        <td>${r.jenjangTujuan}</td>
      </tr>`;
  });
});

/* ===== POPUP PROFIL ===== */
function buka(nip){
  fetch(API+"?action=profil&nip="+nip)
  .then(r=>r.json())
  .then(r=>{
    console.log("PROFIL:",r);
    if(!r.nip){ alert("Data tidak ditemukan"); return; }

    p_nama.innerText=r.nama;
    p_nip.innerText=r.nip;
    p_nik.innerText=r.nik;
    p_unit.innerText=r.unit;
    p_jenis.innerText=r.jenis;
    p_jenjang.innerText=r.jenjang;
    p_pangkat.innerText=r.pangkat;
    p_pak.innerText=r.pak;
    p_str.innerText=r.str;
    p_keputusan.innerText=r.keputusan;

    document.getElementById("popup").classList.remove("hidden");
  });
}
function tutup(){
  document.getElementById("popup").classList.add("hidden");
}
</script>

</body>
</html>
