<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard UKOM JFK</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f4f6f9;font-family:Segoe UI}
.header{
  background:linear-gradient(135deg,#0d6efd,#084298);
  color:#fff;padding:20px;border-radius:16px;margin-bottom:20px
}
.avatar-lg{
  width:180px;height:180px;border-radius:50%;
  object-fit:cover;border:4px solid #dee2e6
}
</style>
</head>

<body>
<div class="container py-4">

<div class="header">
<h4>Dashboard UKOM JFK</h4>
<small>Monitoring Peserta Uji Kompetensi Jabatan Fungsional</small>
</div>

<div class="card shadow rounded-4">
<table class="table table-hover align-middle mb-0">
<thead class="table-light">
<tr>
<th>Nama</th>
<th>Unit Kerja</th>
<th>Jenis Jabatan</th>
<th>Jenjang</th>
<th>Kategori</th>
<th>JF Dituju</th>
<th>Jenjang Tujuan</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>
</div>
</div>

<!-- LOGIN -->
<div class="modal fade" id="loginModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header bg-primary text-white">
<h5>Login Akses Profil</h5>
</div>
<div class="modal-body">
<input id="user" class="form-control mb-2" placeholder="Username">
<input id="pass" type="password" class="form-control mb-3" placeholder="Password">
<button class="btn btn-primary w-100" onclick="doLogin()">Masuk</button>
</div>
</div>
</div>
</div>

<!-- PROFIL -->
<div class="modal fade" id="profilModal">
<div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
<div class="modal-content">
<div class="modal-header bg-primary text-white">
<h5>Profil Peserta</h5>
<button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div class="row g-4">
<div class="col-md-4 text-center">
<img id="p_foto" class="avatar-lg mb-3">
</div>
<div class="col-md-8">
<h4 id="p_nama"></h4>
<div id="p_detail"></div>
</div>
</div>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzsbfolFR9A5ukBodL72rUfyAXyxbA1gfdOz1bmXXow7Up1RChN_xwMffVZxL2ZorjwgQ/exec";
let nipAktif=null;
const avatar=n=>`https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=0D6EFD&color=fff`;

fetch(API_URL+"?action=dashboard")
.then(r=>r.json())
.then(d=>{
  tbl.innerHTML="";
  d.forEach(r=>{
    tbl.innerHTML+=`
    <tr onclick="askLogin('${r.nip}')">
      <td><b style="cursor:pointer;color:#0d6efd">${r.nama}</b></td>
      <td>${r.unit}</td>
      <td>${r.jenis}</td>
      <td>${r.jenjang}</td>
      <td>${r.kategori}</td>
      <td>${r.jf}</td>
      <td>${r.jenjangTujuan}</td>
    </tr>`;
  });
});

function askLogin(nip){
  nipAktif=nip;
  new bootstrap.Modal(loginModal).show();
}

function doLogin(){
fetch(API_URL,{
method:"POST",
body:JSON.stringify({
action:"login",
username:user.value,
password:pass.value
})
})
.then(r=>r.json())
.then(res=>{
  if(!res.status){alert("Login gagal");return;}
  bootstrap.Modal.getInstance(loginModal).hide();
  openProfil();
});
}

function openProfil(){
fetch(API_URL+"?action=profil&nip="+nipAktif)
.then(r=>r.json())
.then(r=>{
  p_foto.src=r.foto||avatar(r.nama);
  p_nama.innerText=r.nama;
  p_detail.innerHTML=`
<b>NIK:</b> ${r.nik}<br>
<b>NIP:</b> ${r.nip}<br>
<b>Telp:</b> ${r.telp}<br>
<b>Unit:</b> ${r.unit}<br>
<b>Jenis:</b> ${r.jenis}<br>
<b>Jenjang:</b> ${r.jenjang}<br>
<b>Pangkat:</b> ${r.pangkat}<br>
<b>PAK:</b> ${r.pak}<br>
<b>STR:</b> ${r.str}<br>
<b>Kategori:</b> ${r.kategori}<br>
<b>JF Dituju:</b> ${r.jf}<br>
<b>Jenjang Tujuan:</b> ${r.jenjangTujuan}<br><br>
<b>Keputusan:</b><br>${r.keputusan}`;
  new bootstrap.Modal(profilModal).show();
});
}
</script>
</body>
</html>
