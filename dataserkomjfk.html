<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form Sertifikasi Kompetensi JF Kesehatan</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#667eea,#764ba2);
    padding:20px;
}
.container {
    max-width:900px;
    margin:auto;
}
.header, .card {
    background:#fff;
    border-radius:15px;
    padding:25px;
    margin-bottom:20px;
    box-shadow:0 10px 40px rgba(0,0,0,.2);
}
.header {
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:15px;
}
.info-box {
    background:#667eea;
    color:#fff;
    padding:12px 20px;
    border-radius:10px;
    text-align:center;
}
.timer-box { background:#f5576c; }
.label { font-size:.8rem; }
.value { font-size:1.4rem; font-weight:bold; }

.form-row {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:20px;
    margin-bottom:15px;
}
label { font-weight:600; margin-bottom:5px; display:block; }
input, select {
    width:100%;
    padding:12px;
    border-radius:8px;
    border:2px solid #ddd;
}
button {
    background:#667eea;
    color:#fff;
    border:none;
    padding:15px 40px;
    font-size:1rem;
    border-radius:8px;
    cursor:pointer;
}
button:disabled {
    background:#ccc;
    cursor:not-allowed;
}
.message {
    display:none;
    padding:12px;
    border-radius:8px;
    margin-bottom:15px;
}
.success { background:#d4edda; color:#155724; }
.error { background:#f8d7da; color:#721c24; }
.info { background:#cce5ff; color:#004085; }

iframe {
    width:100%;
    height:300px;
    border:1px solid #ccc;
    border-radius:8px;
    display:none;
}
</style>
</head>

<body>
<div class="container">

<div class="header">
    <h2>ðŸ“‹ Form Sertifikasi Kompetensi JF Kesehatan</h2>
    <div style="display:flex;gap:10px">
        <div class="info-box timer-box">
            <div class="label">Sisa Waktu</div>
            <div class="value" id="timer">14:00:00</div>
        </div>
        <div class="info-box">
            <div class="label">Data Terkirim</div>
            <div class="value" id="dataCount">0</div>
        </div>
    </div>
</div>

<div class="card">
<div id="message" class="message"></div>

<form id="serkomForm">
    <div class="form-row">
        <div>
            <label>Nama Lengkap *</label>
            <input type="text" id="nama" required>
        </div>
        <div>
            <label>NIP *</label>
            <input type="text" id="nip" maxlength="18" required>
        </div>
    </div>

    <div class="form-row">
        <div>
            <label>NIK *</label>
            <input type="text" id="nik" maxlength="16" required>
        </div>
        <div>
            <label>Unit Kerja *</label>
            <input type="text" id="unitKerja" required>
        </div>
    </div>

    <div class="form-row">
        <div>
            <label>Jenis Jabatan</label>
            <select id="jenisJabatan">
                <option value="">-- Pilih --</option>
                <option>Dokter</option>
                <option>Perawat</option>
                <option>Bidan</option>
                <option>Apoteker</option>
                <option>Nutrisionis</option>
                <option>Sanitarian</option>
            </select>
        </div>
        <div>
            <label>Tanggal Terbit Serkom *</label>
            <input type="date" id="tanggalTerbit" required>
        </div>
    </div>

    <div class="form-row">
        <div>
            <label>Upload PDF Serkom *</label>
            <input type="file" id="fileSerkom" accept=".pdf" required>
        </div>
    </div>

    <iframe id="pdfPreview"></iframe>

    <br>
    <button type="submit" id="submitBtn">Kirim Data</button>
</form>
</div>

</div>

<script>
/* ===== TIMER ===== */
const TOTAL = 14 * 3600;
let sisa = localStorage.getItem("timer") ? parseInt(localStorage.getItem("timer")) : TOTAL;

function format(t){
    const h=Math.floor(t/3600),m=Math.floor(t%3600/60),s=t%60;
    return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

const timerEl=document.getElementById("timer");
const interval=setInterval(()=>{
    if(sisa<=0){
        timerEl.textContent="00:00:00";
        timerEl.style.color="red";
        disableForm();
        clearInterval(interval);
        localStorage.removeItem("timer");
        return;
    }
    timerEl.textContent=format(sisa);
    localStorage.setItem("timer",sisa);
    sisa--;
},1000);

/* ===== PREVIEW PDF ===== */
const fileInput=document.getElementById("fileSerkom");
const preview=document.getElementById("pdfPreview");

fileInput.addEventListener("change",()=>{
    const file=fileInput.files[0];
    if(file && file.type==="application/pdf"){
        preview.src=URL.createObjectURL(file);
        preview.style.display="block";
    } else {
        preview.style.display="none";
    }
});

/* ===== UTIL ===== */
function disableForm(){
    document.querySelectorAll("input,select,button")
        .forEach(el=>el.disabled=true);
    showMessage("error","â° Waktu habis. Form dikunci.");
}

function showMessage(type,text){
    const m=document.getElementById("message");
    m.className="message "+type;
    m.textContent=text;
    m.style.display="block";
}

/* ===== SUBMIT ===== */
document.getElementById("serkomForm").addEventListener("submit",async e=>{
    e.preventDefault();

    const file=fileInput.files[0];
    if(!file || file.type!=="application/pdf"){
        showMessage("error","File harus PDF");
        return;
    }

    const reader=new FileReader();
    reader.onload=()=>{
        google.script.run
        .withSuccessHandler(()=>{
            showMessage("success","âœ… Data berhasil disimpan");
            document.getElementById("serkomForm").reset();
            preview.style.display="none";
            loadCount();
        })
        .withFailureHandler(err=>{
            showMessage("error",err.message);
        })
        .submitData({
            nama:nama.value,
            nip:nip.value,
            nik:nik.value,
            unitKerja:unitKerja.value,
            jenisJabatan:jenisJabatan.value,
            tanggalTerbit:tanggalTerbit.value,
            fileName:file.name,
            fileData:reader.result.split(",")[1]
        });
    };
    reader.readAsDataURL(file);
});

/* ===== COUNTER ===== */
function loadCount(){
    google.script.run.withSuccessHandler(c=>{
        document.getElementById("dataCount").textContent=c;
    }).getDataCount();
}
loadCount();
</script>
</body>
</html>

