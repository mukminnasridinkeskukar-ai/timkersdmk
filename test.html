<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Pengabdian Masyarakat (Abdimas)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0d9488;
      --primary-dark: #0f766e;
      --accent: #f59e0b;
      --bg: #f0fdfa;
      --card: #ffffff;
      --text: #134e4a;
      --text-muted: #5eead4;
      --border: #99f6e4;
      --shadow: 0 4px 20px rgba(13, 148, 136, 0.12);
      --radius: 16px;
      --radius-sm: 10px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow);
    }
    .header h1 { font-size: 1.25rem; font-weight: 700; }
    .back-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      display: none;
    }
    .back-btn.visible { display: inline-flex; align-items: center; gap: 0.5rem; }
    .back-btn:hover { background: rgba(255,255,255,0.3); }

    .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }

    /* ========== BERANDA ========== */
    #beranda {
      min-height: calc(100vh - 60px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      text-align: center;
    }
    #beranda.hidden { display: none !important; }

    .beranda-title {
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text);
    }
    .beranda-subtitle {
      color: var(--primary);
      font-weight: 500;
      margin-bottom: 3rem;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
      width: 100%;
      max-width: 900px;
    }

    .menu-btn {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 2rem 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      box-shadow: var(--shadow);
    }
    .menu-btn:hover {
      transform: translateY(-4px);
      border-color: var(--primary);
      box-shadow: 0 8px 30px rgba(13, 148, 136, 0.2);
    }
    .menu-btn .icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
    }
    .menu-btn.formulir .icon { background: #ccfbf1; color: var(--primary); }
    .menu-btn.dashboard .icon { background: #fef3c7; color: var(--accent); }
    .menu-btn.galeri .icon { background: #e0e7ff; color: #4f46e5; }
    .menu-btn.admin .icon { background: #fce7f3; color: #db2777; }
    .menu-btn span { font-weight: 600; font-size: 1.1rem; }

    /* ========== SECTION COMMON ========== */
    .section {
      display: none;
      min-height: calc(100vh - 60px);
      padding: 2rem 0;
    }
    .section.active { display: block; }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--text);
    }

    /* ========== FORMULIR ========== */
    .form-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 2rem;
      box-shadow: var(--shadow);
      max-width: 640px;
      margin: 0 auto;
    }
    .form-group {
      margin-bottom: 1.25rem;
    }
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text);
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 1rem;
    }
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }
    .form-group textarea { min-height: 100px; resize: vertical; }
    .btn-submit {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 0.875rem 2rem;
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 0.5rem;
    }
    .btn-submit:hover { opacity: 0.95; transform: translateY(1px); }
    .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .form-status {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: var(--radius-sm);
      display: none;
    }
    .form-status.success { display: block; background: #d1fae5; color: #065f46; }
    .form-status.error { display: block; background: #fee2e2; color: #991b1b; }

    /* ========== DASHBOARD ========== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary);
    }
    .stat-card .value { font-size: 2rem; font-weight: 700; color: var(--primary); }
    .stat-card .label { color: var(--text); font-weight: 500; margin-top: 0.25rem; }
    .table-wrap {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    .data-table th,
    .data-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .data-table th {
      background: var(--primary);
      color: white;
      font-weight: 600;
    }
    .data-table tr:hover { background: #f0fdfa; }
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--text-muted);
    }

    /* ========== GALERI ========== */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.5rem;
    }
    .gallery-item {
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      aspect-ratio: 4/3;
      position: relative;
    }
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .gallery-item .caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 1rem;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      color: white;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .gallery-placeholder {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ccfbf1, #e0f2fe);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-weight: 500;
    }

    /* ========== ADMIN ========== */
    .admin-login {
      max-width: 400px;
      margin: 2rem auto;
      background: var(--card);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .admin-panel { display: none; }
    .admin-panel.visible { display: block; }
    .admin-login.hidden { display: none; }
    .admin-actions {
      margin-bottom: 1.5rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    .btn-logout {
      background: #dc2626;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
    }
    .btn-logout:hover { background: #b91c1c; }

    /* Utility */
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <header class="header">
    <h1>üèòÔ∏è Pengabdian Masyarakat (Abdimas)</h1>
    <button type="button" class="back-btn" id="backBtn" aria-label="Kembali">‚Üê Kembali ke Beranda</button>
  </header>

  <main>
    <!-- BERANDA -->
    <section id="beranda">
      <h2 class="beranda-title">Selamat Datang</h2>
      <p class="beranda-subtitle">Sistem Informasi Pengabdian Masyarakat</p>
      <div class="menu-grid">
        <button type="button" class="menu-btn formulir" data-page="formulir">
          <span class="icon">üìã</span>
          <span>Formulir</span>
          <small style="color:var(--text-muted);font-weight:400;">Isi data kegiatan</small>
        </button>
        <button type="button" class="menu-btn dashboard" data-page="dashboard">
          <span class="icon">üìä</span>
          <span>Dashboard</span>
          <small style="color:var(--text-muted);font-weight:400;">Lihat statistik</small>
        </button>
        <button type="button" class="menu-btn galeri" data-page="galeri">
          <span class="icon">üñºÔ∏è</span>
          <span>Galeri</span>
          <small style="color:var(--text-muted);font-weight:400;">Foto dokumentasi</small>
        </button>
        <button type="button" class="menu-btn admin" data-page="admin">
          <span class="icon">‚öôÔ∏è</span>
          <span>Admin</span>
          <small style="color:var(--text-muted);font-weight:400;">Kelola data</small>
        </button>
      </div>
    </section>

    <!-- FORMULIR -->
    <section id="formulir" class="section">
      <div class="container">
        <h2 class="section-title">Formulir Kegiatan Pengabdian Masyarakat</h2>
        <div class="form-card">
          <form id="formAbdimas">
            <div class="form-group">
              <label for="tanggal_daftar">Tanggal Daftar *</label>
              <input type="date" id="tanggal_daftar" name="tanggal_daftar" required>
            </div>
            <div class="form-group">
              <label for="nama_kegiatan">Nama Kegiatan *</label>
              <input type="text" id="nama_kegiatan" name="nama_kegiatan" required placeholder="Contoh: Pelatihan Digital untuk UMKM">
            </div>
            <div class="form-group">
              <label for="tanggal_pelaksanaan">Tanggal Pelaksanaan *</label>
              <input type="date" id="tanggal_pelaksanaan" name="tanggal_pelaksanaan" required>
            </div>
            <div class="form-group">
              <label for="lokasi">Lokasi *</label>
              <input type="text" id="lokasi" name="lokasi" required placeholder="Contoh: Desa Sukamaju">
            </div>
            <div class="form-group">
              <label for="jumlah_peserta">Jumlah Peserta</label>
              <input type="number" id="jumlah_peserta" name="jumlah_peserta" min="0" placeholder="Contoh: 25">
            </div>
            <div class="form-group">
              <label for="deskripsi_kegiatan">Deskripsi Kegiatan *</label>
              <textarea id="deskripsi_kegiatan" name="deskripsi_kegiatan" required placeholder="Jelaskan ringkasan kegiatan dan hasil..."></textarea>
            </div>
            <div class="form-group">
              <label for="penanggung_jawab">Penanggung Jawab *</label>
              <input type="text" id="penanggung_jawab" name="penanggung_jawab" required placeholder="Nama penanggung jawab">
            </div>
            <div class="form-group">
              <label for="kontak">Kontak *</label>
              <input type="text" id="kontak" name="kontak" required placeholder="No. HP / Email">
            </div>
            <div class="form-group">
              <label for="file_url">File URL (opsional)</label>
              <input type="url" id="file_url" name="file_url" placeholder="Link dokumen/foto (Google Drive, dll)">
            </div>
            <input type="hidden" name="status" value="Pending">
            <button type="submit" class="btn-submit" id="btnSubmit">Kirim ke Google Sheet & Drive</button>
            <div id="formStatus" class="form-status"></div>
          </form>
        </div>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard" class="section">
      <div class="container">
        <h2 class="section-title">Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="value" id="totalKegiatan">0</div>
            <div class="label">Total Kegiatan</div>
          </div>
          <div class="stat-card">
            <div class="value" id="totalBulan">0</div>
            <div class="label">Bulan Ini</div>
          </div>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th>Tanggal Daftar</th>
                <th>Nama Kegiatan</th>
                <th>Tanggal Pelaksanaan</th>
                <th>Lokasi</th>
                <th>Jumlah Peserta</th>
                <th>Penanggung Jawab</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="dashboardTableBody">
              <tr><td colspan="7" class="empty-state">Memuat data dari Google Sheet...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- GALERI -->
    <section id="galeri" class="section">
      <div class="container">
        <h2 class="section-title">Galeri Dokumentasi</h2>
        <div class="gallery-grid" id="galleryGrid">
          <div class="gallery-item">
            <div class="gallery-placeholder">Galeri dari Google Drive</div>
            <span class="caption">Data gambar dari Drive akan tampil di sini</span>
          </div>
        </div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="admin" class="section">
      <div class="container">
        <h2 class="section-title">Panel Admin</h2>
        <div id="adminLogin" class="admin-login">
          <div class="form-group">
            <label for="adminPass">Password Admin</label>
            <input type="password" id="adminPass" placeholder="Masukkan password">
          </div>
          <button type="button" class="btn-submit" id="btnAdminLogin">Masuk</button>
        </div>
        <div id="adminPanel" class="admin-panel">
          <div class="admin-actions">
            <button type="button" class="btn-logout" id="btnLogout">Keluar</button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Tanggal Daftar</th>
                  <th>ID</th>
                  <th>Nama Kegiatan</th>
                  <th>Tanggal Pelaksanaan</th>
                  <th>Lokasi</th>
                  <th>Jumlah Peserta</th>
                  <th>Penanggung Jawab</th>
                  <th>Kontak</th>
                  <th>File URL</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="adminTableBody">
                <tr><td colspan="11" class="empty-state">Login untuk melihat data.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ========== KONFIGURASI GOOGLE SHEET & DRIVE ==========
    // Ganti dengan URL Web App Google Apps Script Anda setelah deploy
    const CONFIG = {
      webAppUrl: 'https://script.google.com/macros/s/AKfycbwqX54hiaj2tEQQL5wZyvfwHPXze0C1XP6QzJDv3TdVczplPSPVUFCpHj4l0R01dSV3Eg/exec', // Contoh: https://script.google.com/macros/s/xxx/exec
      adminPassword: 'abdimas2025' // Ganti dengan password aman
    };

    // ========== NAVIGASI ==========
    const beranda = document.getElementById('beranda');
    const sections = document.querySelectorAll('.section');
    const backBtn = document.getElementById('backBtn');

    function showPage(pageId) {
      beranda.classList.add('hidden');
      sections.forEach(s => {
        s.classList.toggle('active', s.id === pageId);
      });
      backBtn.classList.add('visible');
      if (pageId === 'dashboard') loadDashboard();
      if (pageId === 'galeri') loadGaleri();
      if (pageId === 'admin') loadAdminState();
    }

    function showBeranda() {
      beranda.classList.remove('hidden');
      sections.forEach(s => s.classList.remove('active'));
      backBtn.classList.remove('visible');
    }

    document.querySelectorAll('.menu-btn').forEach(btn => {
      btn.addEventListener('click', () => showPage(btn.dataset.page));
    });
    backBtn.addEventListener('click', showBeranda);

    // Isi otomatis Tanggal Daftar = hari ini
    (function setDefaultTanggalDaftar() {
      const input = document.getElementById('tanggal_daftar');
      if (input && !input.value) {
        const today = new Date().toISOString().slice(0, 10);
        input.value = today;
      }
    })();

    // ========== FORMULIR ‚Üí GOOGLE SHEET & DRIVE ==========
    const form = document.getElementById('formAbdimas');
    const formStatus = document.getElementById('formStatus');
    const btnSubmit = document.getElementById('btnSubmit');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      btnSubmit.disabled = true;
      formStatus.className = 'form-status';
      formStatus.textContent = 'Mengirim...';

      const formData = new FormData(form);
      const payload = {
        tanggal_daftar: formData.get('tanggal_daftar'),
        nama_kegiatan: formData.get('nama_kegiatan'),
        tanggal_pelaksanaan: formData.get('tanggal_pelaksanaan'),
        lokasi: formData.get('lokasi'),
        jumlah_peserta: formData.get('jumlah_peserta') || '',
        deskripsi_kegiatan: formData.get('deskripsi_kegiatan'),
        penanggung_jawab: formData.get('penanggung_jawab'),
        kontak: formData.get('kontak'),
        file_url: formData.get('file_url') || '',
        status: formData.get('status') || 'Pending'
      };

      // Jika Web App URL belum diisi, simpan ke localStorage (demo)
      if (!CONFIG.webAppUrl || CONFIG.webAppUrl.startsWith('GANTI')) {
        const simpanan = JSON.parse(localStorage.getItem('abdimas_data') || '[]');
        const id = 'ABD-' + Date.now();
        const timestamp = new Date().toISOString();
        simpanan.push({ ...payload, id, timestamp });
        localStorage.setItem('abdimas_data', JSON.stringify(simpanan));
        formStatus.className = 'form-status success';
        formStatus.textContent = 'Data tersimpan secara lokal. Pasang URL Google Apps Script di CONFIG.webAppUrl untuk kirim ke Sheet & Drive.';
        form.reset();
        btnSubmit.disabled = false;
        return;
      }

      // Kirim ke Google Apps Script via form POST (andal tanpa CORS)
      form.setAttribute('action', CONFIG.webAppUrl);
      form.setAttribute('method', 'post');
      const iframe = document.createElement('iframe');
      iframe.name = 'abdimas-iframe';
      iframe.style.display = 'none';
      document.body.appendChild(iframe);
      form.setAttribute('target', 'abdimas-iframe');
      form.submit();
      setTimeout(() => {
        form.removeAttribute('action');
        form.removeAttribute('method');
        form.removeAttribute('target');
        iframe.remove();
        formStatus.className = 'form-status success';
        formStatus.textContent = 'Data berhasil dikirim ke Google Sheet.';
        form.reset();
        btnSubmit.disabled = false;
      }, 1500);
    });

    // ========== DASHBOARD (baca dari Sheet / localStorage) ==========
    function loadDashboard() {
      const tbody = document.getElementById('dashboardTableBody');
      if (CONFIG.webAppUrl && !CONFIG.webAppUrl.startsWith('GANTI')) {
        fetch(CONFIG.webAppUrl + '?action=getData')
          .then(r => r.json())
          .then(data => {
            renderDashboardTable(tbody, data.rows || []);
            document.getElementById('totalKegiatan').textContent = (data.rows || []).length;
            const thisMonth = new Date().getMonth();
            const bulanIni = (data.rows || []).filter(r => new Date(r.tanggal_daftar || r.tanggal_pelaksanaan).getMonth() === thisMonth).length;
            document.getElementById('totalBulan').textContent = bulanIni;
          })
          .catch(() => {
            const local = JSON.parse(localStorage.getItem('abdimas_data') || '[]');
            renderDashboardTable(tbody, local);
            document.getElementById('totalKegiatan').textContent = local.length;
            const thisMonth = new Date().getMonth();
            const bulanIni = local.filter(r => new Date(r.tanggal_daftar || r.tanggal_pelaksanaan).getMonth() === thisMonth).length;
            document.getElementById('totalBulan').textContent = bulanIni;
          });
      } else {
        const local = JSON.parse(localStorage.getItem('abdimas_data') || '[]');
        renderDashboardTable(tbody, local);
        document.getElementById('totalKegiatan').textContent = local.length;
        const thisMonth = new Date().getMonth();
        const bulanIni = local.filter(r => new Date(r.tanggal_daftar || r.tanggal_pelaksanaan).getMonth() === thisMonth).length;
        document.getElementById('totalBulan').textContent = bulanIni;
      }
    }

    function renderDashboardTable(tbody, rows) {
      if (!rows.length) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Belum ada data.</td></tr>';
        return;
      }
      tbody.innerHTML = rows.map(r => `
        <tr>
          <td>${formatDate(r.tanggal_daftar)}</td>
          <td>${escapeHtml(r.nama_kegiatan)}</td>
          <td>${formatDate(r.tanggal_pelaksanaan)}</td>
          <td>${escapeHtml(r.lokasi)}</td>
          <td>${escapeHtml(r.jumlah_peserta)}</td>
          <td>${escapeHtml(r.penanggung_jawab)}</td>
          <td>${escapeHtml(r.status)}</td>
        </tr>
      `).join('');
    }

    // ========== GALERI (dari Drive / placeholder) ==========
    function loadGaleri() {
      const grid = document.getElementById('galleryGrid');
      if (CONFIG.webAppUrl && !CONFIG.webAppUrl.startsWith('GANTI')) {
        fetch(CONFIG.webAppUrl + '?action=getGallery')
          .then(r => r.json())
          .then(data => {
            renderGaleri(grid, data.items || []);
          })
          .catch(() => renderGaleri(grid, []));
      } else {
        renderGaleri(grid, []);
      }
    }

    function renderGaleri(grid, items) {
      if (!items.length) {
        grid.innerHTML = `
          <div class="gallery-item">
            <div class="gallery-placeholder">Galeri dari Google Drive</div>
            <span class="caption">Sambungkan Web App untuk menampilkan foto dari Drive</span>
          </div>`;
        return;
      }
      grid.innerHTML = items.map(item => `
        <div class="gallery-item">
          <img src="${escapeHtml(item.url)}" alt="${escapeHtml(item.caption || '')}" loading="lazy">
          <span class="caption">${escapeHtml(item.caption || 'Dokumentasi')}</span>
        </div>
      `).join('');
    }

    // ========== ADMIN ==========
    const adminLogin = document.getElementById('adminLogin');
    const adminPanel = document.getElementById('adminPanel');
    const adminTableBody = document.getElementById('adminTableBody');

    function loadAdminState() {
      if (sessionStorage.getItem('abdimas_admin') === '1') {
        adminLogin.classList.add('hidden');
        adminPanel.classList.add('visible');
        loadAdminTable();
      } else {
        adminLogin.classList.remove('hidden');
        adminPanel.classList.remove('visible');
      }
    }

    document.getElementById('btnAdminLogin').addEventListener('click', () => {
      if (document.getElementById('adminPass').value === CONFIG.adminPassword) {
        sessionStorage.setItem('abdimas_admin', '1');
        loadAdminState();
      } else {
        alert('Password salah.');
      }
    });

    document.getElementById('btnLogout').addEventListener('click', () => {
      sessionStorage.removeItem('abdimas_admin');
      loadAdminState();
    });

    function renderAdminTable(rows) {
      if (!rows.length) {
        adminTableBody.innerHTML = '<tr><td colspan="11" class="empty-state">Belum ada data.</td></tr>';
        return;
      }
      adminTableBody.innerHTML = rows.map(r => `
        <tr>
          <td>${escapeHtml(r.timestamp != null ? (typeof r.timestamp === 'string' ? r.timestamp : formatDate(r.timestamp)) : '-')}</td>
          <td>${formatDate(r.tanggal_daftar)}</td>
          <td>${escapeHtml(r.id || '-')}</td>
          <td>${escapeHtml(r.nama_kegiatan)}</td>
          <td>${formatDate(r.tanggal_pelaksanaan)}</td>
          <td>${escapeHtml(r.lokasi)}</td>
          <td>${escapeHtml(r.jumlah_peserta)}</td>
          <td>${escapeHtml(r.penanggung_jawab)}</td>
          <td>${escapeHtml(r.kontak)}</td>
          <td>${r.file_url ? '<a href="' + escapeHtml(r.file_url) + '" target="_blank" rel="noopener">Link</a>' : '-'}</td>
          <td>${escapeHtml(r.status)}</td>
        </tr>
      `).join('');
    }

    function loadAdminTable() {
      if (CONFIG.webAppUrl && !CONFIG.webAppUrl.startsWith('GANTI')) {
        fetch(CONFIG.webAppUrl + '?action=getData')
          .then(r => r.json())
          .then(data => renderAdminTable(data.rows || []))
          .catch(() => {
            const local = JSON.parse(localStorage.getItem('abdimas_data') || '[]');
            renderAdminTable(local);
          });
      } else {
        const local = JSON.parse(localStorage.getItem('abdimas_data') || '[]');
        renderAdminTable(local);
      }
    }

    function formatDate(str) {
      if (!str) return '-';
      const d = new Date(str);
      return isNaN(d.getTime()) ? str : d.toLocaleDateString('id-ID');
    }
    function escapeHtml(s) {
      if (s == null) return '';
      const div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }
  </script>
</body>
</html>
