<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Aplikasi Keselamatan Pasien Puskesmas</title>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#f1f5f9;
  padding:20px
}
.box{
  max-width:1400px;
  margin:auto;
  background:#fff;
  padding:30px;
  border-radius:20px;
  box-shadow:0 15px 35px rgba(0,0,0,.15)
}
label{font-weight:600}
input,select,button{
  width:100%;
  padding:14px;
  margin:8px 0 18px;
  border-radius:14px;
  border:1px solid #cbd5e1;
  font-size:16px
}
button{
  background:#0f766e;
  color:#fff;
  font-weight:800;
  border:none;
  cursor:pointer
}
.result{
  padding:20px;
  border-radius:14px;
  margin-top:20px
}
.low{background:#dcfce7;color:#14532d}
.mid{background:#fef9c3;color:#713f12}
.high{background:#ffedd5;color:#7c2d12}
.veryhigh{background:#fee2e2;color:#7f1d1d}
h3{margin-top:0}
ul{margin:10px 0 0 18px}
</style>
</head>

<body>

<div class="box">
<h2>ğŸ›¡ï¸ Identifikasi Keselamatan Pasien (IKP) di Puskesmas</h2>

<label>Nama Puskesmas</label>
<select id="puskesmas">
  <option value="">-- Pilih Puskesmas --</option>
  <option>UTPD Puskesmas Rimba Ayu</option>
  <option>UPTD Puskesmas Batuah</option>
  <option>UPTD Puskesmas Bunga Jadi</option>
  <option>UPTD Puskesmas Handil Baru</option>
  <option>UPTD Puskesmas Kota Bangun</option>
  <option>UPTD Puskesmas Loa Kulu</option>
  <option>UPTD Puskesmas Loa Ipuh</option>
</select>

<input id="unit" placeholder="Unit Layanan">
<input id="tanggal" type="date">

<h3>ğŸ” Penilaian Keselamatan Pasien</h3>

<p style="margin-top:-8px;margin-bottom:12px;font-size:14px;color:#475569">
<b>Petunjuk Pengisian Skor:</b><br>
1 = Tidak diterapkan<br>
2 = Diterapkan sebagian<br>
3 = Diterapkan cukup<br>
4 = Diterapkan baik<br>
5 = Diterapkan sangat baik
</p>

<label>Identifikasi Pasien</label>
<select id="a">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Komunikasi Efektif</label>
<select id="b">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Keamanan Obat</label>
<select id="c">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Pencegahan Infeksi</label>
<select id="d">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Keselamatan Tindakan</label>
<select id="e">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Risiko Jatuh</label>
<select id="f">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<label>Pelaporan Insiden</label>
<select id="g">
  <option value="">-- Pilih Angka 1â€“5 --</option>
  <option value="1">1</option><option value="2">2</option>
  <option value="3">3</option><option value="4">4</option>
  <option value="5">5</option>
</select>

<button onclick="simpan()">Hitung & Simpan</button>

<div id="hasil"></div>
</div>

<script>
const URL_API="https://script.google.com/macros/s/AKfycbzv9rQbQPVOZy6N6LQVj_Y8CF_i1jeQtFn1DyUVChyxOvN9jLUK8T77e3abUh6coVJLXg/exec";

function simpan(){
  const ids=["a","b","c","d","e","f","g"];
  let v=[];

  for(let i of ids){
    const el=document.getElementById(i);
    if(!el.value){
      alert("Semua indikator WAJIB dipilih (1â€“5)");
      return;
    }
    v.push(+el.value);
  }

  if(!puskesmas.value || !unit.value || !tanggal.value){
    alert("Nama Puskesmas, Unit, dan Tanggal wajib diisi");
    return;
  }

  let total=v.reduce((x,y)=>x+y,0);
  let kategori="",rekom="",narasi="",cls="";

  if(total>=29){
    kategori="ğŸŸ¢ Risiko Rendah"; cls="low";
    rekom="<ul><li>Monitoring rutin indikator mutu</li><li>Pemeliharaan SOP</li><li>Evaluasi berkala unit</li></ul>";
    narasi="Risiko rendah, dilakukan monitoring dan pemeliharaan SOP.";
  }
  else if(total>=22){
    kategori="ğŸŸ¡ Risiko Sedang"; cls="mid";
    rekom="<ul><li>Review SOP</li><li>Supervisi unit</li><li>Sosialisasi kebijakan</li></ul>";
    narasi="Risiko sedang, diperlukan perbaikan SOP dan supervisi.";
  }
  else if(total>=15){
    kategori="ğŸŸ  Risiko Tinggi"; cls="high";
    rekom="<ul><li>Rapat mutu</li><li>Pelatihan ulang</li><li>Audit internal terbatas</li></ul>";
    narasi="Risiko tinggi, perlu rapat mutu dan audit.";
  }
  else{
    kategori="ğŸ”´ Risiko Sangat Tinggi"; cls="veryhigh";
    rekom="<ul><li>Audit menyeluruh</li><li>RCA</li><li>Intervensi pimpinan</li></ul>";
    narasi="Risiko sangat tinggi, perlu audit dan intervensi pimpinan.";
  }

  hasil.className="result "+cls;
  hasil.innerHTML=`<b>Total Skor:</b> ${total}<br><b>Kategori:</b> ${kategori}<br><br>${rekom}<br><i>Menyimpan dataâ€¦</i>`;

  fetch(URL_API,{
    method:"POST",
    body:JSON.stringify({
      puskesmas:puskesmas.value,
      unit:unit.value,
      tanggal:tanggal.value,
      a:v[0],b:v[1],c:v[2],d:v[3],e:v[4],f:v[5],g:v[6],
      total:total,kategori:kategori,narasi:narasi
    })
  }).then(()=>{
    setTimeout(()=>history.back(),2000);
  });
}
</script>

</body>
</html>
