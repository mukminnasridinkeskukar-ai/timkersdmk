<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>AlertIzin! Praktik SDMK</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{font-family:Arial;background:#eef3f7;padding:15px}
h2{text-align:center}
.controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
input,select,button{padding:7px;font-size:13px}
button{background:#004080;color:#fff;border:0;border-radius:4px;cursor:pointer}
button:hover{background:#0066cc}
.legend span{padding:4px 8px;border-radius:4px;margin-right:5px;font-size:12px;font-weight:bold}
.expired{background:#e74c3c;color:#fff}
.warning{background:#f1c40f}
.safe{background:#2ecc71;color:#fff}
.table-container{overflow-x:auto;background:#fff}
table{border-collapse:collapse;width:100%;min-width:1200px}
th,td{border:1px solid #ccc;padding:6px;font-size:13px}
th{background:#2c3e50;color:#fff}
tr:nth-child(even){background:#f9f9f9}
.pagination{margin-top:10px;text-align:center}
</style>
</head>

<body>

<h2>ðŸš¨ Dashboard AlertIzin! Praktik SDMK</h2>

<div class="controls">
<input id="search" placeholder="Cari nama / unit">
<select id="filterUnit"><option value="">Semua Unit</option></select>
<select id="filterJenis"><option value="">Semua Jenis SDMK</option></select>
<button onclick="resetFilter()">Reset</button>
<button onclick="loadData()">Refresh</button>
</div>

<div class="legend">
<span class="expired">Expired</span>
<span class="warning">&lt; 90 hari</span>
<span class="safe">Aman</span>
</div><br>

<div class="table-container">
<table>
<thead>
<tr>
<th>Nama Lengkap</th>
<th>Unit Kerja</th>
<th>Jenis SDMK</th>
<th>Spesifikasi</th>
<th>JK</th>
<th>Status</th>
<th>Praktik 1</th>
<th>Praktik 2</th>
<th>Praktik 3</th>
<th>Masa SIP</th>
</tr>
</thead>
<tbody id="tbody">
<tr><td colspan="10" align="center">Loading...</td></tr>
</tbody>
</table>
</div>

<div class="pagination">
<button onclick="prevPage()">â—€</button>
<span id="pageInfo"></span>
<button onclick="nextPage()">â–¶</button>
</div>

<script>
const URL_WEB_APP="https://script.google.com/macros/s/AKfycbxrCJVZ6SPskvD7ocVOPhV-GHLHHVYiRcITnqbMY6mjEFKpnXjOis2HZgnhE9L08UDPEQ/exec"; // GANTI
const LIMIT=100;

let data=[],filtered=[];
let page=1;

const tbody=document.getElementById("tbody");
const search=document.getElementById("search");
const filterUnit=document.getElementById("filterUnit");
const filterJenis=document.getElementById("filterJenis");
const pageInfo=document.getElementById("pageInfo");

function statusSIP(t){
 if(!t) return "expired";
 const s=(new Date(t)-new Date())/86400000;
 return s<0?"expired":s<=90?"warning":"safe";
}

function loadData(){
 fetch(URL_WEB_APP)
 .then(r=>r.json())
 .then(d=>{
  data=d;
  isiFilter();
  applyFilter();
 });
}

function isiFilter(){
 filterUnit.innerHTML='<option value="">Semua Unit</option>';
 filterJenis.innerHTML='<option value="">Semua Jenis SDMK</option>';

 [...new Set(data.map(x=>x["Unit Kerja"]).filter(Boolean))]
  .forEach(v=>filterUnit.innerHTML+=`<option>${v}</option>`);

 [...new Set(data.map(x=>x["Jenis SDMK"]).filter(Boolean))]
  .forEach(v=>filterJenis.innerHTML+=`<option>${v}</option>`);
}

function render(){
 tbody.innerHTML="";
 const start=(page-1)*LIMIT;
 const slice=filtered.slice(start,start+LIMIT);
 const frag=document.createDocumentFragment();

 slice.forEach(d=>{
  const tr=document.createElement("tr");
  const st=statusSIP(d["Masa Berlaku SIP"]);
  tr.innerHTML=`
<td>${d["Nama Lengkap"]||""}</td>
<td>${d["Unit Kerja"]||""}</td>
<td>${d["Jenis SDMK"]||""}</td>
<td>${d["Spesifikasi SDMK"]||""}</td>
<td>${d["Jenis Kelamin"]||""}</td>
<td>${d["Jenis Kepegawaian"]||""}</td>
<td>${d["Tempat Praktik Ke-1"]||""}</td>
<td>${d["Tempat Praktik Ke-2"]||""}</td>
<td>${d["Tempat Praktik Ke-3"]||""}</td>
<td class="${st}">${d["Masa Berlaku SIP"]||""}</td>`;
  frag.appendChild(tr);
 });

 tbody.appendChild(frag);
 pageInfo.textContent=`Halaman ${page} / ${Math.ceil(filtered.length/LIMIT)}`;
}

function applyFilter(){
 const q=search.value.toLowerCase();
 const u=filterUnit.value;
 const j=filterJenis.value;

 filtered=data.filter(d=>
  (!q||d["Nama Lengkap"]?.toLowerCase().includes(q)||d["Unit Kerja"]?.toLowerCase().includes(q)) &&
  (!u||d["Unit Kerja"]===u) &&
  (!j||d["Jenis SDMK"]===j)
 );
 page=1;
 render();
}

function nextPage(){
 if(page*LIMIT<filtered.length){page++;render();}
}
function prevPage(){
 if(page>1){page--;render();}
}
function resetFilter(){
 search.value="";
 filterUnit.value="";
 filterJenis.value="";
 applyFilter();
}

let timer;
search.oninput=()=>{clearTimeout(timer);timer=setTimeout(applyFilter,300);}
filterUnit.onchange=applyFilter;
filterJenis.onchange=applyFilter;

loadData();
</script>

</body>
</html>
