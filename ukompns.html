<style>
.container{
  max-width:1200px;
  margin:auto;
  font-family:Segoe UI,Arial,sans-serif;
}
h2{margin-bottom:14px}

/* ===== TOMBOL PENDAFTARAN ===== */
.cta-wrap{
  text-align:center;
  margin:20px 0 28px;
}
.cta-btn{
  display:inline-block;
  padding:16px 36px;
  font-size:18px;
  font-weight:800;
  color:#fff;
  text-decoration:none;
  border-radius:999px;
  background:linear-gradient(135deg,#ef4444,#f97316);
  box-shadow:0 14px 32px rgba(239,68,68,.45);
  position:relative;
  animation:bounce 2.2s infinite;
  transition:.3s;
}
.cta-btn:hover{
  transform:scale(1.06);
  box-shadow:0 20px 44px rgba(239,68,68,.65);
}
.cta-btn::after{
  content:'';
  position:absolute;
  inset:-6px;
  border-radius:999px;
  background:linear-gradient(135deg,#fb7185,#fdba74);
  opacity:.45;
  z-index:-1;
  filter:blur(16px);
  animation:pulse 2.5s infinite;
}
@keyframes bounce{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-8px)}
}
@keyframes pulse{
  0%{opacity:.25}
  50%{opacity:.65}
  100%{opacity:.25}
}
/* ===== END CTA ===== */

.filter{
  display:grid;
  grid-template-columns:2fr 2fr 2fr;
  gap:10px;
  margin-bottom:16px;
}
input,select{
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:14px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #eee;
  text-align:left;
}
th{background:#f3f4f6}
.badge{
  padding:4px 10px;
  border-radius:12px;
  color:#fff;
  font-weight:700;
  font-size:13px;
}
.ok{background:#22c55e}
.no{background:#ef4444}

@media(max-width:900px){
  .filter{grid-template-columns:1fr}
  .cta-btn{font-size:16px;padding:14px 26px}
}
</style>

<div class="container">

<!-- üî• TOMBOL PENDAFTARAN (DI ATAS JUDUL) -->
<div class="cta-wrap">
  <a
    href="#"
    target="_blank"
    class="cta-btn">
    üõéÔ∏è DASHBOARD JF KESEHATAN DI LINGKUNGAN DINAS KESEHATAN KAB. KUTAI KARTANEGARA
  </a>
</div>

<h2>Formasi Jabatan Fungsional Bidang Kesehatan Tahun 2026</h2>

<div class="filter">
  <select id="instansi">
    <option value="">üè• Semua Instansi / Institusi</option>
  </select>

  <select id="jabatan">
    <option value="">üßë‚Äç‚öïÔ∏è Semua Jenis Jabatan</option>
  </select>

  <select id="jenjang">
    <option value="">üéì Semua Jenjang</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th>No</th>
  <th>Instansi / Institusi</th>
  <th>Jenis Jabatan Fungsional</th>
  <th>Jenjang Jabatan</th>
  <th>Kebutuhan</th>
  <th>Pemangku</th>
  <th>Lowongan Formasi</th>
  <th>Nama Pemangku Saat Ini</th>
  <th>Nama-Nama Pemangku Yang telah disetujui Untuk Mengisi Lowongan</th>
</tr>
</thead>
<tbody id="tb">
<tr><td colspan="9">‚è≥ Memuat data...</td></tr>
</tbody>
</table>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyHf3_SSrY4FqBW_RxcRjJXbejN-VSzxJlBjm0fwt06k1BQA1btuohNIEpr6PpLUZZS/exec";
let dataGlobal=[];

const tb=document.getElementById("tb");
const instansi=document.getElementById("instansi");
const jabatan=document.getElementById("jabatan");
const jenjang=document.getElementById("jenjang");
const MAX_RENDER=300;

/* LOAD DATA */
fetch(API_URL)
.then(r=>r.json())
.then(data=>{
  dataGlobal=data;
  initFilter(data);
  render(data);
})
.catch(()=>{
  tb.innerHTML="<tr><td colspan='9'>‚ùå Gagal memuat data</td></tr>";
});

/* INIT FILTER */
function initFilter(data){
  const iSet=new Set(), jSet=new Set(), jenSet=new Set();

  data.forEach(d=>{
    iSet.add(d["Instansi/ Institusi Pelayanan Kesehatan"]);
    jSet.add(d["Jenis Jabatan Fungsional"]);
    jenSet.add(d["Jenjang Jabatan"]);
  });

  iSet.forEach(v=>instansi.add(new Option(v,v)));
  jSet.forEach(v=>jabatan.add(new Option(v,v)));
  jenSet.forEach(v=>jenjang.add(new Option(v,v)));
}

/* RENDER */
function render(data){
  tb.innerHTML="";
  const frag=document.createDocumentFragment();
  const limit=Math.min(data.length,MAX_RENDER);

  for(let i=0;i<limit;i++){
    const d=data[i];
    const kebutuhan=+d["Kebutuhan"]||0;
    const pemangku=+d["Pemangku"]||0;
    const low=Math.max(kebutuhan-pemangku,0);

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${d["Instansi/ Institusi Pelayanan Kesehatan"]||"-"}</td>
      <td>${d["Jenis Jabatan Fungsional"]||"-"}</td>
      <td>${d["Jenjang Jabatan"]||"-"}</td>
      <td>${kebutuhan}</td>
      <td>${pemangku}</td>
      <td><span class="badge ${low>0?'no':'ok'}">${low}</span></td>
      <td>${(d["Nama-Nama Pemangku Saat Ini"]||"-").replace(/\n/g,"<br>")}</td>
      <td>${(d["Nama-Nama Pemangku Yang telah disetujui Untuk Mengisi Lowongan"]||"-").replace(/\n/g,"<br>")}</td>
    `;
    frag.appendChild(tr);
  }
  tb.appendChild(frag);
}

/* FILTER */
function applyFilter(){
  const i=instansi.value;
  const j=jabatan.value;
  const jen=jenjang.value;

  const hasil=dataGlobal.filter(d=>{
    return (!i || d["Instansi/ Institusi Pelayanan Kesehatan"]===i)
      && (!j || d["Jenis Jabatan Fungsional"]===j)
      && (!jen || d["Jenjang Jabatan"]===jen);
  });
  render(hasil);
}

instansi.onchange=applyFilter;
jabatan.onchange=applyFilter;
jenjang.onchange=applyFilter;
</script>

