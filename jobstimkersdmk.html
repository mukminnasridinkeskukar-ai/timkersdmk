<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Tupoksi</title>

<style>
:root{
  --primary:#6366f1;
  --bg:#f4f6fb;
  --card:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:var(--bg);
}

/* ===== LOGIN ===== */
#loginBox{
  max-width:360px;
  margin:110px auto;
  background:var(--card);
  padding:36px;
  border-radius:22px;
  box-shadow:0 20px 50px rgba(0,0,0,.25);
  animation:fade .6s ease;
}
#loginBox h2{text-align:center;margin-bottom:20px}
#loginBox input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:15px;
}
#loginBox button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,var(--primary),#818cf8);
  color:white;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}
#loginBox button:hover{opacity:.9}

/* ===== DASHBOARD ===== */
#dashboard{
  display:none;
  padding:24px;
  animation:slide .6s ease;
}
header{
  background:linear-gradient(135deg,var(--primary),#818cf8);
  color:white;
  padding:26px;
  border-radius:22px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
}

.controls{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  margin:22px 0;
}
.controls input,
.controls select{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid #ddd;
  min-width:240px;
}

/* ===== TABLE ===== */
.table-wrap{
  background:white;
  border-radius:22px;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
  overflow-x:auto;
}
table{
  width:100%;
  min-width:900px;
  border-collapse:collapse;
}
thead th{
  position:sticky;
  top:0;
  background:#eef2ff;
}
th,td{
  padding:14px 16px;
  white-space:nowrap;
}
tbody tr:hover{background:#f9fafb}
.link-btn{
  background:var(--primary);
  color:white;
  padding:8px 14px;
  border-radius:10px;
  text-decoration:none;
  font-weight:600;
}

@keyframes fade{from{opacity:0}to{opacity:1}}
@keyframes slide{from{opacity:0;transform:translateY(25px)}to{opacity:1}}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>üîê Akses Dashboard</h2>
  <input id="password" type="password" placeholder="Masukkan Password">
  <!-- PENTING: type="button" supaya tidak reload -->
  <button type="button" onclick="login()">Masuk</button>
  <p id="msg" style="color:red;text-align:center"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <header>
    <h1>üìä Dashboard Tugas Pokok & Fungsi</h1>
    <p>Sistem Informasi Internal</p>
  </header>

  <div class="controls">
    <input id="search" placeholder="üîç Cari sub kegiatan / penanggung jawab">
    <select id="filterTupoksi">
      <option value="">üìå Semua Tugas Pokok & Fungsi</option>
    </select>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Tugas Pokok & Fungsi</th>
          <th>Sub Kegiatan</th>
          <th>Penanggung Jawab</th>
          <th>Pendamping</th>
          <th>Link Akses</th>
        </tr>
      </thead>
      <tbody id="tableData"></tbody>
    </table>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxbb3eJkblvyzevljYBtWCYjsv6B5JAONm2uhMX4aZ-gXh03yOa6w6dTllvonzF9-c/exec";
let allData = [];

/* ===== LOGIN ===== */
function login(){
  const pwd = document.getElementById("password").value;

  fetch(API,{
    method:"POST",
    body:new URLSearchParams({
      action:"login",
      password: pwd
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status === "success"){
      document.getElementById("loginBox").style.display="none";
      document.getElementById("dashboard").style.display="block";
      loadData();
    }else{
      document.getElementById("msg").innerText="Password salah";
    }
  })
  .catch(()=>{
    document.getElementById("msg").innerText="Gagal koneksi server";
  });
}

/* ===== LOAD DATA ===== */
function loadData(){
  fetch(API,{
    method:"POST",
    body:new URLSearchParams({action:"data"})
  })
  .then(r=>r.json())
  .then(d=>{
    allData = d;
    renderTable(d);
    fillFilter(d);
  });
}

function renderTable(data){
  tableData.innerHTML="";
  data.forEach((d,i)=>{
    tableData.innerHTML+=`
      <tr>
        <td>${d.NO || i+1}</td>
        <td>${d["TUGAS POKOK DAN FUNGSI"]}</td>
        <td>${d["SUB KEGIATAN"]}</td>
        <td>${d["PENANGGUNG JAWAB"]}</td>
        <td>${d.PENDAMPING}</td>
        <td><a class="link-btn" href="${d["LINK AKSES"]}" target="_blank">Buka</a></td>
      </tr>`;
  });
}

function fillFilter(data){
  filterTupoksi.innerHTML =
    `<option value="">üìå Semua Tugas Pokok & Fungsi</option>`;
  [...new Set(data.map(d=>d["TUGAS POKOK DAN FUNGSI"]))].forEach(t=>{
    filterTupoksi.innerHTML+=`<option>${t}</option>`;
  });
}

search.oninput = filterData;
filterTupoksi.onchange = filterData;

function filterData(){
  const q = search.value.toLowerCase();
  const f = filterTupoksi.value;

  renderTable(
    allData.filter(d=>{
      const s =
        d["SUB KEGIATAN"].toLowerCase().includes(q) ||
        d["PENANGGUNG JAWAB"].toLowerCase().includes(q);
      return (!f || d["TUGAS POKOK DAN FUNGSI"] === f) && s;
    })
  );
}
</script>

</body>
</html>
