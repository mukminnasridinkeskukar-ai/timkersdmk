<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Tugas Pokok & Fungsi</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:#f4f6fb;
}

/* LOGIN */
#loginBox{
  max-width:380px;
  margin:120px auto;
  background:white;
  padding:32px;
  border-radius:22px;
  box-shadow:0 25px 60px rgba(0,0,0,.25);
}
#loginBox h2{text-align:center;margin-bottom:20px}
#loginBox input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
}
#loginBox button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#6366f1;
  color:white;
  font-weight:700;
  cursor:pointer;
}
#msg{text-align:center;color:red;margin-top:12px}

/* DASHBOARD */
#dashboard{display:none}

header{
  margin:20px;
  padding:28px;
  background:linear-gradient(135deg,#6366f1,#818cf8);
  color:white;
  border-radius:26px;
  box-shadow:0 25px 60px rgba(0,0,0,.25);
}

.controls{
  margin:20px;
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}
.controls input,
.controls select{
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
}

.table-wrap{
  margin:20px;
  background:white;
  border-radius:26px;
  box-shadow:0 20px 45px rgba(0,0,0,.15);
  overflow-x:auto;
}
table{
  width:100%;
  min-width:900px;
  border-collapse:collapse;
}
th,td{
  padding:14px;
  border-bottom:1px solid #eee;
}
th{background:#eef2ff}
a.btn{
  background:#6366f1;
  color:white;
  padding:8px 14px;
  border-radius:10px;
  text-decoration:none;
}

/* MOBILE */
@media(max-width:768px){
  table{display:none}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>üîê Login Dashboard</h2>
  <input type="password" id="password" placeholder="Masukkan password">
  <button onclick="login()">Masuk</button>
  <div id="msg"></div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <header>
    <h1>üìä Dashboard Tugas Pokok & Fungsi</h1>
    <p>Monitoring kegiatan dan penanggung jawab</p>
  </header>

  <div class="controls">
    <input id="search" placeholder="üîç Cari tugas / sub kegiatan">
    <select id="filterPJ">
      <option value="">üìå Semua Penanggung Jawab</option>
    </select>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Tugas Pokok dan Fungsi</th>
          <th>Sub Kegiatan</th>
          <th>PJ</th>
          <th>Pendamping</th>
          <th>Link</th>
        </tr>
      </thead>
      <tbody id="tableData"></tbody>
    </table>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzreb5E10p9bBErHHR9zuhZo8Z5SdjCTqT91YeNsrQe7nIDI1ElUQgV0jujSjKhfdJD/exec";
let PASSWORD = "";
let allData = [];

/* LOGIN */
function login(){
  PASSWORD = document.getElementById("password").value;
  if(!PASSWORD){ msg.innerText="Password wajib diisi"; return; }

  fetch(API_URL + "?key=" + encodeURIComponent(PASSWORD))
    .then(r => r.json())
    .then(d => {
      if(d.error){
        msg.innerText="Password salah";
        return;
      }
      document.getElementById("loginBox").style.display="none";
      document.getElementById("dashboard").style.display="block";
      allData = d;
      render(d);
      fillFilter(d);
    });
}

/* RENDER */
function render(data){
  tableData.innerHTML="";
  data.forEach(d=>{
    tableData.innerHTML += `
      <tr>
        <td>${d.no}</td>
        <td>${d.tugas}</td>
        <td>${d.sub}</td>
        <td>${d.pj}</td>
        <td>${d.pendamping}</td>
        <td>${d.link ? `<a class="btn" target="_blank" href="${d.link}">Buka</a>` : "-"}</td>
      </tr>`;
  });
}

/* FILTER */
function fillFilter(data){
  filterPJ.innerHTML='<option value="">üìå Semua Penanggung Jawab</option>';
  [...new Set(data.map(d=>d.pj))].forEach(p=>{
    if(p) filterPJ.innerHTML += `<option>${p}</option>`;
  });
}

search.oninput = applyFilter;
filterPJ.onchange = applyFilter;

function applyFilter(){
  const q = search.value.toLowerCase();
  const pj = filterPJ.value;
  render(allData.filter(d=>{
    return (!pj || d.pj === pj) &&
      (d.tugas.toLowerCase().includes(q) || d.sub.toLowerCase().includes(q));
  }));
}
</script>

</body>
</html>
