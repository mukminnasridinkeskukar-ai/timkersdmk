<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Formulir Pendataan Peminat SDMK</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Segoe UI,Arial,sans-serif;
  background:#f1f5f9;
}
.form-wrap{
  max-width:900px;
  margin:40px auto;
  background:#fff;
  padding:36px 40px;
  border-radius:22px;
  box-shadow:0 25px 45px rgba(0,0,0,.08);
}
h2{text-align:center;margin-bottom:30px}
label{font-weight:600;margin-top:16px;display:block}
input,select,textarea{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #cbd5f5;
}
button{
  margin-top:28px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:40px;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
}
button:disabled{opacity:.6}
.note{font-size:14px;color:#475569;margin-top:10px;text-align:center}
</style>
</head>

<body>

<div class="form-wrap">
<h2>Formulir Pendataan Peminat SDMK</h2>

<form id="sdmkForm">

<label>NIK *</label>
<input type="text" name="nik" maxlength="16" required>

<label>Nama Lengkap & Gelar *</label>
<input type="text" name="nama" required>

<label>Usia *</label>
<input type="number" name="usia" required>

<label>Jenis Kelamin *</label>
<select name="jk" required>
  <option value="">-- pilih --</option>
  <option>Laki-laki</option>
  <option>Perempuan</option>
</select>

<label>Alamat KTP *</label>
<textarea name="alamatKTP" required></textarea>

<label>Alamat Domisili *</label>
<textarea name="alamatDomisili" required></textarea>

<label>WhatsApp / Telpon *</label>
<input type="text" name="wa" required>

<label>Email *</label>
<input type="email" name="email" required>

<label>Pendidikan *</label>
<input type="text" name="pendidikan" required>

<label>Jurusan / Keahlian *</label>
<input type="text" name="jurusan" required>

<label>Riwayat Pekerjaan *</label>
<textarea name="riwayat" required></textarea>

<label>Jenis SDMK *</label>
<select name="jenisSDMK" required>
  <option value="">-- pilih --</option>
  <option>Tenaga Medis</option>
  <option>Tenaga Kesehatan</option>
  <option>Tenaga Pendukung</option>
</select>

<label>Nomor STR *</label>
<input type="text" name="str" required>

<label>Sedang Bekerja di Tempat Lain *</label>
<select name="bekerja" required>
  <option value="">-- pilih --</option>
  <option>Ya</option>
  <option>Tidak</option>
</select>

<label>Upload Foto *</label>
<input type="file" id="foto" accept="image/*" required>

<label>Upload Dokumen *</label>
<input type="file" id="dokumen" accept=".pdf,.jpg,.png" required>

<button type="submit" id="btnSubmit">ðŸ“¨ Kirim Data</button>
<p class="note">
  * Semua data wajib diisi dengan benar.  
  NIK tidak dapat diubah.
</p>

</form>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxVzqRlnxf6lK-RhxtM7YicWqaB3Bdsp7-BumII10jqRc2yb6tjB0hc6xwvZGrysjVi/exec";
const REDIRECT_URL = "terimakasih.html";

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(",")[1]);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

document.getElementById("sdmkForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const f = e.target;
  const btn = document.getElementById("btnSubmit");
  btn.disabled = true;
  btn.textContent = "Mengirim...";

  try{
    const fotoFile = document.getElementById("foto").files[0];
    const dokFile  = document.getElementById("dokumen").files[0];

    const payload = {
      nik: f.nik.value.trim(),
      nama: f.nama.value.trim(),
      usia: f.usia.value,
      jk: f.jk.value,
      alamatKTP: f.alamatKTP.value,
      alamatDomisili: f.alamatDomisili.value,
      wa: f.wa.value,
      email: f.email.value,
      pendidikan: f.pendidikan.value,
      jurusan: f.jurusan.value,
      riwayat: f.riwayat.value,
      jenisSDMK: f.jenisSDMK.value,
      str: f.str.value,
      bekerja: f.bekerja.value,
      foto:{
        name: fotoFile.name,
        type: fotoFile.type,
        data: await toBase64(fotoFile)
      },
      dokumen:{
        name: dokFile.name,
        type: dokFile.type,
        data: await toBase64(dokFile)
      }
    };

    const res = await fetch(WEBAPP_URL,{
  method:"POST",
  body: JSON.stringify(payload)
});

const json = await res.json();

if(json.status === "success"){
  window.location.href = REDIRECT_URL;
}else{
  alert(json.message || "Terjadi kesalahan");
  btn.disabled = false;
  btn.textContent = "ðŸ“¨ Kirim Data";
}

  }catch(err){
    alert("Gagal mengirim data. Silakan coba kembali.");
    btn.disabled = false;
    btn.textContent = "ðŸ“¨ Kirim Data";
  }
});
</script>

</body>
</html>
