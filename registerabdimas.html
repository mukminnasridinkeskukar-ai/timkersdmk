<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Form Pelaporan Kegiatan SDMK</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background:#f4f6f9;
  font-family:Segoe UI,Arial;
}
.card{
  border-radius:18px;
}

/* Tombol loading */
.btn-loading{
  pointer-events:none;
  opacity:.8;
}
</style>
</head>

<body>

<div class="container py-5">
  <div class="card shadow p-4">
    <h3 class="fw-bold text-center mb-4">
      Form Pelaporan Kegiatan Pengabdian Masyarakat
    </h3>

<form id="form">

<h5>A. Data PIC</h5>
<input class="form-control mb-3" name="email" type="email" placeholder="Email Aktif" required>
<input class="form-control mb-3" name="pic_name" placeholder="Nama PIC" required>
<input class="form-control mb-3" name="pic_phone" placeholder="Nomor Telpon / WhatsApp" required>

<h5 class="mt-4">B. Data Kegiatan</h5>
<input class="form-control mb-3" name="activity_name" placeholder="Nama Kegiatan" required>
<input class="form-control mb-3" name="location" placeholder="Tempat Kegiatan" required>

<div class="row">
  <div class="col">
    <input class="form-control mb-3" name="activity_date" type="date" required>
  </div>
  <div class="col">
    <input class="form-control mb-3" name="activity_time" type="time" required>
  </div>
</div>

<input class="form-control mb-3" name="participant_count" type="number" placeholder="Jumlah Peserta" required>

<h5 class="mt-4">C. Upload Dokumen Pendukung</h5>

<div class="mb-3">
  <label class="form-label fw-semibold">Daftar Lengkap Peserta (Excel)</label>
  <input class="form-control" type="file" id="participant_list" accept=".xls,.xlsx" required>
</div>

<div class="mb-3">
  <label class="form-label fw-semibold">Rekomendasi/ Surat Tugas dari Organisasi Profesi</label>
  <input class="form-control" type="file" id="recommendation" required>
</div>

<div class="mb-3">
  <label class="form-label fw-semibold">Dokumentasi Foto Kegiatan (10 file dengan rasio 1920:1080 px)</label>
  <input class="form-control" type="file" id="photo_docs" accept="image/*" multiple required>
</div>

<div class="mb-3">
  <label class="form-label fw-semibold">Dokumentasi Video Kegiatan(1-3 menit)</label>
  <input class="form-control" type="file" id="video_docs" accept="video/mp4" required>
</div>

<div class="mb-3">
  <label class="form-label fw-semibold">Surat Pemberitahuan dan Permohonan Sertifikat Ditujukan ke Kepala Dinas Kesehatan</label>
  <input class="form-control" type="file" id="letter_request" accept=".pdf" required>
</div>

<div class="mb-3">
  <label class="form-label fw-semibold">Daftar Hadir</label>
  <input class="form-control" type="file" id="attendance" accept=".pdf" required>
</div>

<div class="mb-4">
  <label class="form-label fw-semibold">Berita Acara Pelaksanaan (BAP)</label>
  <input class="form-control" type="file" id="minutes" accept=".pdf" required>
</div>

<!-- TOMBOL -->
<button id="submitBtn" class="btn btn-primary btn-lg w-100">
  <span id="btnText">Kirim Laporan Sekarang</span>
  <span id="btnLoading" class="d-none">
    <span class="spinner-border spinner-border-sm me-2"></span>
    Mengirim dataâ€¦
  </span>
</button>

</form>

<!-- NOTIFIKASI -->
<div id="successMsg" class="alert alert-success mt-4 d-none">
  <strong>Terima kasih!</strong><br>
  Laporan kegiatan Anda telah berhasil dikirim dan akan segera diproses.
</div>

  </div>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxqNgZj5jTyekfb8W0wP0QFvk3lZOUP1wDcYK-OCQwWK9WG7zjzkBKFopeDhd1bJvdsYw/exec";

const toBase64 = file => new Promise(res=>{
  const r=new FileReader();
  r.onload=()=>res(JSON.stringify({
    name:file.name,
    mimeType:file.type,
    data:r.result.split(",")[1]
  }));
  r.readAsDataURL(file);
});

document.getElementById("form").onsubmit = async e =>{
  e.preventDefault();

  const btn = document.getElementById("submitBtn");
  const txt = document.getElementById("btnText");
  const load = document.getElementById("btnLoading");

  // UI loading
  btn.classList.add("btn-loading");
  txt.classList.add("d-none");
  load.classList.remove("d-none");

  try{
    const payload={
      email:form.email.value,
      pic_name:form.pic_name.value,
      pic_phone:form.pic_phone.value,
      activity_name:form.activity_name.value,
      location:form.location.value,
      activity_date:form.activity_date.value,
      activity_time:form.activity_time.value,
      participant_count:form.participant_count.value,
      participant_list:await toBase64(participant_list.files[0]),
      recommendation:await toBase64(recommendation.files[0]),
      photo_docs:await toBase64(photo_docs.files[0]),
      video_docs:await toBase64(video_docs.files[0]),
      letter_request:await toBase64(letter_request.files[0]),
      attendance:await toBase64(attendance.files[0]),
      minutes:await toBase64(minutes.files[0])
    };

    await fetch(WEBAPP_URL,{
      method:"POST",
      body:new URLSearchParams(payload)
    });

    document.getElementById("successMsg").classList.remove("d-none");
    form.reset();

  }catch(err){
    alert("Gagal mengirim data. Silakan coba kembali.");
  }

  // reset tombol
  btn.classList.remove("btn-loading");
  txt.classList.remove("d-none");
  load.classList.add("d-none");
};
</script>

</body>
</html>
