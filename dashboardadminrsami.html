<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin RS AMI - SIPANDI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
        }
        
        .sidebar {
            min-height: 100vh;
            background: var(--dark-bg);
            color: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            border-radius: 5px;
            margin: 5px 10px;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: var(--secondary-color);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .stat-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card .card-body {
            padding: 20px;
        }
        
        .stat-card .stat-icon {
            font-size: 2.5rem;
            opacity: 0.2;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .stat-card .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-card .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .data-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .data-table thead {
            background: var(--primary-color);
            color: white;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .data-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-aktif {
            background: #d4edda;
            color: #155724;
        }
        
        .status-nonaktif {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .refresh-btn:hover {
            transform: rotate(180deg);
            background: var(--primary-color);
        }
        
        .last-updated {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
        }
        
        /* Lightbox Styles */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .lightbox.active {
            display: flex;
        }
        
        .lightbox-content {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }
        
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .lightbox-close:hover {
            color: var(--secondary-color);
        }
        
        .lightbox-caption {
            color: white;
            margin-top: 15px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .photo-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .photo-thumbnail:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .sdmk-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .sdmk-dokter { background: #e3f2fd; color: #1565c0; }
        .sdmk-perawat { background: #e8f5e9; color: #2e7d32; }
        .sdmk-bidan { background: #fce4ec; color: #c2185b; }
        .sdmk-farmasi { background: #fff3e0; color: #ef6c00; }
        .sdmk-tenaga-kesehatan { background: #f3e5f5; color: #7b1fa2; }
        .sdmk-admin { background: #eceff1; color: #546e7a; }
        
        .table-sdmk td {
            font-size: 0.85rem;
            vertical-align: middle;
        }
        
        .table-sdmk th {
            white-space: nowrap;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse" id="sidebar">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h5><i class="fas fa-graduation-cap"></i> SIPANDI</h5>
                        <p class="small">Dashboard Admin RS AMI</p>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showDashboard()">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('jadwal')">
                                <i class="fas fa-calendar-alt"></i> Jadwal Diklat
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('peserta')">
                                <i class="fas fa-users"></i> Peserta
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('sertifikat')">
                                <i class="fas fa-certificate"></i> Sertifikat
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('materi')">
                                <i class="fas fa-book"></i> Materi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('registrasi')">
                                <i class="fas fa-user-plus"></i> Registrasi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('absensi')">
                                <i class="fas fa-clipboard-check"></i> Absensi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showData('sdmk')">
                                <i class="fas fa-user-md"></i> Data SDMK
                            </a>
                        </li>
                        <li class="nav-item mt-3">
                            <a class="nav-link" href="#">
                                <i class="fas fa-cog"></i> Pengaturan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-sign-out-alt"></i> Keluar
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <!-- Header -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <div class="d-flex align-items-center">
                        <button class="btn btn-link d-md-none me-3" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <h1 class="h2">Dashboard Admin</h1>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="last-updated me-3" id="lastUpdated"></span>
                        <button class="btn btn-sm btn-outline-secondary" onclick="loadData()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="row mb-4" id="statsContainer">
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-primary text-white">
                            <div class="card-body">
                                <div class="stat-number" id="totalActivities">0</div>
                                <div class="stat-label" id="label1">Total Kegiatan</div>
                                <i class="fas fa-calendar-check stat-icon"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-success text-white">
                            <div class="card-body">
                                <div class="stat-number" id="totalParticipants">0</div>
                                <div class="stat-label" id="label2">Total Peserta</div>
                                <i class="fas fa-users stat-icon"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-warning text-white">
                            <div class="card-body">
                                <div class="stat-number" id="totalJP">0</div>
                                <div class="stat-label" id="label3">Total JP</div>
                                <i class="fas fa-clock stat-icon"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card bg-info text-white">
                            <div class="card-body">
                                <div class="stat-number" id="totalSpeakers">0</div>
                                <div class="stat-label" id="label4">Total Narasumber</div>
                                <i class="fas fa-microphone stat-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions & Filter -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="fas fa-bolt"></i> Aksi Cepat</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-2">
                                        <button class="btn btn-outline-primary w-100" onclick="showData('jadwal')">
                                            <i class="fas fa-plus"></i> Tambah Jadwal
                                        </button>
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <button class="btn btn-outline-success w-100" onclick="showData('peserta')">
                                            <i class="fas fa-user-plus"></i> Tambah Peserta
                                        </button>
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <button class="btn btn-outline-warning w-100" onclick="exportData()">
                                            <i class="fas fa-download"></i> Export Data
                                        </button>
                                    </div>
                                    <div class="col-md-3 mb-2">
                                        <button class="btn btn-outline-info w-100" onclick="showStatistics()">
                                            <i class="fas fa-chart-bar"></i> Lihat Statistik
                                        </button>
                                    </div>
                                    <div class="col-md-3 mb-2" id="addSDMKBtn" style="display: none;">
                                        <button class="btn btn-outline-danger w-100" onclick="showAddModal()">
                                            <i class="fas fa-user-md"></i> Tambah SDMK
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6" id="filterSection" style="display: none;">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="fas fa-filter"></i> Filter Data SDMK</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <select class="form-select" id="filterJenisSDMK" onchange="filterSDMK()">
                                            <option value="">Semua Jenis SDMK</option>
                                            <option value="Dokter">Dokter</option>
                                            <option value="Perawat">Perawat</option>
                                            <option value="Bidan">Bidan</option>
                                            <option value="Tenaga Kefarmasian">Tenaga Kefarmasian</option>
                                            <option value="Tenaga Kesehatan Lain">Tenaga Kesehatan Lain</option>
                                            <option value="Tenaga Penunjang">Tenaga Penunjang</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <select class="form-select" id="filterPendidikan" onchange="filterSDMK()">
                                            <option value="">Semua Pendidikan</option>
                                            <option value="S1">S1</option>
                                            <option value="S2">S2</option>
                                            <option value="S3">S3</option>
                                            <option value="D3">D3</option>
                                            <option value="D4">D4</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="row">
                    <div class="col-12">
                        <div class="data-table">
                            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" id="tableTitle">Data Terbaru</h5>
                                <div>
                                    <input type="text" class="form-control form-control-sm d-inline-block w-auto" 
                                           placeholder="Cari..." id="searchInput" onkeyup="searchData()">
                                    <button class="btn btn-sm btn-primary" onclick="showAddModal()">
                                        <i class="fas fa-plus"></i> Tambah
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="loading-spinner" id="loadingSpinner">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive" id="tableContainer" style="display: none;">
                                    <table class="table table-hover" id="dataTable">
                                        <thead id="tableHead"></thead>
                                        <tbody id="tableBody"></tbody>
                                    </table>
                                </div>
                                <div class="text-center py-4" id="noDataMessage" style="display: none;">
                                    <i class="fas fa-inbox fa-3x text-muted"></i>
                                    <p class="mt-2 text-muted">Tidak ada data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn" onclick="loadData()" title="Refresh Data">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Lightbox Modal -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <img class="lightbox-content" id="lightbox-img" src="" alt="">
        <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        // Configuration - Ganti dengan URL Web App Anda
        const SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec';
        
        let currentData = [];
        let currentTable = 'jadwal';
        
        // SDMK Column Configuration
        const SDMK_COLUMNS = [
            { key: 'no', label: 'No', type: 'number' },
            { key: 'foto', label: 'Foto', type: 'photo' },
            { key: 'namaLengkapGelar', label: 'Nama Lengkap & Gelar', type: 'text' },
            { key: 'nik', label: 'NIK', type: 'text' },
            { key: 'usia', label: 'Usia', type: 'number' },
            { key: 'jenisKelamin', label: 'Jenis Kelamin', type: 'text' },
            { key: 'alamatKTP', label: 'Alamat KTP', type: 'text' },
            { key: 'alamatDomisili', label: 'Alamat Domisili', type: 'text' },
            { key: 'whatsapp', label: 'WhatsApp/Telpon', type: 'text' },
            { key: 'email', label: 'Alamat Email', type: 'email' },
            { key: 'pendidikan', label: 'Pendidikan', type: 'text' },
            { key: 'jurusanKeahlian', label: 'Jurusan/Keahlian', type: 'text' },
            { key: 'riwayatPekerjaan', label: 'Riwayat Pekerjaan', type: 'text' },
            { key: 'jenisSDMK', label: 'Jenis SDMK', type: 'badge' },
            { key: 'nomorSTR', label: 'Nomor STR', type: 'text' },
            { key: 'bekerjaTempatLain', label: 'Bekerja di Tempat Lain', type: 'text' }
        ];
        
        // Demo SDMK Data
        const SDMK_DEMO_DATA = [
            {
                no: 1,
                foto: '1a2b3c4d5e6f7g8h9i0j',
                namaLengkapGelar: 'Dr. Ahmad Wijaya, Sp.PD',
                nik: '7371123405670001',
                usia: 45,
                jenisKelamin: 'Laki-laki',
                alamatKTP: 'Jl. Pettarani No. 45, Makassar',
                alamatDomisili: 'Jl. Sultan Alauddin No. 88, Makassar',
                whatsapp: '081234567890',
                email: 'ahmad.wijaya@rsami.co.id',
                pendidikan: 'S1 Kedokteran',
                jabatan: 'Dokter Spesialis',
                riwayatPekerjaan: 'RS Wahidin Sudirohusodo (2010-2015)',
                jenisSDMK: 'Dokter',
                nomorSTR: '1234567890123456',
                bekerjaTempatLain: 'Tidak'
            },
            {
                no: 2,
                foto: '2b3c4d5e6f7g8h9i0j1k',
                namaLengkapGelar: 'Ns. Siti Rahayu, S.Kep., M.Kep',
                nik: '7371123506780002',
                usia: 38,
                jenisKelamin: 'Perempuan',
                alamatKTP: 'Jl. Perintis Kemerdekaan No. 12, Makassar',
                alamatDomisili: 'Jl. Adhyaksa No. 5, Makassar',
                whatsapp: '081234567891',
                email: 'siti.rahayu@rsami.co.id',
                pendidikan: 'S2 Keperawatan',
                jabatan: ' Kepala Perawat',
                riwayatPekerjaan: 'RS Siloam (2015-2018)',
                jenisSDMK: 'Perawat',
                nomorSTR: '2345678901234567',
                bekerjaTempatLain: 'Ya - RS Hermina'
            },
            {
                no: 3,
                foto: '3c4d5e6f7g8h9i0j1k2l',
                namaLengkapGelar: 'Drg. Budi Santoso',
                nik: '7371124607890003',
                usia: 42,
                jenisKelamin: 'Laki-laki',
                alamatKTP: 'Jl. Todopuli No. 8, Makassar',
                alamatDomisili: 'Jl. Baji Pandan No. 22, Makassar',
                whatsapp: '081234567892',
                email: 'budi.santoso@rsami.co.id',
                pendidikan: 'S1 Kedokteran Gigi',
                jabatan: 'Dokter Gigi',
                riwayatPekerjaan: 'Puskesmas Mamajang (2015-2020)',
                jenisSDMK: 'Dokter Gigi',
                nomorSTR: '3456789012345678',
                bekerjaTempatLain: 'Tidak'
            },
            {
                no: 4,
                foto: '4d5e6f7g8h9i0j1k2l3m',
                namaLengkapGelar: 'apt. Fauzi Rahman, S.Farm., M.Farm',
                nik: '7371125708900004',
                usia: 35,
                jenisKelamin: 'Laki-laki',
                alamatKTP: 'Jl. Nuri No. 15, Makassar',
                alamatDomisili: 'Jl. Parangloe No. 33, Makassar',
                whatsapp: '081234567893',
                email: 'fauzi.rahman@rsami.co.id',
                pendidikan: 'S2 Farmasi',
                jabatan: 'Apoteker',
                riwayatPekerjaan: 'RS Akademik (2018-2022)',
                jenisSDMK: 'Tenaga Kefarmasian',
                nomorSTR: '4567890123456789',
                bekerjaTempatLain: 'Ya - Apotek Kimia Farma'
            },
            {
                no: 5,
                foto: '5e6f7g8h9i0j1k2l3m4n',
                namaLengkapGelar: 'Hj. Aminah, Am.Keb',
                nik: '7371126809010005',
                usia: 48,
                jenisKelamin: 'Perempuan',
                alamatKTP: 'Jl. Satando No. 25, Makassar',
                alamatDomisili: 'Jl. Salimunnadjam No. 10, Makassar',
                whatsapp: '081234567894',
                email: 'aminah@rsami.co.id',
                pendidikan: 'D4 Kebidanan',
                jabatan: 'Bidanan',
                riwayatPekerjaan: 'RS Stella Maris (2010-2019)',
                jenisSDMK: 'Bidan',
                nomorSTR: '5678901234567890',
                bekerjaTempatLain: 'Tidak'
            },
            {
                no: 6,
                foto: '6f7g8h9i0j1k2l3m4n5o',
                namaLengkapGelar: 'Andi Pratama, A.Md.Ft',
                nik: '7371127910120006',
                usia: 29,
                jenisKelamin: 'Laki-laki',
                alamatKTP: 'Jl. Veteran No. 18, Makassar',
                alamatDomisili: 'Jl. Urip Sumoharjo No. 45, Makassar',
                whatsapp: '081234567895',
                email: 'andi.pratama@rsami.co.id',
                pendidikan: 'D3 Fisioterapi',
                jabatan: 'Fisioterapis',
                riwayatPekerjaan: 'RS Awal Bros (2020-2023)',
                jenisSDMK: 'Tenaga Kesehatan Lain',
                nomorSTR: '6789012345678901',
                bekerjaTempatLain: 'Ya - Klinik Pratama'
            },
            {
                no: 7,
                foto: '7g8h9i0j1k2l3m4n5o6p',
                namaLengkapGelar: 'Rina Susilowati, S.Tr.Keb',
                nik: '7371128101230007',
                usia: 32,
                jenisKelamin: 'Perempuan',
                alamatKTP: 'Jl. Daeng Tata No. 30, Makassar',
                alamatDomisili: 'Jl. Rajawali No. 12, Makassar',
                whatsapp: '081234567896',
                email: 'rina.susilowati@rsami.co.id',
                pendidikan: 'S1 Kebidanan',
                jabatan: 'Bidanan',
                riwayatPekerjaan: 'RS Permata (2021-sekarang)',
                jenisSDMK: 'Bidan',
                nomorSTR: '7890123456789012',
                bekerjaTempatLain: 'Tidak'
            },
            {
                no: 8,
                foto: '8h9i0j1k2l3m4n5o6p7q',
                namaLengkapGelar: 'Irwan Syam, S.Kom., M.HI',
                nik: '7371129202340008',
                usia: 40,
                jenisKelamin: 'Laki-laki',
                alamatKTP: 'Jl. Rappocini No. 50, Makassar',
                alamatDomisili: 'Jl. Hertasning No. 28, Makassar',
                whatsapp: '081234567897',
                email: 'irwan.syam@rsami.co.id',
                pendidikan: 'S1 Informatika',
                jabatan: 'Admin SDMK',
                riwayatPekerjaan: ' Dinkes Prov Sulawesi Selatan',
                jenisSDMK: 'Tenaga Penunjang',
                nomorSTR: '-',
                bekerjaTempatLain: 'Tidak'
            },
            {
                no: 9,
                foto: '9i0j1k2l3m4n5o6p7q8r',
                namaLengkapGelar: 'Dr. Maya Putri, Sp.OG',
                nik: '7371130303450009',
                usia: 50,
                jenisKelamin: 'Perempuan',
                alamatKTP: 'Jl. Golf No. 5, Makassar',
                alamatDomisili: 'Jl. Metro Tanjung no. 15, Makassar',
                whatsapp: '081234567898',
                email: 'maya.putri@rsami.co.id',
                pendidikan: 'S1 Kedokteran - Spesialis Kandungan',
                jabatan: 'Dokter Spesialis Kandungan',
                riwayatPekerjaan: 'RS Wahidin (2008-2019)',
                jenisSDMK: 'Dokter',
                nomorSTR: '8901234567890123',
                bekerjaTempatLain: 'Ya - Praktik Pribadi'
            },
            {
                no: 10,
                foto: '0j1k2l3m4n5o6p7q8r9s',
                namaLengkapGelar: 'Hendra Wijaya, A.Md.OT',
                nik: '7371131404560010',
                usia: 28,
                jenisKelamin: 'Laki-laki',
                alamatKTP: 'Jl. Toddopuli Raya No. 78, Makassar',
                alamatDomisili: 'Jl. Nanas No. 4, Makassar',
                whatsapp: '081234567899',
                email: 'hendra.wijaya@rsami.co.id',
                pendidikan: 'D3 Okupasi Terapi',
                jabatan: 'Okupasi Terapis',
                riwayatPekerjaan: 'RS JIH (2022-sekarang)',
                jenisSDMK: 'Tenaga Kesehatan Lain',
                nomorSTR: '9012345678901234',
                bekerjaTempatLain: 'Tidak'
            }
        ];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
        
        // Toggle Sidebar (mobile)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
        }
        
        // Load Data from Google Apps Script
        async function loadData() {
            showLoading();
            
            // Reset labels to default
            document.getElementById('label1').textContent = 'Total Kegiatan';
            document.getElementById('label2').textContent = 'Total Peserta';
            document.getElementById('label3').textContent = 'Total JP';
            document.getElementById('label4').textContent = 'Total Narasumber';
            document.getElementById('filterSection').style.display = 'none';
            document.getElementById('addSDMKBtn').style.display = 'none';
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                currentData = data;
                
                updateStatistics(data);
                renderTable(data);
                updateLastUpdated();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Gagal memuat data. Pastikan Web App sudah di-deploy dengan benar.');
            }
        }
        
        // Update Statistics Cards
        function updateStatistics(data) {
            if (currentTable === 'sdmk') {
                updateSDMKStatistics(data);
                return;
            }
            
            const totalActivities = data.length || 0;
            
            // Calculate participants (if available)
            let totalParticipants = 0;
            let totalJP = 0;
            let speakers = [];
            
            if (data.length > 0) {
                const firstItem = data[0];
                if (firstItem.peserta) totalParticipants = data.reduce((sum, item) => sum + (parseInt(item.peserta) || 0), 0);
                if (firstItem.jp) totalJP = data.reduce((sum, item) => sum + (parseInt(item.jp) || 0), 0);
                if (firstItem.narasumber) {
                    speakers = [...new Set(data.map(item => item.narasumber))];
                }
            }
            
            document.getElementById('totalActivities').textContent = totalActivities;
            document.getElementById('totalParticipants').textContent = totalParticipants;
            document.getElementById('totalJP').textContent = totalJP;
            document.getElementById('totalSpeakers').textContent = speakers.length;
        }
        
        // Render Table
        function renderTable(data, searchTerm = '') {
            hideLoading();
            
            if (!data || data.length === 0) {
                document.getElementById('noDataMessage').style.display = 'block';
                document.getElementById('tableContainer').style.display = 'none';
                return;
            }
            
            document.getElementById('noDataMessage').style.display = 'none';
            document.getElementById('tableContainer').style.display = 'block';
            
            const headers = Object.keys(data[0]);
            
            // Filter data if search term exists
            let filteredData = data;
            if (searchTerm) {
                filteredData = data.filter(item => {
                    return Object.values(item).some(val => 
                        String(val).toLowerCase().includes(searchTerm.toLowerCase())
                    );
                });
            }
            
            // Render table head
            const tableHead = document.getElementById('tableHead');
            tableHead.innerHTML = '<tr>' + headers.map(h => `<th>${formatHeader(h)}</th>`).join('') + '</tr>';
            
            // Render table body
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = filteredData.map((row, index) => {
                return '<tr>' + headers.map(h => {
                    let value = row[h];
                    if (h === 'status') {
                        value = `<span class="status-badge ${getStatusClass(value)}">${value || '-'}</span>`;
                    } else if (h === 'no') {
                        value = index + 1;
                    }
                    return `<td>${value || '-'}</td>`;
                }).join('') + '</tr>';
            }).join('');
        }
        
        // Format header for display
        function formatHeader(header) {
            const headerMap = {
                'no': 'No',
                'namakegiatan': 'Nama Kegiatan',
                'tanggal': 'Tanggal',
                'waktu': 'Waktu',
                'lokasi': 'Lokasi',
                'narasumber': 'Narasumber',
                'jp': 'JP',
                'peserta': 'Peserta',
                'status': 'Status',
                'keterangan': 'Keterangan',
                'namaLengkapGelar': 'Nama Lengkap & Gelar',
                'nik': 'NIK',
                'usia': 'Usia',
                'jenisKelamin': 'Jenis Kelamin',
                'alamatKTP': 'Alamat KTP',
                'alamatDomisili': 'Alamat Domisili',
                'whatsapp': 'WhatsApp/Telpon',
                'email': 'Email',
                'pendidikan': 'Pendidikan',
                'jurusanKeahlian': 'Jurusan/Keahlian',
                'riwayatPekerjaan': 'Riwayat Pekerjaan',
                'jenisSDMK': 'Jenis SDMK',
                'nomorSTR': 'Nomor STR',
                'bekerjaTempatLain': 'Bekerja di Tempat Lain',
                'foto': 'Foto'
            };
            return headerMap[header] || header.charAt(0).toUpperCase() + header.slice(1);
        }
        
        // Get status CSS class
        function getStatusClass(status) {
            if (!status) return 'status-pending';
            const s = status.toLowerCase();
            if (s.includes('aktif') || s.includes('selesai')) return 'status-aktif';
            if (s.includes('nonaktif') || s.includes('batal')) return 'status-nonaktif';
            return 'status-pending';
        }
        
        // Search data
        function searchData() {
            const searchTerm = document.getElementById('searchInput').value;
            if (currentTable === 'sdmk') {
                renderSDMKTable(SDMK_DEMO_DATA, searchTerm);
            } else {
                renderTable(currentData, searchTerm);
            }
        }
        
        // Show loading
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
            document.getElementById('tableContainer').style.display = 'none';
            document.getElementById('noDataMessage').style.display = 'none';
        }
        
        // Hide loading
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        // Show error
        function showError(message) {
            hideLoading();
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = `<tr><td colspan="100%" class="text-center text-danger">${message}</td></tr>`;
            document.getElementById('tableContainer').style.display = 'block';
        }
        
        // Update last updated time
        function updateLastUpdated() {
            const now = new Date();
            const formatted = now.toLocaleString('id-ID', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdated').textContent = 'Terakhir diperbarui: ' + formatted;
        }
        
        // Show data by type
        function showData(type) {
            currentTable = type;
            const titles = {
                'jadwal': 'Data Jadwal Diklat',
                'peserta': 'Data Peserta',
                'sertifikat': 'Data Sertifikat',
                'materi': 'Data Materi',
                'registrasi': 'Data Registrasi',
                'absensi': 'Data Absensi',
                'sdmk': 'Data SDMK (Tenaga Kesehatan)'
            };
            document.getElementById('tableTitle').textContent = titles[type] || 'Data';
            
            // Show/hide filter section and Add SDMK button based on type
            const filterSection = document.getElementById('filterSection');
            const addSDMKBtn = document.getElementById('addSDMKBtn');
            if (type === 'sdmk') {
                filterSection.style.display = 'block';
                addSDMKBtn.style.display = 'block';
            } else {
                filterSection.style.display = 'none';
                addSDMKBtn.style.display = 'none';
            }
            
            // Update active nav
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.closest('.nav-link').classList.add('active');
            
            // Load appropriate data
            if (type === 'sdmk') {
                loadSDMKData();
            } else {
                loadData();
            }
        }
        
        // Filter SDMK Data
        function filterSDMK() {
            const filterJenis = document.getElementById('filterJenisSDMK').value;
            const filterPendidikan = document.getElementById('filterPendidikan').value;
            const searchTerm = document.getElementById('searchInput').value;
            
            let filteredData = SDMK_DEMO_DATA;
            
            if (filterJenis) {
                filteredData = filteredData.filter(d => d.jenisSDMK?.includes(filterJenis));
            }
            
            if (filterPendidikan) {
                filteredData = filteredData.filter(d => d.pendidikan?.includes(filterPendidikan));
            }
            
            if (searchTerm) {
                filteredData = filteredData.filter(item => {
                    return Object.values(item).some(val => 
                        String(val).toLowerCase().includes(searchTerm.toLowerCase())
                    );
                });
            }
            
            renderSDMKTable(filteredData);
            updateSDMKStatistics(filteredData);
        }
        
        // Load SDMK Data
        function loadSDMKData() {
            showLoading();
            
            // Simulate API call with demo data
            setTimeout(() => {
                currentData = SDMK_DEMO_DATA;
                renderSDMKTable(SDMK_DEMO_DATA);
                updateSDMKStatistics(SDMK_DEMO_DATA);
                updateLastUpdated();
                hideLoading();
            }, 500);
        }
        
        // Render SDMK Table
        function renderSDMKTable(data, searchTerm = '') {
            hideLoading();
            
            if (!data || data.length === 0) {
                document.getElementById('noDataMessage').style.display = 'block';
                document.getElementById('tableContainer').style.display = 'none';
                return;
            }
            
            document.getElementById('noDataMessage').style.display = 'none';
            document.getElementById('tableContainer').style.display = 'block';
            
            // Filter data if search term exists
            let filteredData = data;
            if (searchTerm) {
                filteredData = data.filter(item => {
                    return Object.values(item).some(val => 
                        String(val).toLowerCase().includes(searchTerm.toLowerCase())
                    );
                });
            }
            
            // Render table head
            const tableHead = document.getElementById('tableHead');
            const columns = SDMK_COLUMNS;
            tableHead.innerHTML = '<tr>' + columns.map(col => `<th>${col.label}</th>`).join('') + '</tr>';
            
            // Render table body
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = filteredData.map((row) => {
                return '<tr class="table-sdmk">' + columns.map(col => {
                    let value = row[col.key];
                    
                    if (col.type === 'photo') {
                        value = renderPhotoCell(row.foto, row.namaLengkapGelar);
                    } else if (col.type === 'badge') {
                        value = renderSDMKBadge(value);
                    } else if (col.key === 'no') {
                        value = row.no;
                    } else if (col.key === 'usia') {
                        value = value + ' tahun';
                    }
                    
                    return `<td>${value || '-'}</td>`;
                }).join('') + '</tr>';
            }).join('');
        }
        
        // Render Photo Cell with Lightbox
        function renderPhotoCell(fotoId, nama) {
            if (!fotoId) return '<span class="text-muted">-</span>';
            const photoUrl = `https://drive.google.com/uc?id=${fotoId}&export=download`;
            return `<img class="photo-thumbnail" src="${photoUrl}" alt="${nama}" onclick="openLightbox('${photoUrl}', '${nama}')" onerror="this.src='https://via.placeholder.com/60?text=Foto'">`;
        }
        
        // Render SDMK Badge
        function renderSDMKBadge(jenis) {
            let badgeClass = 'sdmk-admin';
            const lowerJenis = jenis.toLowerCase();
            
            if (lowerJenis.includes('dokter') || lowerJenis.includes('sp.')) {
                badgeClass = 'sdmk-dokter';
            } else if (lowerJenis.includes('perawat') || lowerJenis.includes('ns.')) {
                badgeClass = 'sdmk-perawat';
            } else if (lowerJenis.includes('bidan') || lowerJenis.includes('am.keb')) {
                badgeClass = 'sdmk-bidan';
            } else if (lowerJenis.includes('farmasi') || lowerJenis.includes('apt.')) {
                badgeClass = 'sdmk-farmasi';
            } else if (lowerJenis.includes('kesehatan') || lowerJenis.includes('terapi')) {
                badgeClass = 'sdmk-tenaga-kesehatan';
            }
            
            return `<span class="sdmk-badge ${badgeClass}">${jenis}</span>`;
        }
        
        // Update SDMK Statistics
        function updateSDMKStatistics(data) {
            const totalSDMK = data.length;
            const dokter = data.filter(d => d.jenisSDMK?.toLowerCase().includes('dokter')).length;
            const perawat = data.filter(d => d.jenisSDMK?.toLowerCase().includes('perawat')).length;
            const bidan = data.filter(d => d.jenisSDMK?.toLowerCase().includes('bidan')).length;
            const farmasi = data.filter(d => d.jenisSDMK?.toLowerCase().includes('farmasi') || d.jenisSDMK?.toLowerCase().includes('apoteker')).length;
            
            document.getElementById('totalActivities').textContent = totalSDMK;
            document.getElementById('totalParticipants').textContent = dokter;
            document.getElementById('totalJP').textContent = perawat;
            document.getElementById('totalSpeakers').textContent = bidan + farmasi;
            
            // Update labels for SDMK
            document.getElementById('label1').textContent = 'Total SDMK';
            document.getElementById('label2').textContent = 'Dokter';
            document.getElementById('label3').textContent = 'Perawat';
            document.getElementById('label4').textContent = 'Bidan & Farmasi';
        }
        
        // Open Lightbox
        function openLightbox(imageUrl, caption) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxCaption = document.getElementById('lightbox-caption');
            
            lightboxImg.src = imageUrl;
            lightboxCaption.textContent = caption;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Close Lightbox
        function closeLightbox(event) {
            if (event && event.target !== event.currentTarget) return;
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Close lightbox on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeLightbox();
        });
        
        // Show dashboard
        function showDashboard() {
            document.getElementById('tableTitle').textContent = 'Data Terbaru';
            currentTable = 'jadwal';
            // Reset labels
            document.getElementById('label1').textContent = 'Total Kegiatan';
            document.getElementById('label2').textContent = 'Total Peserta';
            document.getElementById('label3').textContent = 'Total JP';
            document.getElementById('label4').textContent = 'Total Narasumber';
            document.getElementById('filterSection').style.display = 'none';
            loadData();
        }
        
        // Show statistics
        function showStatistics() {
            alert('Fitur statistik lengkap akan menampilkan grafik dan analisis data.');
        }
        
        // Export data
        function exportData() {
            if (!currentData || currentData.length === 0) {
                alert('Tidak ada data untuk diexport');
                return;
            }
            
            let csv = '';
            const headers = Object.keys(currentData[0]);
            csv += headers.join(',') + '\n';
            
            currentData.forEach(row => {
                const values = headers.map(h => {
                    let val = row[h] || '';
                    val = String(val).replace(/"/g, '""');
                    return `"${val}"`;
                });
                csv += values.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data_${currentTable}_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }
        
        // Show add modal
        function showAddModal() {
            if (currentTable === 'sdmk') {
                alert('Fitur tambah data SDMK akan membuka form untuk menambahkan tenaga kesehatan baru.');
            } else {
                alert('Fitur tambah data akan membuka form untuk menambahkan data baru.');
            }
        }
        
        // Auto refresh every 5 minutes
        setInterval(loadData, 300000);
    </script>
</body>
</html>
