<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard PAK Integrasi PNS</title>
  
  <!-- Google Fonts - Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* ============================================
       CSS VARIABLES & RESET
       ============================================ */
    :root {
      --primary-blue: #1a73e8;
      --primary-dark: #1557b0;
      --primary-light: #e8f0fe;
      --government-blue: #0d47a1;
      --sidebar-dark: #1e3a5f;
      --sidebar-hover: #2d4a6f;
      --white: #ffffff;
      --light-bg: #f0f4f8;
      --border-color: #e2e8f0;
      --text-dark: #1e293b;
      --text-medium: #475569;
      --text-light: #94a3b8;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #06b6d4;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --transition: all 0.3s ease;
      --sidebar-width: 260px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--light-bg);
      color: var(--text-dark);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* ============================================
       SIDEBAR LAYOUT
       ============================================ */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(180deg, var(--sidebar-dark) 0%, #152238 100%);
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
      transition: var(--transition);
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }

    .sidebar-logo {
      width: 60px;
      height: 60px;
      background: var(--white);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 28px;
      color: var(--government-blue);
    }

    .sidebar-title {
      color: var(--white);
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .sidebar-subtitle {
      color: rgba(255,255,255,0.6);
      font-size: 0.75rem;
    }

    .sidebar-menu {
      padding: 16px 12px;
    }

    .menu-section {
      color: rgba(255,255,255,0.4);
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 16px 12px 8px;
      margin-top: 8px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      border-radius: var(--radius-md);
      margin-bottom: 4px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
    }

    .menu-item:hover {
      background: var(--sidebar-hover);
      color: var(--white);
    }

    .menu-item.active {
      background: var(--primary-blue);
      color: var(--white);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
    }

    .menu-badge {
      margin-left: auto;
      background: var(--danger);
      color: var(--white);
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 10px;
    }

    /* ============================================
       MAIN CONTENT
       ============================================ */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      min-height: 100vh;
    }

    .top-bar {
      background: var(--white);
      padding: 16px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .page-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-blue);
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .user-name {
      font-weight: 500;
      color: var(--text-dark);
    }

    .user-role {
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .content-area {
      padding: 30px;
    }

    /* ============================================
       PAGE SECTIONS
       ============================================ */
    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ============================================
       STATS CARDS
       ============================================ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card.total::before { background: var(--government-blue); }
    .stat-card.pending::before { background: var(--warning); }
    .stat-card.perbaikan::before { background: #f59e0b; }
    .stat-card.ditolak::before { background: var(--danger); }
    .stat-card.terbit::before { background: var(--success); }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 15px;
    }

    .stat-card.total .stat-icon { background: #dbeafe; color: var(--government-blue); }
    .stat-card.pending .stat-icon { background: #fef3c7; color: var(--warning); }
    .stat-card.perbaikan .stat-icon { background: #fed7aa; color: #ea580c; }
    .stat-card.ditolak .stat-icon { background: #fee2e2; color: var(--danger); }
    .stat-card.terbit .stat-icon { background: #d1fae5; color: var(--success); }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-medium);
    }

    /* ============================================
       CHARTS SECTION
       ============================================ */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      margin-bottom: 30px;
    }

    .chart-card {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
    }

    .chart-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-title i {
      color: var(--primary-blue);
    }

    /* ============================================
       FILTER SECTION
       ============================================ */
    .filter-section {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 25px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      align-items: end;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-medium);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-select, .search-input {
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      font-family: inherit;
      transition: var(--transition);
      background: var(--white);
    }

    .filter-select:focus, .search-input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .search-wrapper {
      position: relative;
    }

    .search-wrapper i {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
    }

    .search-wrapper .search-input {
      padding-left: 45px;
      width: 100%;
    }

    /* ============================================
       DATA TABLE
       ============================================ */
    .table-container {
      background: var(--white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
      overflow: hidden;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      background: var(--primary-light);
    }

    .table-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .table-scroll {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1400px;
    }

    thead {
      background: #f1f5f9;
    }

    th {
      padding: 14px 16px;
      text-align: left;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-medium);
      border-bottom: 2px solid var(--border-color);
      white-space: nowrap;
    }

    td {
      padding: 12px 16px;
      font-size: 0.85rem;
      color: var(--text-dark);
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background: var(--primary-light);
    }

    /* ============================================
       BADGES
       ============================================ */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-menunggu { background: #fef3c7; color: #92400e; }
    .badge-perbaikan { background: #fed7aa; color: #c2410c; }
    .badge-ditolak { background: #fee2e2; color: #991b1b; }
    .badge-terbit { background: #d1fae5; color: #065f46; }

    /* ============================================
       BUTTONS
       ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      font-family: inherit;
    }

    .btn-primary { background: var(--primary-blue); color: var(--white); }
    .btn-primary:hover { background: var(--primary-dark); }

    .btn-success { background: var(--success); color: var(--white); }
    .btn-success:hover { background: #059669; }

    .btn-danger { background: var(--danger); color: var(--white); }
    .btn-danger:hover { background: #dc2626; }

    .btn-warning { background: var(--warning); color: var(--white); }
    .btn-warning:hover { background: #d97706; }

    .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
    .btn-icon { padding: 8px; width: 36px; height: 36px; justify-content: center; }

    /* ============================================
       PAGINATION
       ============================================ */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-top: 1px solid var(--border-color);
      background: #fafbfc;
    }

    .pagination-info {
      font-size: 0.85rem;
      color: var(--text-medium);
    }

    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pagination-btn {
      min-width: 36px;
      height: 36px;
      border: 1px solid var(--border-color);
      background: var(--white);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
    }

    .pagination-btn:hover:not(:disabled) {
      background: var(--primary-blue);
      color: var(--white);
      border-color: var(--primary-blue);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: var(--primary-blue);
      color: var(--white);
      border-color: var(--primary-blue);
    }

    /* ============================================
       FORMS
       ============================================ */
    .form-container {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
    }

    .form-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--primary-blue);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-medium);
    }

    .form-label .required {
      color: var(--danger);
    }

    .form-input, .form-select {
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      font-family: inherit;
      transition: var(--transition);
      background: var(--white);
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .form-input.error, .form-select.error {
      border-color: var(--danger);
    }

    .form-error {
      font-size: 0.75rem;
      color: var(--danger);
      margin-top: 4px;
    }

    .file-upload-wrapper {
      position: relative;
    }

    .file-upload-area {
      border: 2px dashed var(--border-color);
      border-radius: var(--radius-md);
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .file-upload-area:hover {
      border-color: var(--primary-blue);
      background: var(--primary-light);
    }

    .file-upload-area i {
      font-size: 40px;
      color: var(--primary-blue);
      margin-bottom: 12px;
    }

    .file-upload-area p {
      color: var(--text-medium);
      margin-bottom: 8px;
    }

    .file-upload-area span {
      font-size: 0.8rem;
      color: var(--text-light);
    }

    .file-name {
      margin-top: 12px;
      padding: 8px 12px;
      background: var(--primary-light);
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      color: var(--primary-blue);
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border-color);
    }

    /* ============================================
       MODALS
       ============================================ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--white);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalIn 0.3s ease;
    }

    @keyframes modalIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-light);
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--light-bg);
      color: var(--text-dark);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* ============================================
       LOGIN PAGE
       ============================================ */
    .login-container {
      display: none; /* Removed - using modal instead */
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--government-blue) 0%, var(--primary-blue) 100%);
    }

    .login-box {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: 40px;
      width: 100%;
      max-width: 400px;
      box-shadow: var(--shadow-lg);
    }

    .login-logo {
      width: 70px;
      height: 70px;
      background: var(--primary-light);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      font-size: 32px;
      color: var(--primary-blue);
    }

    .login-title {
      text-align: center;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 8px;
    }

    .login-subtitle {
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-medium);
      margin-bottom: 32px;
    }

    /* ============================================
       TOAST NOTIFICATIONS
       ============================================ */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 3000;
    }

    .toast {
      background: var(--white);
      border-radius: var(--radius-md);
      padding: 16px 20px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      margin-bottom: 12px;
      animation: toastIn 0.3s ease;
      border-left: 4px solid;
    }

    .toast.success { border-color: var(--success); }
    .toast.error { border-color: var(--danger); }
    .toast.warning { border-color: var(--warning); }
    .toast.info { border-color: var(--info); }

    @keyframes toastIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }

    .toast-icon {
      font-size: 20px;
    }

    .toast.success .toast-icon { color: var(--success); }
    .toast.error .toast-icon { color: var(--danger); }
    .toast.warning .toast-icon { color: var(--warning); }
    .toast.info .toast-icon { color: var(--info); }

    .toast-message {
      flex: 1;
      font-size: 0.9rem;
      color: var(--text-dark);
    }

    /* ============================================
       LOADING & SKELETON
       ============================================ */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-color);
      border-radius: 50%;
      border-top-color: var(--primary-blue);
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* ============================================
       LIGHTBOX
       ============================================ */
    .lightbox-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2500;
    }

    .lightbox-overlay.active {
      display: flex;
    }

    .lightbox-content {
      max-width: 90%;
      max-height: 90%;
    }

    .lightbox-content iframe {
      width: 800px;
      height: 600px;
      border: none;
      border-radius: var(--radius-md);
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: var(--white);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--text-dark);
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 1024px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      :root {
        --sidebar-width: 0px;
      }

      .sidebar {
        transform: translateX(-100%);
        width: 260px;
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-btn {
        display: flex !important;
      }

      .filter-grid {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .pagination-container {
        flex-direction: column;
        gap: 16px;
      }
    }

    .mobile-menu-btn {
      display: none;
      width: 40px;
      height: 40px;
      border: none;
      background: var(--primary-blue);
      color: var(--white);
      border-radius: var(--radius-md);
      cursor: pointer;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .content-area {
        padding: 16px;
      }

      .form-container {
        padding: 20px;
      }
    }

    /* ============================================
       CONFIRM DIALOG
       ============================================ */
    .confirm-dialog {
      text-align: center;
    }

    .confirm-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 28px;
    }

    .confirm-icon.danger {
      background: #fee2e2;
      color: var(--danger);
    }

    .confirm-text {
      font-size: 0.95rem;
      color: var(--text-medium);
      margin-bottom: 8px;
    }

    .confirm-subtext {
      font-size: 0.85rem;
      color: var(--text-light);
    }

    /* ============================================
       EMPTY STATE
       ============================================ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state i {
      font-size: 60px;
      color: var(--text-light);
      margin-bottom: 20px;
    }

    .empty-state h3 {
      font-size: 1.1rem;
      color: var(--text-dark);
      margin-bottom: 8px;
    }

    .empty-state p {
      font-size: 0.9rem;
      color: var(--text-light);
    }

    /* ============================================
       EXPORT BUTTON
       ============================================ */
    .btn-export {
      background: var(--success);
      color: var(--white);
    }

    .btn-export:hover {
      background: #059669;
    }
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Modal: Login -->
  <div class="modal-overlay" id="loginModal">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-sign-in-alt"></i> Login Admin</h3>
        <button class="modal-close" onclick="closeModal('loginModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 20px; color: var(--text-medium);">Silakan login untuk mengakses halaman ini.</p>
        <form id="loginModalForm">
          <div class="form-group" style="margin-bottom: 16px;">
            <label class="form-label">Username</label>
            <input type="text" class="form-input" id="modalLoginUsername" placeholder="Masukkan username" required>
          </div>
          <div class="form-group" style="margin-bottom: 16px;">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="modalLoginPassword" placeholder="Masukkan password" required>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
            <i class="fas fa-sign-in-alt"></i> Masuk
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Login Page - Removed, using modal instead -->
  <div class="login-container" id="loginPage">
    <div class="login-box">
      <div class="login-logo">
        <i class="fas fa-file-signature"></i>
      </div>
      <h1 class="login-title">PAK Integrasi PNS</h1>
      <p class="login-subtitle">Masuk ke Dashboard Admin</p>
      
      <form id="loginForm">
        <div class="form-group" style="margin-bottom: 20px;">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="loginUsername" placeholder="Masukkan username" required>
        </div>
        
        <div class="form-group" style="margin-bottom: 24px;">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="loginPassword" placeholder="Masukkan password" required>
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
          <i class="fas fa-sign-in-alt"></i> Masuk
        </button>
      </form>
      
      <p style="text-align: center; margin-top: 20px; font-size: 0.8rem; color: var(--text-light);">
        Default: admin / pakintegrasi2026
      </p>
    </div>
  </div>

  <!-- App Container -->
  <div class="app-container" id="appContainer" style="display: none;">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="fas fa-file-signature"></i>
        </div>
        <h2 class="sidebar-title">PAK Integrasi</h2>
        <p class="sidebar-subtitle">Dashboard Pengelolaan</p>
      </div>
      
      <nav class="sidebar-menu">
        <div class="menu-section">Menu Utama</div>
        
        <a class="menu-item active" data-page="dashboard">
          <i class="fas fa-chart-bar"></i>
          <span>Dashboard Data</span>
        </a>
        
        <a class="menu-item" data-page="formulir">
          <i class="fas fa-file-plus"></i>
          <span>Formulir Pengajuan</span>
        </a>
        
        <a class="menu-item" data-page="tracking">
          <i class="fas fa-search-location"></i>
          <span>Pemantauan Proses</span>
        </a>
        
        <div class="menu-section">Pengelola</div>
        
        <a class="menu-item" data-page="pengelola">
          <i class="fas fa-building"></i>
          <span>Dashboard SDMK</span>
        </a>
        
        <div class="menu-section">Administrasi</div>
        
        <a class="menu-item" data-page="admin">
          <i class="fas fa-cog"></i>
          <span>Admin Panel</span>
          <span class="menu-badge" id="adminBadge" style="display: none;">!</span>
        </a>
        
        <a class="menu-item" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="top-bar">
        <div style="display: flex; align-items: center; gap: 16px;">
          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
          </button>
          <h1 class="page-title" id="pageTitle">Dashboard Data</h1>
        </div>
        
        <div class="user-info" id="userInfo" style="display: none;">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <div class="user-name" id="userName">Admin</div>
            <div class="user-role">Administrator</div>
          </div>
        </div>
      </header>

      <div class="content-area">
        <!-- DASHBOARD DATA -->
        <section class="page-section active" id="dashboardPage">
          <div class="stats-grid" id="statsGrid">
            <div class="stat-card total">
              <div class="stat-icon"><i class="fas fa-database"></i></div>
              <div class="stat-value" id="statTotal">0</div>
              <div class="stat-label">Total Pengajuan</div>
            </div>
            <div class="stat-card pending">
              <div class="stat-icon"><i class="fas fa-clock"></i></div>
              <div class="stat-value" id="statPending">0</div>
              <div class="stat-label">Menunggu</div>
            </div>
            <div class="stat-card perbaikan">
              <div class="stat-icon"><i class="fas fa-edit"></i></div>
              <div class="stat-value" id="statPerbaikan">0</div>
              <div class="stat-label">Perbaikan</div>
            </div>
            <div class="stat-card ditolak">
              <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
              <div class="stat-value" id="statDitolak">0</div>
              <div class="stat-label">Ditolak</div>
            </div>
            <div class="stat-card terbit">
              <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
              <div class="stat-value" id="statTerbit">0</div>
              <div class="stat-label">Terbit</div>
            </div>
          </div>

          <div class="charts-grid">
            <div class="chart-card">
              <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Status Pengajuan</h3>
              <canvas id="pieChart"></canvas>
            </div>
            <div class="chart-card">
              <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Jenis JF</h3>
              <canvas id="barChart"></canvas>
            </div>
            <div class="chart-card">
              <h3 class="chart-title"><i class="fas fa-chart-line"></i> Pengajuan per Bulan</h3>
              <canvas id="lineChart"></canvas>
            </div>
          </div>

          <div class="filter-section">
            <div class="filter-grid">
              <div class="filter-group">
                <label class="filter-label">Pencarian</label>
                <div class="search-wrapper">
                  <i class="fas fa-search"></i>
                  <input type="text" class="search-input" id="dashboardSearch" placeholder="Cari nama, NIP, atau satker...">
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Jenis JF</label>
                <select class="filter-select" id="dashboardFilterJF">
                  <option value="">Semua Jenis JF</option>
                  <option value="JFT">JFT (Jabatan Fungsional Tertentu)</option>
                  <option value="JFU">JFU (Jabatan Fungsional Umum)</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Status</label>
                <select class="filter-select" id="dashboardFilterStatus">
                  <option value="">Semua Status</option>
                  <option value="Menunggu">Menunggu</option>
                  <option value="Perbaikan">Perbaikan</option>
                  <option value="Ditolak">Ditolak</option>
                  <option value="Terbit">Terbit</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title"><i class="fas fa-list"></i> Data Pengajuan</h3>
              <button class="btn btn-primary btn-sm" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>No</th>
                    <th>Nama Lengkap</th>
                    <th>NIP</th>
                    <th>Satuan Kerja</th>
                    <th>Jenis JF</th>
                    <th>Jenjang JF</th>
                    <th>Status</th>
                    <th>Tanggal Submit</th>
                  </tr>
                </thead>
                <tbody id="dashboardTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
            <div class="pagination-container">
              <div class="pagination-info" id="dashboardPaginationInfo">
                Menampilkan 0 - 0 dari 0 data
              </div>
              <div class="pagination-controls" id="dashboardPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </section>

        <!-- FORMULIR PENGAJUAN -->
        <section class="page-section" id="formulirPage">
          <div class="form-container">
            <h2 class="form-title"><i class="fas fa-file-plus"></i> Formulir Pengajuan PAK</h2>
            
            <form id="pengajuanForm">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Email <span class="required">*</span></label>
                  <input type="email" class="form-input" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">No. HP <span class="required">*</span></label>
                  <input type="tel" class="form-input" id="noHP" name="noHP" required>
                </div>
                
                <div class="form-group full-width">
                  <label class="form-label">Nama Lengkap dengan Gelar <span class="required">*</span></label>
                  <input type="text" class="form-input" id="nama" name="nama" placeholder="Dr. Nama Lengkap, M.Kes" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">NIP <span class="required">*</span></label>
                  <input type="text" class="form-input" id="nip" name="nip" maxlength="18" placeholder="123456789012345678" required>
                  <div class="form-error" id="nipError"></div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">No. Karpeg</label>
                  <input type="text" class="form-input" id="noKarpeg" name="noKarpeg">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Tempat Lahir <span class="required">*</span></label>
                  <input type="text" class="form-input" id="tempatLahir" name="tempatLahir" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Tanggal Lahir <span class="required">*</span></label>
                  <input type="date" class="form-input" id="tanggalLahir" name="tanggalLahir" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Pendidikan <span class="required">*</span></label>
                  <select class="form-select" id="pendidikan" name="pendidikan" required>
                    <option value="">Pilih Pendidikan</option>
                    <option value="SMA/SMK">SMA/SMK</option>
                    <option value="D3">D3 (Diploma)</option>
                    <option value="S1">S1 (Sarjana)</option>
                    <option value="Profesi">Profesi</option>
                    <option value="S2">S2 (Magister)</option>
                    <option value="S3">S3 (Doktor)</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Jenis Kelamin <span class="required">*</span></label>
                  <select class="form-select" id="jenisKelamin" name="jenisKelamin" required>
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Pangkat/Gol <span class="required">*</span></label>
                  <select class="form-select" id="pangkatGol" name="pangkatGol" required>
                    <option value="">Pilih Pangkat</option>
                    <option value="I/a">I/a - Juru Muda</option>
                    <option value="I/b">I/b - Juru Muda Tingkat I</option>
                    <option value="I/c">I/c - Juru</option>
                    <option value="I/d">I/d - Juru Tingkat I</option>
                    <option value="II/a">II/a - Pengatur Muda</option>
                    <option value="II/b">II/b - Pengatur Muda Tingkat I</option>
                    <option value="II/c">II/c - Pengatur</option>
                    <option value="II/d">II/d - Pengatur Tingkat I</option>
                    <option value="III/a">III/a - Penata Muda</option>
                    <option value="III/b">III/b - Penata Muda Tingkat I</option>
                    <option value="III/c">III/c - Penata</option>
                    <option value="III/d">III/d - Penata Tingkat I</option>
                    <option value="IV/a">IV/a - Pembina</option>
                    <option value="IV/b">IV/b - Pembina Tingkat I</option>
                    <option value="IV/c">IV/c - Pembina Utama Muda</option>
                    <option value="IV/d">IV/d - Pembina Utama Madya</option>
                    <option value="IV/e">IV/e - Pembina Utama</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">TMT Pangkat <span class="required">*</span></label>
                  <input type="date" class="form-input" id="tmtPangkat" name="tmtPangkat" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Jenis JF <span class="required">*</span></label>
                  <select class="form-select" id="jenisJF" name="jenisJF" required>
                    <option value="">Pilih Jenis JF</option>
                    <option value="JFT">JFT (Jabatan Fungsional Tertentu)</option>
                    <option value="JFU">JFU (Jabatan Fungsional Umum)</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Jenjang JF <span class="required">*</span></label>
                  <select class="form-select" id="jenjangJF" name="jenjangJF" required>
                    <option value="">Pilih Jenjang</option>
                    <option value="Terampil">Terampil</option>
                    <option value="Mahir">Mahir</option>
                    <option value="Penyelia">Penyelia</option>
                    <option value="Pertama">Pertama</option>
                    <option value="Muda">Muda</option>
                    <option value="Madya">Madya</option>
                    <option value="Utama">Utama</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">TMT JF <span class="required">*</span></label>
                  <input type="date" class="form-input" id="tmtJF" name="tmtJF" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Masa Kerja Gol <span class="required">*</span></label>
                  <input type="text" class="form-input" id="masaKerjaGol" name="masaKerjaGol" placeholder="Contoh: 05 Tahun 03 Bulan" required>
                </div>
                
                <div class="form-group full-width">
                  <label class="form-label">Satuan Kerja <span class="required">*</span></label>
                  <select class="form-select" id="satuanKerja" name="satuanKerja" required>
                    <option value="">Pilih Satuan Kerja</option>
                    <option value="RSUD">RSUD</option>
                    <option value="Puskesmas">Puskesmas</option>
                    <option value="Dinkes">Dinas Kesehatan</option>
                    <option value="RSUD тип B">RSUD тип B</option>
                    <option value="RSUD тип C">RSUD тип C</option>
                    <option value="RSUD тип D">RSUD тип D</option>
                  </select>
                </div>
                
                <div class="form-group full-width">
                  <label class="form-label">Upload Dokumen Kelengkapan (PDF) <span class="required">*</span></label>
                  <div class="file-upload-wrapper">
                    <div class="file-upload-area" id="fileUploadArea">
                      <i class="fas fa-cloud-upload-alt"></i>
                      <p>Klik atau drag file PDF di sini</p>
                      <span>Ukuran maksimal: 10MB</span>
                    </div>
                    <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                    <div class="file-name" id="fileName" style="display: none;"></div>
                  </div>
                </div>
              </div>
              
              <div class="form-actions">
                <button type="submit" class="btn btn-primary" id="submitBtn">
                  <i class="fas fa-paper-plane"></i> Submit Pengajuan
                </button>
                <button type="reset" class="btn btn-warning">
                  <i class="fas fa-redo"></i> Reset Form
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- PEMANTAUAN PROSES / TRACKING -->
        <section class="page-section" id="trackingPage">
          <div class="filter-section">
            <div class="filter-grid">
              <div class="filter-group">
                <label class="filter-label">Pencarian Nama</label>
                <div class="search-wrapper">
                  <i class="fas fa-search"></i>
                  <input type="text" class="search-input" id="trackingSearch" placeholder="Cari nama...">
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Status</label>
                <select class="filter-select" id="trackingFilterStatus">
                  <option value="">Semua Status</option>
                  <option value="Menunggu">Menunggu</option>
                  <option value="Perbaikan">Perbaikan</option>
                  <option value="Ditolak">Ditolak</option>
                  <option value="Terbit">Terbit</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Satuan Kerja</label>
                <select class="filter-select" id="trackingFilterSatker">
                  <option value="">Semua Satuan Kerja</option>
                  <option value="RSUD">RSUD</option>
                  <option value="Puskesmas">Puskesmas</option>
                  <option value="Dinkes">Dinas Kesehatan</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title"><i class="fas fa-search-location"></i> Status Pengajuan</h3>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>No</th>
                    <th>Nama Lengkap</th>
                    <th>Satuan Kerja</th>
                    <th>Jenis JF</th>
                    <th>Status</th>
                    <th>Catatan Admin</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="trackingTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
            <div class="pagination-container">
              <div class="pagination-info" id="trackingPaginationInfo">
                Menampilkan 0 - 0 dari 0 data
              </div>
              <div class="pagination-controls" id="trackingPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </section>

        <!-- DASHBOARD PENGELOLA SDMK -->
        <section class="page-section" id="pengelolaPage">
          <div class="stats-grid">
            <div class="stat-card total">
              <div class="stat-icon"><i class="fas fa-building"></i></div>
              <div class="stat-value" id="pengelolaTotal">0</div>
              <div class="stat-label">Total Pengajuan</div>
            </div>
            <div class="stat-card terbit">
              <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
              <div class="stat-value" id="pengelolaTerbit">0</div>
              <div class="stat-label">Terbit</div>
            </div>
            <div class="stat-card pending">
              <div class="stat-icon"><i class="fas fa-clock"></i></div>
              <div class="stat-value" id="pengelolaPending">0</div>
              <div class="stat-label">Menunggu</div>
            </div>
          </div>

          <div class="charts-grid">
            <div class="chart-card">
              <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Rekap per Satuan Kerja</h3>
              <canvas id="pengelolaChart"></canvas>
            </div>
          </div>

          <div class="filter-section">
            <div class="filter-grid">
              <div class="filter-group">
                <label class="filter-label">Pencarian</label>
                <div class="search-wrapper">
                  <i class="fas fa-search"></i>
                  <input type="text" class="search-input" id="pengelolaSearch" placeholder="Cari data...">
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Status</label>
                <select class="filter-select" id="pengelolaFilterStatus">
                  <option value="">Semua Status</option>
                  <option value="Menunggu">Menunggu</option>
                  <option value="Perbaikan">Perbaikan</option>
                  <option value="Ditolak">Ditolak</option>
                  <option value="Terbit">Terbit</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title"><i class="fas fa-list"></i> Data Lengkap Pengajuan</h3>
              <button class="btn btn-export btn-sm" onclick="exportExcel()">
                <i class="fas fa-file-excel"></i> Export Excel
              </button>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>No</th>
                    <th>Nama Lengkap</th>
                    <th>NIP</th>
                    <th>Pangkat/Gol</th>
                    <th>Satuan Kerja</th>
                    <th>Jenis JF</th>
                    <th>Jenjang JF</th>
                    <th>Status</th>
                    <th>Catatan</th>
                  </tr>
                </thead>
                <tbody id="pengelolaTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
            <div class="pagination-container">
              <div class="pagination-info" id="pengelolaPaginationInfo">
                Menampilkan 0 - 0 dari 0 data
              </div>
              <div class="pagination-controls" id="pengelolaPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </section>

        <!-- ADMIN PANEL -->
        <section class="page-section" id="adminPage">
          <div class="filter-section">
            <div class="filter-grid">
              <div class="filter-group">
                <label class="filter-label">Pencarian</label>
                <div class="search-wrapper">
                  <i class="fas fa-search"></i>
                  <input type="text" class="search-input" id="adminSearch" placeholder="Cari data...">
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Jenis JF</label>
                <select class="filter-select" id="adminFilterJF">
                  <option value="">Semua Jenis JF</option>
                  <option value="JFT">JFT</option>
                  <option value="JFU">JFU</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Status</label>
                <select class="filter-select" id="adminFilterStatus">
                  <option value="">Semua Status</option>
                  <option value="Menunggu">Menunggu</option>
                  <option value="Perbaikan">Perbaikan</option>
                  <option value="Ditolak">Ditolak</option>
                  <option value="Terbit">Terbit</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Satuan Kerja</label>
                <select class="filter-select" id="adminFilterSatker">
                  <option value="">Semua Satuan Kerja</option>
                  <option value="RSUD">RSUD</option>
                  <option value="Puskesmas">Puskesmas</option>
                  <option value="Dinkes">Dinas Kesehatan</option>
                </select>
              </div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title"><i class="fas fa-cog"></i> Kelola Data Pengajuan</h3>
              <button class="btn btn-primary btn-sm" onclick="refreshAdmin()">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>No</th>
                    <th>Nama Lengkap</th>
                    <th>NIP</th>
                    <th>Pangkat/Gol</th>
                    <th>Satuan Kerja</th>
                    <th>Jenis JF</th>
                    <th>Status</th>
                    <th>Update Terakhir</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="adminTableBody">
                  <!-- Data will be loaded here -->
                </tbody>
              </table>
            </div>
            <div class="pagination-container">
              <div class="pagination-info" id="adminPaginationInfo">
                Menampilkan 0 - 0 dari 0 data
              </div>
              <div class="pagination-controls" id="adminPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Modal: Detail -->
  <div class="modal-overlay" id="detailModal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-eye"></i> Detail Pengajuan</h3>
        <button class="modal-close" onclick="closeModal('detailModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body" id="detailModalBody">
        <!-- Content will be loaded here -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeModal('detailModal')">
          <i class="fas fa-check"></i> Tutup
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Update Status -->
  <div class="modal-overlay" id="statusModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-edit"></i> Update Status</h3>
        <button class="modal-close" onclick="closeModal('statusModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="statusRowNumber">
        
        <div class="form-group" style="margin-bottom: 20px;">
          <label class="form-label">Status</label>
          <select class="form-select" id="updateStatus" style="width: 100%;">
            <option value="Menunggu">Menunggu</option>
            <option value="Perbaikan">Perbaikan</option>
            <option value="Ditolak">Ditolak</option>
            <option value="Terbit">Terbit</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Catatan Admin</label>
          <textarea class="form-input" id="updateCatatan" rows="4" placeholder="Masukkan catatan..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="submitStatusUpdate()">
          <i class="fas fa-save"></i> Simpan
        </button>
        <button class="btn btn-warning" onclick="closeModal('statusModal')">
          <i class="fas fa-times"></i> Batal
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Data -->
  <div class="modal-overlay" id="editModal">
    <div class="modal" style="max-width: 700px;">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Data</h3>
        <button class="modal-close" onclick="closeModal('editModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editRowNumber">
        
        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
          <div class="form-group">
            <label class="form-label">Nama Lengkap</label>
            <input type="text" class="form-input" id="editNama">
          </div>
          <div class="form-group">
            <label class="form-label">NIP</label>
            <input type="text" class="form-input" id="editNIP">
          </div>
          <div class="form-group">
            <label class="form-label">Pangkat/Gol</label>
            <select class="form-select" id="editPangkatGol" style="width: 100%;">
              <option value="I/a">I/a - Juru Muda</option>
              <option value="I/b">I/b - Juru Muda Tingkat I</option>
              <option value="I/c">I/c - Juru</option>
              <option value="I/d">I/d - Juru Tingkat I</option>
              <option value="II/a">II/a - Pengatur Muda</option>
              <option value="II/b">II/b - Pengatur Muda Tingkat I</option>
              <option value="II/c">II/c - Pengatur</option>
              <option value="II/d">II/d - Pengatur Tingkat I</option>
              <option value="III/a">III/a - Penata Muda</option>
              <option value="III/b">III/b - Penata Muda Tingkat I</option>
              <option value="III/c">III/c - Penata</option>
              <option value="III/d">III/d - Penata Tingkat I</option>
              <option value="IV/a">IV/a - Pembina</option>
              <option value="IV/b">IV/b - Pembina Tingkat I</option>
              <option value="IV/c">IV/c - Pembina Utama Muda</option>
              <option value="IV/d">IV/d - Pembina Utama Madya</option>
              <option value="IV/e">IV/e - Pembina Utama</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Jenis JF</label>
            <select class="form-select" id="editJenisJF" style="width: 100%;">
              <option value="JFT">JFT</option>
              <option value="JFU">JFU</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Jenjang JF</label>
            <select class="form-select" id="editJenjangJF" style="width: 100%;">
              <option value="Terampil">Terampil</option>
              <option value="Mahir">Mahir</option>
              <option value="Penyelia">Penyelia</option>
              <option value="Pertama">Pertama</option>
              <option value="Muda">Muda</option>
              <option value="Madya">Madya</option>
              <option value="Utama">Utama</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Satuan Kerja</label>
            <select class="form-select" id="editSatuanKerja" style="width: 100%;">
              <option value="RSUD">RSUD</option>
              <option value="Puskesmas">Puskesmas</option>
              <option value="Dinkes">Dinas Kesehatan</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">TMT Pangkat</label>
            <input type="date" class="form-input" id="editTmtpangkat">
          </div>
          <div class="form-group">
            <label class="form-label">TMT JF</label>
            <input type="date" class="form-input" id="editTmtjf">
          </div>
          <div class="form-group" style="grid-column: 1 / -1;">
            <label class="form-label">Masa Kerja Gol</label>
            <input type="text" class="form-input" id="editMasaKerjaGol" placeholder="Contoh: 05 Tahun 03 Bulan">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="submitEdit()">
          <i class="fas fa-save"></i> Simpan Perubahan
        </button>
        <button class="btn btn-warning" onclick="closeModal('editModal')">
          <i class="fas fa-times"></i> Batal
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Delete Confirm -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-body">
        <div class="confirm-dialog">
          <div class="confirm-icon danger">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h3 style="margin-bottom: 12px;">Hapus Data?</h3>
          <p class="confirm-text">Apakah Anda yakin ingin menghapus data ini?</p>
          <p class="confirm-subtext">Tindakan ini tidak dapat dibatalkan.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="confirmDelete()">
          <i class="fas fa-trash"></i> Hapus
        </button>
        <button class="btn btn-warning" onclick="closeModal('deleteModal')">
          <i class="fas fa-times"></i> Batal
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: View Document -->
  <div class="modal-overlay" id="documentModal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-file-pdf"></i> Preview Dokumen</h3>
        <button class="modal-close" onclick="closeModal('documentModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <iframe id="documentViewer" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>
      </div>
      <div class="modal-footer">
        <a href="#" target="_blank" class="btn btn-primary" id="documentLink">
          <i class="fas fa-external-link-alt"></i> Buka di Tab Baru
        </a>
        <button class="btn btn-warning" onclick="closeModal('documentModal')">
          <i class="fas fa-times"></i> Tutup
        </button>
      </div>
    </div>
  </div>

  <!-- Lightbox for PDF -->
  <div class="lightbox-overlay" id="lightbox">
    <button class="lightbox-close" onclick="closeLightbox()">
      <i class="fas fa-times"></i>
    </button>
    <div class="lightbox-content">
      <iframe id="lightboxIframe" style="width: 900px; height: 600px; border: none; border-radius: 8px;"></iframe>
    </div>
  </div>

  <script>
    // ============================================
    // GLOBAL VARIABLES
    // ============================================
    // GANTI INI DENGAN URL GOOGLE APPS SCRIPT ANDA
    // Format: https://script.google.com/macros/s/XXXXX/exec
    const SCRIPT_URL = "ISI_URL_GOOGLE_SCRIPT_DISINI";
    let allData = [];
    let filteredData = [];
    let adminToken = sessionStorage.getItem('adminToken');
    let currentPage = 1;
    const ITEMS_PER_PAGE = 10;
    let deleteRowNumber = null;
    let pieChart = null;
    let barChart = null;
    let lineChart = null;
    let pengelolaChart = null;

    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      initApp();
    });

    function initApp() {
      // Always show app container - all pages accessible without login
      // Login only required for admin and SDMK pages
      document.getElementById('appContainer').style.display = 'flex';
      document.getElementById('loginPage').style.display = 'none';
      
      // Load dashboard data (public access)
      loadDashboardData();
      
      // Setup event listeners
      setupEventListeners();
    }

    function setupEventListeners() {
      // Mobile menu
      document.getElementById('mobileMenuBtn').addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('active');
      });

      // Menu navigation
      document.querySelectorAll('.menu-item[data-page]').forEach(item => {
        item.addEventListener('click', function() {
          const page = this.getAttribute('data-page');
          navigateTo(page);
        });
      });

      // Login form (removed - using modal instead)
      // document.getElementById('loginForm').addEventListener('submit', handleLogin);
      
      // Modal login form
      document.getElementById('loginModalForm').addEventListener('submit', handleModalLogin);
      
      // Logout
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);

      // File upload
      const fileUploadArea = document.getElementById('fileUploadArea');
      const fileInput = document.getElementById('fileInput');

      fileUploadArea.addEventListener('click', () => fileInput.click());
      fileUploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUploadArea.style.borderColor = 'var(--primary-blue)';
      });
      fileUploadArea.addEventListener('dragleave', () => {
        fileUploadArea.style.borderColor = 'var(--border-color)';
      });
      fileUploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUploadArea.style.borderColor = 'var(--border-color)';
        if (e.dataTransfer.files.length) {
          handleFileSelect(e.dataTransfer.files[0]);
        }
      });
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
          handleFileSelect(e.target.files[0]);
        }
      });

      // Form submit
      document.getElementById('pengajuanForm').addEventListener('submit', handleFormSubmit);

      // NIP validation
      document.getElementById('nip').addEventListener('blur', validateNIP);

      // Auto uppercase nama
      document.getElementById('nama').addEventListener('input', function() {
        this.value = this.value.toUpperCase();
      });

      // Search with debounce
      let dashboardSearchTimeout;
      document.getElementById('dashboardSearch').addEventListener('input', function() {
        clearTimeout(dashboardSearchTimeout);
        dashboardSearchTimeout = setTimeout(() => filterDashboard(), 300);
      });

      let adminSearchTimeout;
      document.getElementById('adminSearch').addEventListener('input', function() {
        clearTimeout(adminSearchTimeout);
        adminSearchTimeout = setTimeout(() => filterAdmin(), 300);
      });

      let trackingSearchTimeout;
      document.getElementById('trackingSearch').addEventListener('input', function() {
        clearTimeout(trackingSearchTimeout);
        trackingSearchTimeout = setTimeout(() => filterTracking(), 300);
      });

      let pengelolaSearchTimeout;
      document.getElementById('pengelolaSearch').addEventListener('input', function() {
        clearTimeout(pengelolaSearchTimeout);
        pengelolaSearchTimeout = setTimeout(() => filterPengelola(), 300);
      });

      // Filter changes
      document.getElementById('dashboardFilterJF').addEventListener('change', filterDashboard);
      document.getElementById('dashboardFilterStatus').addEventListener('change', filterDashboard);
      document.getElementById('trackingFilterStatus').addEventListener('change', filterTracking);
      document.getElementById('trackingFilterSatker').addEventListener('change', filterTracking);
      document.getElementById('adminFilterJF').addEventListener('change', filterAdmin);
      document.getElementById('adminFilterStatus').addEventListener('change', filterAdmin);
      document.getElementById('adminFilterSatker').addEventListener('change', filterAdmin);
      document.getElementById('pengelolaFilterStatus').addEventListener('change', filterPengelola);
    }

    // ============================================
    // AUTHENTICATION (Modal only - for restricted pages)
    // ============================================
    function handleModalLogin(e) {
      e.preventDefault();
      
      const username = document.getElementById('modalLoginUsername').value;
      const password = document.getElementById('modalLoginPassword').value;

      showToast('Sedang login...', 'info');

      // For demo purposes, simulate login
      // In production, this would call the Google Apps Script
      if (username === 'admin' && password === 'pakintegrasi2026') {
        adminToken = btoa(username + ':' + new Date().getTime());
        sessionStorage.setItem('adminToken', adminToken);
        sessionStorage.setItem('adminUser', username);
        
        closeModal('loginModal');
        showApp();
        loadDashboardData();
        showToast('Login berhasil!', 'success');
        
        // Clear form
        document.getElementById('modalLoginUsername').value = '';
        document.getElementById('modalLoginPassword').value = '';
      } else {
        showToast('Username atau password salah!', 'error');
      }
    }

    function handleLogout() {
      sessionStorage.removeItem('adminToken');
      sessionStorage.removeItem('adminUser');
      adminToken = null;
      showLogin();
      showToast('Logout berhasil!', 'success');
    }

    function showLogin() {
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('appContainer').style.display = 'none';
    }
    
    function showLoginModal() {
      document.getElementById('loginModal').classList.add('active');
    }
    
    function showApp() {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('appContainer').style.display = 'flex';
      
      if (adminToken) {
        document.getElementById('userInfo').style.display = 'flex';
        document.getElementById('userName').textContent = sessionStorage.getItem('adminUser') || 'Admin';
      } else {
        document.getElementById('userInfo').style.display = 'none';
      }
    }

    // ============================================
    // NAVIGATION
    // ============================================
    // Menu yang membutuhkan login
    const RESTRICTED_PAGES = ['admin', 'pengelola'];
    
    function navigateTo(page) {
      // Cek akses untuk halaman terbatas
      if (RESTRICTED_PAGES.includes(page)) {
        if (!adminToken) {
          showToast('Silakan login terlebih dahulu!', 'warning');
          showLoginModal();
          return;
        }
      }
      
      // Update menu active state
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === page) {
          item.classList.add('active');
        }
      });

      // Update page title
      const titles = {
        'dashboard': 'Dashboard Data',
        'formulir': 'Formulir Pengajuan',
        'tracking': 'Pemantauan Proses',
        'pengelola': 'Dashboard SDMK',
        'admin': 'Admin Panel'
      };
      document.getElementById('pageTitle').textContent = titles[page] || 'Dashboard';

      // Show page section
      document.querySelectorAll('.page-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(page + 'Page').classList.add('active');

      // Close mobile sidebar
      document.getElementById('sidebar').classList.remove('active');

      // Load data for specific pages
      if (page === 'dashboard') {
        loadDashboardData();
      } else if (page === 'tracking') {
        loadTrackingData();
      } else if (page === 'pengelola') {
        loadPengelolaData();
      } else if (page === 'admin') {
        loadAdminData();
      }
    }

    // ============================================
    // API CALLS TO GOOGLE APPS SCRIPT
    // ============================================
    
    async function apiCall(action, params = {}) {
      // Jika menggunakan demo mode (belum dikonfigurasi)
      if (SCRIPT_URL === 'ISI_URL_GOOGLE_SCRIPT_DISINI' || !SCRIPT_URL) {
        console.log('Demo mode - using mock data');
        return null; // Will use demo data
      }
      
      try {
        const url = new URL(SCRIPT_URL);
        url.searchParams.append('action', action);
        
        Object.keys(params).forEach(key => {
          url.searchParams.append(key, params[key]);
        });
        
        const response = await fetch(url.toString(), {
          method: 'GET',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('API Error:', error);
        // Fallback to demo mode on network errors
        showToast('Mode offline - menggunakan data demo', 'warning');
        return null;
      }
    }

    async function apiPost(action, data = {}) {
      // Jika menggunakan demo mode
      if (SCRIPT_URL === 'ISI_URL_GOOGLE_SCRIPT_DISINI' || !SCRIPT_URL) {
        console.log('Demo mode - using mock data');
        return null;
      }
      
      try {
        const formData = new FormData();
        formData.append('action', action);
        
        Object.keys(data).forEach(key => {
          formData.append(key, data[key]);
        });
        
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('API Error:', error);
        showToast('Gagal terhubung ke server', 'error');
        return null;
      }
    }

    function isDemoMode() {
      return SCRIPT_URL === 'ISI_URL_GOOGLE_SCRIPT_DISINI' || !SCRIPT_URL;
    }

    // ============================================
    // DATA LOADING
    // ============================================
    async function loadDashboardData() {
      if (isDemoMode()) {
        // Demo mode - use mock data
        const demoData = generateDemoData();
        allData = demoData;
        filteredData = [...allData];
        updateStats();
        updateCharts();
        renderDashboardTable();
      } else {
        // Production mode - fetch from API
        const result = await apiCall('getAllData');
        if (result && result.success) {
          allData = result.data;
          filteredData = [...allData];
          updateStats();
          updateCharts();
          renderDashboardTable();
        } else {
          showToast(result?.message || 'Gagal memuat data', 'error');
        }
      }
    }

    function generateDemoData() {
      const names = [
        'Dr. Ahmad Faisal, M.Kes', 'Dr. Budi Santoso, Sp.PD', 'Dr. Siti Rahayu, M.KM',
        'Dr. Hasan Wijaya, M.PD', 'Dr. Dewi Susilowati, Sp.A', 'Dr. Rudi Hermawan, M.Fis',
        'Dr. Maya Kartika, M.Biomed', 'Dr. Ferry Susanto, Sp.B', 'Dr. Nita Wahyuni, M.Kes',
        'Dr. Wahyu Nugroho, M.PH', 'Dr. Lisa Permata, Sp.KG', 'Dr. Bayu Pratama, M.Ked',
        'Dr. Rina Susilowati, Sp.M', 'Dr. Indra Jaya, M.Si', 'Dr. Sari Dewi, M.KM'
      ];
      const satkers = ['RSUD', 'Puskesmas', 'Dinkes', 'RSUD Tipe B', 'RSUD Tipe C'];
      const statuses = ['Menunggu', 'Menunggu', 'Menunggu', 'Perbaikan', 'Ditolak', 'Terbit'];
      const jfts = ['JFT', 'JFU'];
      const jenjangs = ['Pertama', 'Muda', 'Madya', 'Utama', 'Terampil', 'Mahir'];
      const pangkats = ['III/a', 'III/b', 'IV/a', 'IV/b'];

      const data = [];
      for (let i = 0; i < 25; i++) {
        const date = new Date();
        date.setDate(date.getDate() - Math.floor(Math.random() * 90));
        
        data.push({
          'Timestamp': date.toISOString(),
          'Email': `pegawai${i + 1}@gmail.com`,
          'NoHP': `0812${Math.floor(Math.random() * 100000000)}`,
          'Nama Lengkap dengan Gelar': names[Math.floor(Math.random() * names.length)],
          'NIP': `${Math.floor(Math.random() * 900000000000000000) + 100000000000000000}`,
          'No Karpeg': `K${Math.floor(Math.random() * 900000) + 100000}`,
          'Tempat & Tanggal Lahir': 'Jakarta, 15 Maret 1985',
          'Pendidikan': ['S1', 'S2', 'S2', 'S1', 'Profesi'][Math.floor(Math.random() * 5)],
          'Jenis Kelamin': Math.random() > 0.5 ? 'Laki-laki' : 'Perempuan',
          'Pangkat/Gol': pangkats[Math.floor(Math.random() * pangkats.length)],
          'TMT Pangkat': '2020-01-01',
          'Jenis JF': jfts[Math.floor(Math.random() * jfts.length)],
          'Jenjang JF': jenjangs[Math.floor(Math.random() * jenjangs.length)],
          'TMT JF': '2021-06-01',
          'Masa Kerja Gol': `${Math.floor(Math.random() * 15)} Tahun ${Math.floor(Math.random() * 12)} Bulan`,
          'Satuan Kerja': satkers[Math.floor(Math.random() * satkers.length)],
          'Upload Dokumen (Drive Link)': 'https://drive.google.com/file/d/demo',
          'Status': statuses[Math.floor(Math.random() * statuses.length)],
          'Catatan Admin': '',
          'Update Terakhir': new Date().toISOString()
        });
      }
      return data;
    }

    function loadTrackingData() {
      filteredData = [...allData];
      renderTrackingTable();
    }

    function loadPengelolaData() {
      filteredData = [...allData];
      updatePengelolaStats();
      renderPengelolaTable();
    }

    function loadAdminData() {
      filteredData = [...allData];
      renderAdminTable();
    }

    // ============================================
    // STATISTICS & CHARTS
    // ============================================
    function updateStats() {
      const total = allData.length;
      const ditolak = allData.filter(d => d['Status'] === 'Ditolak').length;
      const perbaikan = allData.filter(d => d['Status'] === 'Perbaikan').length;
      const terbit = allData.filter(d => d['Status'] === 'Terbit').length;
      const pending = allData.filter(d => !d['Status'] || d['Status'] === 'Menunggu').length;

      document.getElementById('statTotal').textContent = total;
      document.getElementById('statPending').textContent = pending;
      document.getElementById('statPerbaikan').textContent = perbaikan;
      document.getElementById('statDitolak').textContent = ditolak;
      document.getElementById('statTerbit').textContent = terbit;
    }

    function updateCharts() {
      // Pie Chart - Status
      const statusCounts = {
        'Menunggu': 0,
        'Perbaikan': 0,
        'Ditolak': 0,
        'Terbit': 0
      };

      allData.forEach(d => {
        const status = d['Status'] || 'Menunggu';
        statusCounts[status] = (statusCounts[status] || 0) + 1;
      });

      if (pieChart) pieChart.destroy();
      pieChart = new Chart(document.getElementById('pieChart'), {
        type: 'doughnut',
        data: {
          labels: Object.keys(statusCounts),
          datasets: [{
            data: Object.values(statusCounts),
            backgroundColor: ['#f59e0b', '#f97316', '#ef4444', '#10b981'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });

      // Bar Chart - Jenis JF
      const jfCounts = {};
      allData.forEach(d => {
        const jf = d['Jenis JF'] || 'Tidak Diketahui';
        jfCounts[jf] = (jfCounts[jf] || 0) + 1;
      });

      if (barChart) barChart.destroy();
      barChart = new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(jfCounts),
          datasets: [{
            label: 'Jumlah',
            data: Object.values(jfCounts),
            backgroundColor: '#1a73e8',
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // Line Chart - Pengajuan per Bulan
      const bulanCounts = {};
      allData.forEach(d => {
        const date = new Date(d['Timestamp']);
        const bulan = date.toLocaleString('id-ID', { month: 'long', year: 'numeric' });
        bulanCounts[bulan] = (bulanCounts[bulan] || 0) + 1;
      });

      if (lineChart) lineChart.destroy();
      lineChart = new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
          labels: Object.keys(bulanCounts),
          datasets: [{
            label: 'Jumlah Pengajuan',
            data: Object.values(bulanCounts),
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    function updatePengelolaStats() {
      const total = filteredData.length;
      const terbit = filteredData.filter(d => d['Status'] === 'Terbit').length;
      const pending = filteredData.filter(d => !d['Status'] || d['Status'] === 'Menunggu').length;

      document.getElementById('pengelolaTotal').textContent = total;
      document.getElementById('pengelolaTerbit').textContent = terbit;
      document.getElementById('pengelolaPending').textContent = pending;

      // Chart
      const satkerCounts = {};
      filteredData.forEach(d => {
        const satker = d['Satuan Kerja'] || 'Tidak Diketahui';
        satkerCounts[satker] = (satkerCounts[satker] || 0) + 1;
      });

      if (pengelolaChart) pengelolaChart.destroy();
      pengelolaChart = new Chart(document.getElementById('pengelolaChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(satkerCounts),
          datasets: [{
            label: 'Jumlah Pengajuan',
            data: Object.values(satkerCounts),
            backgroundColor: '#1a73e8',
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          indexAxis: 'y',
          plugins: { legend: { display: false } },
          scales: { x: { beginAtZero: true } }
        }
      });
    }

    // ============================================
    // TABLE RENDERING
    // ============================================
    function renderDashboardTable() {
      currentPage = 1;
      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageData = filteredData.slice(start, end);

      const tbody = document.getElementById('dashboardTableBody');
      
      if (pageData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px;">
              <i class="fas fa-inbox" style="font-size: 40px; color: var(--text-light); margin-bottom: 12px;"></i>
              <p>Tidak ada data</p>
            </td>
          </tr>
        `;
      } else {
        tbody.innerHTML = pageData.map((row, index) => `
          <tr>
            <td>${start + index + 1}</td>
            <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
            <td>${row['NIP'] || '-'}</td>
            <td>${row['Satuan Kerja'] || '-'}</td>
            <td>${row['Jenis JF'] || '-'}</td>
            <td>${row['Jenjang JF'] || '-'}</td>
            <td>${getStatusBadge(row['Status'])}</td>
            <td>${formatDate(row['Timestamp'])}</td>
          </tr>
        `).join('');
      }

      renderPagination('dashboard', filteredData.length);
    }

    function renderTrackingTable() {
      currentPage = 1;
      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageData = filteredData.slice(start, end);

      const tbody = document.getElementById('trackingTableBody');
      
      if (pageData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px;">
              <i class="fas fa-inbox" style="font-size: 40px; color: var(--text-light); margin-bottom: 12px;"></i>
              <p>Tidak ada data</p>
            </td>
          </tr>
        `;
      } else {
        tbody.innerHTML = pageData.map((row, index) => `
          <tr>
            <td>${start + index + 1}</td>
            <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
            <td>${row['Satuan Kerja'] || '-'}</td>
            <td>${row['Jenis JF'] || '-'}</td>
            <td>${getStatusBadge(row['Status'])}</td>
            <td>${row['Catatan Admin'] || '-'}</td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="showDetail('${start + index}')">
                <i class="fas fa-eye"></i> Detail
              </button>
            </td>
          </tr>
        `).join('');
      }

      renderPagination('tracking', filteredData.length);
    }

    function renderPengelolaTable() {
      currentPage = 1;
      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageData = filteredData.slice(start, end);

      const tbody = document.getElementById('pengelolaTableBody');
      
      if (pageData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" style="text-align: center; padding: 40px;">
              <i class="fas fa-inbox" style="font-size: 40px; color: var(--text-light); margin-bottom: 12px;"></i>
              <p>Tidak ada data</p>
            </td>
          </tr>
        `;
      } else {
        tbody.innerHTML = pageData.map((row, index) => `
          <tr>
            <td>${start + index + 1}</td>
            <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
            <td>${row['NIP'] || '-'}</td>
            <td>${row['Pangkat/Gol'] || '-'}</td>
            <td>${row['Satuan Kerja'] || '-'}</td>
            <td>${row['Jenis JF'] || '-'}</td>
            <td>${row['Jenjang JF'] || '-'}</td>
            <td>${getStatusBadge(row['Status'])}</td>
            <td>${row['Catatan Admin'] || '-'}</td>
          </tr>
        `).join('');
      }

      renderPagination('pengelola', filteredData.length);
    }

    function renderAdminTable() {
      currentPage = 1;
      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageData = filteredData.slice(start, end);

      const tbody = document.getElementById('adminTableBody');
      
      if (pageData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" style="text-align: center; padding: 40px;">
              <i class="fas fa-inbox" style="font-size: 40px; color: var(--text-light); margin-bottom: 12px;"></i>
              <p>Tidak ada data</p>
            </td>
          </tr>
        `;
      } else {
        tbody.innerHTML = pageData.map((row, index) => {
          const rowNum = start + index + 2; // +2 because of header
          return `
            <tr>
              <td>${start + index + 1}</td>
              <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
              <td>${row['NIP'] || '-'}</td>
              <td>${row['Pangkat/Gol'] || '-'}</td>
              <td>${row['Satuan Kerja'] || '-'}</td>
              <td>${row['Jenis JF'] || '-'}</td>
              <td>${getStatusBadge(row['Status'])}</td>
              <td>${formatDate(row['Update Terakhir'])}</td>
              <td>
                <div style="display: flex; gap: 6px;">
                  <button class="btn btn-primary btn-sm btn-icon" onclick="showEdit(${start + index})" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-warning btn-sm btn-icon" onclick="openStatusModal(${start + index})" title="Update Status">
                    <i class="fas fa-tasks"></i>
                  </button>
                  <button class="btn btn-danger btn-sm btn-icon" onclick="openDeleteModal(${rowNum})" title="Hapus">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }

      renderPagination('admin', filteredData.length);
    }

    // ============================================
    // PAGINATION
    // ============================================
    function renderPagination(type, totalItems) {
      const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
      const start = (currentPage - 1) * ITEMS_PER_PAGE + 1;
      const end = Math.min(currentPage * ITEMS_PER_PAGE, totalItems);

      // Update info
      document.getElementById(type + 'PaginationInfo').textContent = 
        `Menampilkan ${totalItems > 0 ? start : 0} - ${end} dari ${totalItems} data`;

      // Generate pagination buttons
      let buttons = '';
      
      // Previous button
      buttons += `<button class="pagination-btn" onclick="changePage('${type}', ${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
        <i class="fas fa-chevron-left"></i>
      </button>`;

      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
          buttons += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</button>`;
        } else if (i === currentPage - 2 || i === currentPage + 2) {
          buttons += `<span style="padding: 0 8px;">...</span>`;
        }
      }

      // Next button
      buttons += `<button class="pagination-btn" onclick="changePage('${type}', ${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
        <i class="fas fa-chevron-right"></i>
      </button>`;

      document.getElementById(type + 'Pagination').innerHTML = buttons;
    }

    function changePage(type, page) {
      currentPage = page;
      const start = (page - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageData = filteredData.slice(start, end);

      let tbodyId = type + 'TableBody';
      const tbody = document.getElementById(tbodyId);
      
      if (tbody) {
        if (type === 'dashboard') {
          tbody.innerHTML = pageData.map((row, index) => `
            <tr>
              <td>${start + index + 1}</td>
              <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
              <td>${row['NIP'] || '-'}</td>
              <td>${row['Satuan Kerja'] || '-'}</td>
              <td>${row['Jenis JF'] || '-'}</td>
              <td>${row['Jenjang JF'] || '-'}</td>
              <td>${getStatusBadge(row['Status'])}</td>
              <td>${formatDate(row['Timestamp'])}</td>
            </tr>
          `).join('');
        } else if (type === 'tracking') {
          tbody.innerHTML = pageData.map((row, index) => `
            <tr>
              <td>${start + index + 1}</td>
              <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
              <td>${row['Satuan Kerja'] || '-'}</td>
              <td>${row['Jenis JF'] || '-'}</td>
              <td>${getStatusBadge(row['Status'])}</td>
              <td>${row['Catatan Admin'] || '-'}</td>
              <td>
                <button class="btn btn-primary btn-sm" onclick="showDetail('${start + index}')">
                  <i class="fas fa-eye"></i> Detail
                </button>
              </td>
            </tr>
          `).join('');
        } else if (type === 'pengelola') {
          tbody.innerHTML = pageData.map((row, index) => `
            <tr>
              <td>${start + index + 1}</td>
              <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
              <td>${row['NIP'] || '-'}</td>
              <td>${row['Pangkat/Gol'] || '-'}</td>
              <td>${row['Satuan Kerja'] || '-'}</td>
              <td>${row['Jenis JF'] || '-'}</td>
              <td>${row['Jenjang JF'] || '-'}</td>
              <td>${getStatusBadge(row['Status'])}</td>
              <td>${row['Catatan Admin'] || '-'}</td>
            </tr>
          `).join('');
        } else if (type === 'admin') {
          tbody.innerHTML = pageData.map((row, index) => {
            const rowNum = start + index + 2;
            return `
              <tr>
                <td>${start + index + 1}</td>
                <td><strong>${row['Nama Lengkap dengan Gelar'] || '-'}</strong></td>
                <td>${row['NIP'] || '-'}</td>
                <td>${row['Pangkat/Gol'] || '-'}</td>
                <td>${row['Satuan Kerja'] || '-'}</td>
                <td>${row['Jenis JF'] || '-'}</td>
                <td>${getStatusBadge(row['Status'])}</td>
                <td>${formatDate(row['Update Terakhir'])}</td>
                <td>
                  <div style="display: flex; gap: 6px;">
                    <button class="btn btn-primary btn-sm btn-icon" onclick="showEdit(${start + index})" title="Edit">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-warning btn-sm btn-icon" onclick="openStatusModal(${start + index})" title="Update Status">
                      <i class="fas fa-tasks"></i>
                    </button>
                    <button class="btn btn-danger btn-sm btn-icon" onclick="openDeleteModal(${rowNum})" title="Hapus">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            `;
          }).join('');
        }
      }

      renderPagination(type, filteredData.length);
    }

    // ============================================
    // FILTERS
    // ============================================
    function filterDashboard() {
      const search = document.getElementById('dashboardSearch').value.toLowerCase();
      const filterJF = document.getElementById('dashboardFilterJF').value;
      const filterStatus = document.getElementById('dashboardFilterStatus').value;

      filteredData = allData.filter(row => {
        const matchSearch = !search || 
          (row['Nama Lengkap dengan Gelar'] || '').toLowerCase().includes(search) ||
          (row['NIP'] || '').includes(search) ||
          (row['Satuan Kerja'] || '').toLowerCase().includes(search);
        
        const matchJF = !filterJF || row['Jenis JF'] === filterJF;
        const matchStatus = !filterStatus || row['Status'] === filterStatus;

        return matchSearch && matchJF && matchStatus;
      });

      renderDashboardTable();
    }

    function filterTracking() {
      const search = document.getElementById('trackingSearch').value.toLowerCase();
      const filterStatus = document.getElementById('trackingFilterStatus').value;
      const filterSatker = document.getElementById('trackingFilterSatker').value;

      filteredData = allData.filter(row => {
        const matchSearch = !search || 
          (row['Nama Lengkap dengan Gelar'] || '').toLowerCase().includes(search);
        
        const matchStatus = !filterStatus || row['Status'] === filterStatus;
        const matchSatker = !filterSatker || (row['Satuan Kerja'] || '').includes(filterSatker);

        return matchSearch && matchStatus && matchSatker;
      });

      renderTrackingTable();
    }

    function filterPengelola() {
      const search = document.getElementById('pengelolaSearch').value.toLowerCase();
      const filterStatus = document.getElementById('pengelolaFilterStatus').value;

      filteredData = allData.filter(row => {
        const matchSearch = !search || 
          (row['Nama Lengkap dengan Gelar'] || '').toLowerCase().includes(search) ||
          (row['NIP'] || '').includes(search) ||
          (row['Satuan Kerja'] || '').toLowerCase().includes(search);
        
        const matchStatus = !filterStatus || row['Status'] === filterStatus;

        return matchSearch && matchStatus;
      });

      updatePengelolaStats();
      renderPengelolaTable();
    }

    function filterAdmin() {
      const search = document.getElementById('adminSearch').value.toLowerCase();
      const filterJF = document.getElementById('adminFilterJF').value;
      const filterStatus = document.getElementById('adminFilterStatus').value;
      const filterSatker = document.getElementById('adminFilterSatker').value;

      filteredData = allData.filter(row => {
        const matchSearch = !search || 
          (row['Nama Lengkap dengan Gelar'] || '').toLowerCase().includes(search) ||
          (row['NIP'] || '').includes(search) ||
          (row['Satuan Kerja'] || '').toLowerCase().includes(search);
        
        const matchJF = !filterJF || row['Jenis JF'] === filterJF;
        const matchStatus = !filterStatus || row['Status'] === filterStatus;
        const matchSatker = !filterSatker || (row['Satuan Kerja'] || '').includes(filterSatker);

        return matchSearch && matchJF && matchStatus && matchSatker;
      });

      renderAdminTable();
    }

    // ============================================
    // FORM HANDLING
    // ============================================
    let selectedFile = null;

    function handleFileSelect(file) {
      if (file.type !== 'application/pdf') {
        showToast('Hanya file PDF yang diizinkan!', 'error');
        return;
      }
      
      if (file.size > 10 * 1024 * 1024) {
        showToast('Ukuran file maksimal 10MB!', 'error');
        return;
      }

      selectedFile = file;
      document.getElementById('fileName').textContent = file.name;
      document.getElementById('fileName').style.display = 'block';
      showToast('File dipilih: ' + file.name, 'success');
    }

    async function handleFormSubmit(e) {
      e.preventDefault();

      const nip = document.getElementById('nip').value;
      
      // Validate NIP (18 digits)
      if (nip.length !== 18 || isNaN(nip)) {
        showToast('NIP harus 18 digit angka!', 'error');
        return;
      }

      // Check for duplicate NIP
      const isDuplicate = allData.some(row => row['NIP'] === nip);
      if (isDuplicate) {
        showToast('NIP sudah terdaftar!', 'error');
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading-spinner"></span> Mengirim...';

      try {
        // In production, this would upload to Drive and submit to Sheet
        // For demo, simulate success
        
        // Simulate file upload delay
        await new Promise(resolve => setTimeout(resolve, 1500));

        // Add to demo data
        const newRow = {
          'Timestamp': new Date().toISOString(),
          'Email': document.getElementById('email').value,
          'NoHP': document.getElementById('noHP').value,
          'Nama Lengkap dengan Gelar': document.getElementById('nama').value.toUpperCase(),
          'NIP': document.getElementById('nip').value,
          'No Karpeg': document.getElementById('noKarpeg').value,
          'Tempat & Tanggal Lahir': document.getElementById('tempatLahir').value + ', ' + document.getElementById('tanggalLahir').value,
          'Pendidikan': document.getElementById('pendidikan').value,
          'Jenis Kelamin': document.getElementById('jenisKelamin').value,
          'Pangkat/Gol': document.getElementById('pangkatGol').value,
          'TMT Pangkat': document.getElementById('tmtPangkat').value,
          'Jenis JF': document.getElementById('jenisJF').value,
          'Jenjang JF': document.getElementById('jenjangJF').value,
          'TMT JF': document.getElementById('tmtJF').value,
          'Masa Kerja Gol': document.getElementById('masaKerjaGol').value,
          'Satuan Kerja': document.getElementById('satuanKerja').value,
          'Upload Dokumen (Drive Link)': selectedFile ? 'https://drive.google.com/file/d/demo' : '',
          'Status': 'Menunggu',
          'Catatan Admin': '',
          'Update Terakhir': new Date().toISOString()
        };

        allData.unshift(newRow);
        
        // Reset form
        document.getElementById('pengajuanForm').reset();
        selectedFile = null;
        document.getElementById('fileName').style.display = 'none';

        showToast('Pengajuan berhasil disubmit!', 'success');
        
        // Redirect to tracking page after 1 second
        setTimeout(() => {
          navigateTo('tracking');
        }, 1500);

      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Pengajuan';
      }
    }

    function validateNIP() {
      const nip = document.getElementById('nip').value;
      const errorEl = document.getElementById('nipError');
      
      if (nip.length !== 18) {
        errorEl.textContent = 'NIP harus 18 digit';
        document.getElementById('nip').classList.add('error');
        return false;
      }

      // Check duplicate
      const isDuplicate = allData.some(row => row['NIP'] === nip);
      if (isDuplicate) {
        errorEl.textContent = 'NIP sudah terdaftar';
        document.getElementById('nip').classList.add('error');
        return false;
      }

      errorEl.textContent = '';
      document.getElementById('nip').classList.remove('error');
      return true;
    }

    // ============================================
    // MODALS
    // ============================================
    function showDetail(index) {
      const row = filteredData[index];
      if (!row) return;

      const html = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Nama Lengkap</label>
            <p style="font-weight: 600;">${row['Nama Lengkap dengan Gelar'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">NIP</label>
            <p style="font-weight: 600;">${row['NIP'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Satuan Kerja</label>
            <p style="font-weight: 600;">${row['Satuan Kerja'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Jenis JF</label>
            <p style="font-weight: 600;">${row['Jenis JF'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Jenjang JF</label>
            <p style="font-weight: 600;">${row['Jenjang JF'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Pangkat/Gol</label>
            <p style="font-weight: 600;">${row['Pangkat/Gol'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">TMT Pangkat</label>
            <p style="font-weight: 600;">${row['TMT Pangkat'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">TMT JF</label>
            <p style="font-weight: 600;">${row['TMT JF'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Masa Kerja Gol</label>
            <p style="font-weight: 600;">${row['Masa Kerja Gol'] || '-'}</p>
          </div>
          <div>
            <label style="font-size: 0.8rem; color: var(--text-light);">Status</label>
            <p>${getStatusBadge(row['Status'])}</p>
          </div>
          <div style="grid-column: 1 / -1;">
            <label style="font-size: 0.8rem; color: var(--text-light);">Catatan Admin</label>
            <p style="font-weight: 600;">${row['Catatan Admin'] || '-'}</p>
          </div>
          ${row['Upload Dokumen (Drive Link)'] ? `
          <div style="grid-column: 1 / -1;">
            <label style="font-size: 0.8rem; color: var(--text-light);">Dokumen</label>
            <br>
            <button class="btn btn-primary btn-sm" onclick="viewDocument('${row['Upload Dokumen (Drive Link)']}')">
              <i class="fas fa-file-pdf"></i> Lihat Dokumen
            </button>
          </div>
          ` : ''}
        </div>
      `;

      document.getElementById('detailModalBody').innerHTML = html;
      openModal('detailModal');
    }

    function openStatusModal(index) {
      const row = filteredData[index];
      if (!row) return;

      document.getElementById('statusRowNumber').value = index + 2; // +2 for header
      document.getElementById('updateStatus').value = row['Status'] || 'Menunggu';
      document.getElementById('updateCatatan').value = row['Catatan Admin'] || '';
      
      openModal('statusModal');
    }

    function submitStatusUpdate() {
      const rowIndex = parseInt(document.getElementById('statusRowNumber').value) - 2;
      const newStatus = document.getElementById('updateStatus').value;
      const catatan = document.getElementById('updateCatatan').value;

      if (rowIndex >= 0 && rowIndex < allData.length) {
        allData[rowIndex]['Status'] = newStatus;
        allData[rowIndex]['Catatan Admin'] = catatan;
        allData[rowIndex]['Update Terakhir'] = new Date().toISOString();

        showToast('Status berhasil diupdate!', 'success');
        closeModal('statusModal');
        filterAdmin();
      }
    }

    function showEdit(index) {
      const row = filteredData[index];
      if (!row) return;

      document.getElementById('editRowNumber').value = index;
      document.getElementById('editNama').value = row['Nama Lengkap dengan Gelar'] || '';
      document.getElementById('editNIP').value = row['NIP'] || '';
      document.getElementById('editPangkatGol').value = row['Pangkat/Gol'] || '';
      document.getElementById('editJenisJF').value = row['Jenis JF'] || '';
      document.getElementById('editJenjangJF').value = row['Jenjang JF'] || '';
      document.getElementById('editSatuanKerja').value = row['Satuan Kerja'] || '';
      document.getElementById('editTmtpangkat').value = row['TMT Pangkat'] || '';
      document.getElementById('editTmtjf').value = row['TMT JF'] || '';
      document.getElementById('editMasaKerjaGol').value = row['Masa Kerja Gol'] || '';

      openModal('editModal');
    }

    function submitEdit() {
      const index = parseInt(document.getElementById('editRowNumber').value);
      
      if (index >= 0 && index < allData.length) {
        allData[index]['Nama Lengkap dengan Gelar'] = document.getElementById('editNama').value;
        allData[index]['NIP'] = document.getElementById('editNIP').value;
        allData[index]['Pangkat/Gol'] = document.getElementById('editPangkatGol').value;
        allData[index]['Jenis JF'] = document.getElementById('editJenisJF').value;
        allData[index]['Jenjang JF'] = document.getElementById('editJenjangJF').value;
        allData[index]['Satuan Kerja'] = document.getElementById('editSatuanKerja').value;
        allData[index]['TMT Pangkat'] = document.getElementById('editTmtpangkat').value;
        allData[index]['TMT JF'] = document.getElementById('editTmtjf').value;
        allData[index]['Masa Kerja Gol'] = document.getElementById('editMasaKerjaGol').value;
        allData[index]['Update Terakhir'] = new Date().toISOString();

        showToast('Data berhasil diupdate!', 'success');
        closeModal('editModal');
        filterAdmin();
      }
    }

    function openDeleteModal(rowNumber) {
      deleteRowNumber = rowNumber;
      openModal('deleteModal');
    }

    function confirmDelete() {
      if (deleteRowNumber) {
        // In production, call delete API
        // For demo, remove from array
        const index = deleteRowNumber - 2;
        if (index >= 0 && index < allData.length) {
          allData.splice(index, 1);
          showToast('Data berhasil dihapus!', 'success');
        }
        
        closeModal('deleteModal');
        filterAdmin();
      }
    }

    function viewDocument(url) {
      document.getElementById('documentViewer').src = url;
      document.getElementById('documentLink').href = url;
      openModal('documentModal');
    }

    // ============================================
    // MODAL HELPERS
    // ============================================
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('active');
    }

    // Close modal on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });
    });

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function getStatusBadge(status) {
      const statusMap = {
        'Menunggu': 'badge-menunggu',
        'Perbaikan': 'badge-perbaikan',
        'Ditolak': 'badge-ditolak',
        'Terbit': 'badge-terbit'
      };
      
      const labelMap = {
        'Menunggu': 'Menunggu',
        'Perbaikan': 'Perbaikan',
        'Ditolak': 'Ditolak',
        'Terbit': 'Terbit'
      };

      const className = statusMap[status] || 'badge-menunggu';
      const label = labelMap[status] || 'Menunggu';
      
      return `<span class="badge ${className}">${label}</span>`;
    }

    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
      });
    }

    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const icons = {
        success: 'fa-check-circle',
        error: 'fa-times-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
      };

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <i class="fas ${icons[type]} toast-icon"></i>
        <span class="toast-message">${message}</span>
      `;

      container.appendChild(toast);

      // Auto remove after 3 seconds
      setTimeout(() => {
        toast.style.animation = 'toastIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function refreshDashboard() {
      loadDashboardData();
      showToast('Data diperbarui!', 'success');
    }

    function refreshAdmin() {
      loadAdminData();
      showToast('Data diperbarui!', 'success');
    }

    function exportExcel() {
      // Simple CSV export
      let csv = 'No,Nama Lengkap,NIP,Pangkat/Gol,Satuan Kerja,Jenis JF,Jenjang JF,Status,Catatan\n';
      
      filteredData.forEach((row, index) => {
        csv += `${index + 1},"${row['Nama Lengkap with Gelar'] || ''}",${row['NIP'] || ''},${row['Pangkat/Gol'] || ''},${row['Satuan Kerja'] || ''},${row['Jenis JF'] || ''},${row['Jenjang JF'] || ''},${row['Status'] || ''},"${row['Catatan Admin'] || ''}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `PAK_Export_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();

      showToast('Export berhasil!', 'success');
    }
  </script>
</body>
</html>
